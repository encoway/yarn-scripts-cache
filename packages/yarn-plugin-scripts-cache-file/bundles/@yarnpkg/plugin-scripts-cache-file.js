/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-scripts-cache-file",
factory: function (require) {
"use strict";var plugin=(()=>{var A=Object.create;var c=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var d=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var l=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+i+'" is not supported')});var N=(i,e)=>{for(var t in e)c(i,t,{get:e[t],enumerable:!0})},g=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of p(e))!y.call(i,a)&&a!==t&&c(i,a,{get:()=>e[a],enumerable:!(r=_(e,a))||r.enumerable});return i};var P=(i,e,t)=>(t=i!=null?A(d(i)):{},g(e||!i||!i.__esModule?c(t,"default",{value:i,enumerable:!0}):t,i)),D=i=>g(c({},"__esModule",{value:!0}),i);var X={};N(X,{default:()=>k});var n=l("@yarnpkg/fslib"),E=P(l("crypto")),s="file",F=10,I="YARN_SCRIPTS_CACHE_FILE_MAX_AGE",b="maxAge",M=2592e6,S="YARN_SCRIPTS_CACHE_FILE_MAX_AMOUNT",O="maxAmount",R=1e3,L="YARN_SCRIPTS_CACHE_FILE_CACHE_FOLDER_NAME",x="cacheFolderName",w=".yarn-scripts-cache",h=class{constructor(e,t){this.name=s,this.order=F,this.cwd=e,this.config=t}async saveCacheEntry(e){let t=this.buildCacheDir();await n.xfs.mkdirPromise(t,{recursive:!0});let r=this.buildCacheFile(t,e.key),a=JSON.stringify(e);await n.xfs.writeFilePromise(r,a),await this.cleanup()}async loadCacheEntry(e){let t=this.buildCacheDir();if(!await n.xfs.existsPromise(t))return;let r=this.buildCacheFile(t,e);if(await n.xfs.existsPromise(r)){let a=await n.xfs.readFilePromise(r,"utf8"),C=JSON.parse(a);if(V(e,C.key))return C}}async cleanup(){let e=this.readMaxAge(),t=this.readMaxAmount(),r=Date.now()-e,a=this.buildCacheDir(),f=(await n.xfs.readdirPromise(a)).map(o=>n.ppath.join(a,o)).map(v);f.sort((o,m)=>m.creationDate-o.creationDate);let u=0;for(let o of f)o.creationDate<r?await n.xfs.unlinkPromise(o.file):u+=1,u>t&&await n.xfs.unlinkPromise(o.file)}buildCacheFile(e,t){let r=E.default.createHash("sha512");return r.update(JSON.stringify(t)),n.ppath.join(e,(0,n.toFilename)(`${r.digest("base64url")}.json`))}buildCacheDir(){return n.ppath.join(this.cwd,(0,n.toFilename)(this.readCacheFolderName()))}readMaxAge(){return this.readIntConfigValue(I,b,M)}readMaxAmount(){return this.readIntConfigValue(S,O,R)}readCacheFolderName(){return this.readStringConfigValue(L,x,w)}readIntConfigValue(e,t,r){let a=process.env[e];return a&&!isNaN(parseInt(a))?parseInt(a):this.config.cacheConfigs&&this.config.cacheConfigs[s]&&typeof this.config.cacheConfigs[s][t]=="number"?this.config.cacheConfigs[s][t]:r}readStringConfigValue(e,t,r){let a=process.env[e];return a||(this.config.cacheConfigs&&this.config.cacheConfigs[s]&&typeof this.config.cacheConfigs[s][t]=="string"?this.config.cacheConfigs[s][t]:r)}};function V(i,e){return JSON.stringify(i)===JSON.stringify(e)}function v(i){let e=n.xfs.statSync(i);return{file:i,creationDate:e.mtime.getTime()}}var T=async(i,e,t)=>{i.push(new h(t.extra.cwd,e))},U={beforeYarnScriptsCacheUsage:T},H={hooks:U},k=H;return D(X);})();
return plugin;
}
};
