/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-scripts-cache-file",
factory: function (require) {
"use strict";var plugin=(()=>{var y=Object.create;var c=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var u=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var D=(t,e)=>{for(var i in e)c(t,i,{get:e[i],enumerable:!0})},m=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of p(e))!b.call(t,r)&&r!==i&&c(t,r,{get:()=>e[r],enumerable:!(n=g(e,r))||n.enumerable});return t};var E=(t,e,i)=>(i=t!=null?y(P(t)):{},m(e||!t||!t.__esModule?c(i,"default",{value:t,enumerable:!0}):i,t)),w=t=>m(c({},"__esModule",{value:!0}),t);var K={};D(K,{default:()=>J});var a=u("@yarnpkg/fslib"),C=E(u("crypto")),A=".yarn-scripts-cache",x=2592e6,F=1e3,S="file",M=10,s=class{constructor(e,i){this.name=S,this.order=M,this.cwd=e,this.config=i}async saveCacheEntry(e){let i=this.buildCacheDir();await a.xfs.mkdirPromise(i,{recursive:!0});let n=this.buildCacheFile(i,e.key),r=JSON.stringify(e);await a.xfs.writeFilePromise(n,r),await this.cleanup()}async loadCacheEntry(e){let i=this.buildCacheDir();if(!await a.xfs.existsPromise(i))return;let n=this.buildCacheFile(i,e);if(await a.xfs.existsPromise(n)){let r=await a.xfs.readFilePromise(n,"utf8"),h=JSON.parse(r);if(k(e,h.key))return h}}async cleanup(){let e=typeof this.config.localCacheMaxAge>"u"?x:this.config.localCacheMaxAge,i=typeof this.config.localCacheMaxAmount>"u"?F:this.config.localCacheMaxAmount,n=Date.now()-e,r=this.buildCacheDir(),l=(await a.xfs.readdirPromise(r)).map(o=>a.ppath.join(r,o)).map(N);l.sort((o,d)=>d.creationDate-o.creationDate);let f=0;for(let o of l)o.creationDate<n?await a.xfs.unlinkPromise(o.file):f+=1,f>i&&await a.xfs.unlinkPromise(o.file)}buildCacheFile(e,i){let n=C.default.createHash("sha512");return n.update(JSON.stringify(i)),a.ppath.join(e,(0,a.toFilename)(`${n.digest("base64url")}.json`))}buildCacheDir(){return a.ppath.join(this.cwd,(0,a.toFilename)(A))}};function k(t,e){return JSON.stringify(t)===JSON.stringify(e)}function N(t){let e=a.xfs.statSync(t);return{file:t,creationDate:e.mtime.getTime()}}var O=async(t,e,i)=>{t.push(new s(i.extra.cwd,e))},U={beforeYarnScriptsCacheUsage:O},_={hooks:U},J=_;return w(K);})();
return plugin;
}
};
