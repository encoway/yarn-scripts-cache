/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-scripts-cache-file",
factory: function (require) {
"use strict";var plugin=(()=>{var j=Object.create;var d=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var A=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var u=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),B=(t,e)=>{for(var r in e)d(t,r,{get:e[r],enumerable:!0})},m=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of R(e))!T.call(t,a)&&a!==r&&d(t,a,{get:()=>e[a],enumerable:!(i=x(e,a))||i.enumerable});return t};var p=(t,e,r)=>(r=t!=null?j(U(t)):{},m(e||!t||!t.__esModule?d(r,"default",{value:t,enumerable:!0}):r,t)),X=t=>m(d({},"__esModule",{value:!0}),t);var P=u(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0})});var O=u(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0})});var D=u(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0})});var F=u(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.readStringConfigValue=f.readIntConfigValue=void 0;function Y(t,e,r,i,a){let s=process.env[r];return s&&!isNaN(parseInt(s))?parseInt(s):t.cacheConfigs&&t.cacheConfigs[e]&&typeof t.cacheConfigs[e][i]=="number"?t.cacheConfigs[e][i]:a}f.readIntConfigValue=Y;function G(t,e,r,i,a){let s=process.env[r];return s||(t.cacheConfigs&&t.cacheConfigs[e]&&typeof t.cacheConfigs[e][i]=="string"?t.cacheConfigs[e][i]:a)}f.readStringConfigValue=G});var v=u(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0})});var S=u(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0})});var w=u(o=>{"use strict";var H=o&&o.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var a=Object.getOwnPropertyDescriptor(e,r);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,a)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),h=o&&o.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&H(e,t,r)};Object.defineProperty(o,"__esModule",{value:!0});h(P(),o);h(O(),o);h(D(),o);h(F(),o);h(v(),o);h(S(),o)});var se={};B(se,{default:()=>oe});var l=p(w()),n=A("@yarnpkg/fslib"),L=p(A("crypto")),C="file",q=10,J="YSC_FILE_MAX_AGE",K="maxAge",W=2592e6,k="YSC_FILE_MAX_AMOUNT",$="maxAmount",z=1e3,Q="YSC_FILE_CACHE_FOLDER_NAME",Z="cacheFolderName",ee=".yarn-scripts-cache",_=class{constructor(e,r){this.name=C,this.order=q,this.cwd=e,this.config=r}async saveCacheEntry(e){let r=this.buildCacheDir();await n.xfs.mkdirPromise(r,{recursive:!0});let i=this.buildCacheFile(r,e.key),a=JSON.stringify(e);await n.xfs.writeFilePromise(i,a),await this.cleanup()}async loadCacheEntry(e){let r=this.buildCacheDir();if(!await n.xfs.existsPromise(r))return;let i=this.buildCacheFile(r,e);if(await n.xfs.existsPromise(i)){let a=await n.xfs.readFilePromise(i,"utf8"),s=JSON.parse(a);if(te(e,s.key))return s}}async cleanup(){let e=this.readMaxAge(),r=this.readMaxAmount(),i=Date.now()-e,a=this.buildCacheDir(),E=(await n.xfs.readdirPromise(a)).map(c=>n.ppath.join(a,c)).map(re);E.sort((c,V)=>V.creationDate-c.creationDate);let g=0;for(let c of E)c.creationDate<i?await n.xfs.unlinkPromise(c.file):g+=1,g>r&&await n.xfs.unlinkPromise(c.file)}buildCacheFile(e,r){let i=L.default.createHash("sha512");return i.update(JSON.stringify(r)),n.ppath.join(e,(0,n.toFilename)(`${i.digest("base64url")}.json`))}buildCacheDir(){return n.ppath.join(this.cwd,(0,n.toFilename)(this.readCacheFolderName()))}readMaxAge(){return(0,l.readIntConfigValue)(this.config,C,J,K,W)}readMaxAmount(){return(0,l.readIntConfigValue)(this.config,C,k,$,z)}readCacheFolderName(){return(0,l.readStringConfigValue)(this.config,C,Q,Z,ee)}};function te(t,e){return JSON.stringify(t)===JSON.stringify(e)}function re(t){let e=n.xfs.statSync(t);return{file:t,creationDate:e.mtime.getTime()}}var ie=async(t,e,r)=>{t.push(new _(r.extra.cwd,e))},ae={beforeYarnScriptsCacheUsage:ie},ne={hooks:ae},oe=ne;return X(se);})();
return plugin;
}
};
