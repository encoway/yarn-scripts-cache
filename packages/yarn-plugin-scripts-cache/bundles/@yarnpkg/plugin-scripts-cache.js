/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-scripts-cache",
factory: function (require) {
"use strict";var plugin=(()=>{var Ke=Object.create;var nt=Object.defineProperty;var ze=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var Xe=Object.getPrototypeOf,Je=Object.prototype.hasOwnProperty;var w=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var O=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),tr=(t,e)=>{for(var r in e)nt(t,r,{get:e[r],enumerable:!0})},Vt=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ze(e))!Je.call(t,n)&&n!==r&&nt(t,n,{get:()=>e[n],enumerable:!(i=ze(e,n))||i.enumerable});return t};var ht=(t,e,r)=>(r=t!=null?Ke(Xe(t)):{},Vt(e||!t||!t.__esModule?nt(r,"default",{value:t,enumerable:!0}):r,t)),er=t=>Vt(nt({},"__esModule",{value:!0}),t);var Ht=O(ft=>{var U=w("path"),x=process.platform==="win32",$=w("fs"),nr=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function sr(){var t;if(nr){var e=new Error;t=r}else t=i;return t;function r(n){n&&(e.message=n.message,n=e,i(n))}function i(n){if(n){if(process.throwDeprecation)throw n;if(!process.noDeprecation){var s="fs: missing callback "+(n.stack||n.message);process.traceDeprecation?console.trace(s):console.error(s)}}}}function ar(t){return typeof t=="function"?t:sr()}var Ei=U.normalize;x?R=/(.*?)(?:[\/\\]+|$)/g:R=/(.*?)(?:[\/]+|$)/g;var R;x?X=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:X=/^[\/]*/;var X;ft.realpathSync=function(e,r){if(e=U.resolve(e),r&&Object.prototype.hasOwnProperty.call(r,e))return r[e];var i=e,n={},s={},a,o,c,u;h();function h(){var g=X.exec(e);a=g[0].length,o=g[0],c=g[0],u="",x&&!s[c]&&($.lstatSync(c),s[c]=!0)}for(;a<e.length;){R.lastIndex=a;var d=R.exec(e);if(u=o,o+=d[0],c=u+d[1],a=R.lastIndex,!(s[c]||r&&r[c]===c)){var l;if(r&&Object.prototype.hasOwnProperty.call(r,c))l=r[c];else{var f=$.lstatSync(c);if(!f.isSymbolicLink()){s[c]=!0,r&&(r[c]=c);continue}var p=null;if(!x){var b=f.dev.toString(32)+":"+f.ino.toString(32);n.hasOwnProperty(b)&&(p=n[b])}p===null&&($.statSync(c),p=$.readlinkSync(c)),l=U.resolve(u,p),r&&(r[c]=l),x||(n[b]=p)}e=U.resolve(l,e.slice(a)),h()}}return r&&(r[i]=e),e};ft.realpath=function(e,r,i){if(typeof i!="function"&&(i=ar(r),r=null),e=U.resolve(e),r&&Object.prototype.hasOwnProperty.call(r,e))return process.nextTick(i.bind(null,null,r[e]));var n=e,s={},a={},o,c,u,h;d();function d(){var g=X.exec(e);o=g[0].length,c=g[0],u=g[0],h="",x&&!a[u]?$.lstat(u,function(N){if(N)return i(N);a[u]=!0,l()}):process.nextTick(l)}function l(){if(o>=e.length)return r&&(r[n]=e),i(null,e);R.lastIndex=o;var g=R.exec(e);return h=c,c+=g[0],u=h+g[1],o=R.lastIndex,a[u]||r&&r[u]===u?process.nextTick(l):r&&Object.prototype.hasOwnProperty.call(r,u)?b(r[u]):$.lstat(u,f)}function f(g,N){if(g)return i(g);if(!N.isSymbolicLink())return a[u]=!0,r&&(r[u]=u),process.nextTick(l);if(!x){var j=N.dev.toString(32)+":"+N.ino.toString(32);if(s.hasOwnProperty(j))return p(null,s[j],u)}$.stat(u,function(F){if(F)return i(F);$.readlink(u,function(I,M){x||(s[j]=M),p(I,M)})})}function p(g,N,j){if(g)return i(g);var F=U.resolve(h,N);r&&(r[j]=F),b(F)}function b(g){e=U.resolve(g,e.slice(o)),d()}}});var vt=O((wi,zt)=>{zt.exports=G;G.realpath=G;G.sync=gt;G.realpathSync=gt;G.monkeypatch=cr;G.unmonkeypatch=ur;var z=w("fs"),pt=z.realpath,dt=z.realpathSync,or=process.version,Qt=/^v[0-5]\./.test(or),Yt=Ht();function Kt(t){return t&&t.syscall==="realpath"&&(t.code==="ELOOP"||t.code==="ENOMEM"||t.code==="ENAMETOOLONG")}function G(t,e,r){if(Qt)return pt(t,e,r);typeof e=="function"&&(r=e,e=null),pt(t,e,function(i,n){Kt(i)?Yt.realpath(t,e,r):r(i,n)})}function gt(t,e){if(Qt)return dt(t,e);try{return dt(t,e)}catch(r){if(Kt(r))return Yt.realpathSync(t,e);throw r}}function cr(){z.realpath=G,z.realpathSync=gt}function ur(){z.realpath=pt,z.realpathSync=dt}});var Xt=O((_i,Zt)=>{var lr=typeof process=="object"&&process&&process.platform==="win32";Zt.exports=lr?{sep:"\\"}:{sep:"/"}});var ie=O((Si,re)=>{"use strict";re.exports=te;function te(t,e,r){t instanceof RegExp&&(t=Jt(t,r)),e instanceof RegExp&&(e=Jt(e,r));var i=ee(t,e,r);return i&&{start:i[0],end:i[1],pre:r.slice(0,i[0]),body:r.slice(i[0]+t.length,i[1]),post:r.slice(i[1]+e.length)}}function Jt(t,e){var r=e.match(t);return r?r[0]:null}te.range=ee;function ee(t,e,r){var i,n,s,a,o,c=r.indexOf(t),u=r.indexOf(e,c+1),h=c;if(c>=0&&u>0){if(t===e)return[c,u];for(i=[],s=r.length;h>=0&&!o;)h==c?(i.push(h),c=r.indexOf(t,h+1)):i.length==1?o=[i.pop(),u]:(n=i.pop(),n<s&&(s=n,a=u),u=r.indexOf(e,h+1)),h=c<u&&c>=0?c:u;i.length&&(o=[s,a])}return o}});var he=O((Ai,le)=>{var ne=ie();le.exports=pr;var se="\0SLASH"+Math.random()+"\0",ae="\0OPEN"+Math.random()+"\0",yt="\0CLOSE"+Math.random()+"\0",oe="\0COMMA"+Math.random()+"\0",ce="\0PERIOD"+Math.random()+"\0";function mt(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function hr(t){return t.split("\\\\").join(se).split("\\{").join(ae).split("\\}").join(yt).split("\\,").join(oe).split("\\.").join(ce)}function fr(t){return t.split(se).join("\\").split(ae).join("{").split(yt).join("}").split(oe).join(",").split(ce).join(".")}function ue(t){if(!t)return[""];var e=[],r=ne("{","}",t);if(!r)return t.split(",");var i=r.pre,n=r.body,s=r.post,a=i.split(",");a[a.length-1]+="{"+n+"}";var o=ue(s);return s.length&&(a[a.length-1]+=o.shift(),a.push.apply(a,o)),e.push.apply(e,a),e}function pr(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),J(hr(t),!0).map(fr)):[]}function dr(t){return"{"+t+"}"}function gr(t){return/^-?0\d/.test(t)}function vr(t,e){return t<=e}function mr(t,e){return t>=e}function J(t,e){var r=[],i=ne("{","}",t);if(!i)return[t];var n=i.pre,s=i.post.length?J(i.post,!1):[""];if(/\$$/.test(i.pre))for(var a=0;a<s.length;a++){var o=n+"{"+i.body+"}"+s[a];r.push(o)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),h=c||u,d=i.body.indexOf(",")>=0;if(!h&&!d)return i.post.match(/,.*\}/)?(t=i.pre+"{"+i.body+yt+i.post,J(t)):[t];var l;if(h)l=i.body.split(/\.\./);else if(l=ue(i.body),l.length===1&&(l=J(l[0],!1).map(dr),l.length===1))return s.map(function(K){return i.pre+l[0]+K});var f;if(h){var p=mt(l[0]),b=mt(l[1]),g=Math.max(l[0].length,l[1].length),N=l.length==3?Math.abs(mt(l[2])):1,j=vr,F=b<p;F&&(N*=-1,j=mr);var I=l.some(gr);f=[];for(var M=p;j(M,b);M+=N){var P;if(u)P=String.fromCharCode(M),P==="\\"&&(P="");else if(P=String(M),I){var m=g-P.length;if(m>0){var v=new Array(m+1).join("0");M<0?P="-"+v+P.slice(1):P=v+P}}f.push(P)}}else{f=[];for(var E=0;E<l.length;E++)f.push.apply(f,J(l[E],!1))}for(var E=0;E<f.length;E++)for(var a=0;a<s.length;a++){var o=n+f[E]+s[a];(!e||h||o)&&r.push(o)}}return r}});var ot=O((Ni,St)=>{var C=St.exports=(t,e,r={})=>(at(e),!r.nocomment&&e.charAt(0)==="#"?!1:new Z(e,r).match(t));St.exports=C;var wt=Xt();C.sep=wt.sep;var D=Symbol("globstar **");C.GLOBSTAR=D;var yr=he(),fe={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},_t="[^/]",Et=_t+"*?",Er="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",br="(?:(?!(?:\\/|^)\\.).)*?",ge=t=>t.split("").reduce((e,r)=>(e[r]=!0,e),{}),pe=ge("().*{}+?[]^$\\!"),wr=ge("[.("),de=/\/+/;C.filter=(t,e={})=>(r,i,n)=>C(r,t,e);var T=(t,e={})=>{let r={};return Object.keys(t).forEach(i=>r[i]=t[i]),Object.keys(e).forEach(i=>r[i]=e[i]),r};C.defaults=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return C;let e=C,r=(i,n,s)=>e(i,n,T(t,s));return r.Minimatch=class extends e.Minimatch{constructor(n,s){super(n,T(t,s))}},r.Minimatch.defaults=i=>e.defaults(T(t,i)).Minimatch,r.filter=(i,n)=>e.filter(i,T(t,n)),r.defaults=i=>e.defaults(T(t,i)),r.makeRe=(i,n)=>e.makeRe(i,T(t,n)),r.braceExpand=(i,n)=>e.braceExpand(i,T(t,n)),r.match=(i,n,s)=>e.match(i,n,T(t,s)),r};C.braceExpand=(t,e)=>ve(t,e);var ve=(t,e={})=>(at(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:yr(t)),_r=1024*64,at=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>_r)throw new TypeError("pattern is too long")},bt=Symbol("subparse");C.makeRe=(t,e)=>new Z(t,e||{}).makeRe();C.match=(t,e,r={})=>{let i=new Z(e,r);return t=t.filter(n=>i.match(n)),i.options.nonull&&!t.length&&t.push(e),t};var Sr=t=>t.replace(/\\(.)/g,"$1"),Ar=t=>t.replace(/\\([^-\]])/g,"$1"),kr=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Nr=t=>t.replace(/[[\]\\]/g,"\\$&"),Z=class{constructor(e,r){at(e),r||(r={}),this.options=r,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!r.windowsPathsNoEscape||r.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!r.partial,this.make()}debug(){}make(){let e=this.pattern,r=this.options;if(!r.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let i=this.globSet=this.braceExpand();r.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,i),i=this.globParts=i.map(n=>n.split(de)),this.debug(this.pattern,i),i=i.map((n,s,a)=>n.map(this.parse,this)),this.debug(this.pattern,i),i=i.filter(n=>n.indexOf(!1)===-1),this.debug(this.pattern,i),this.set=i}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,r=!1,i=0;for(let n=0;n<e.length&&e.charAt(n)==="!";n++)r=!r,i++;i&&(this.pattern=e.slice(i)),this.negate=r}matchOne(e,r,i){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:r}),this.debug("matchOne",e.length,r.length);for(var s=0,a=0,o=e.length,c=r.length;s<o&&a<c;s++,a++){this.debug("matchOne loop");var u=r[a],h=e[s];if(this.debug(r,u,h),u===!1)return!1;if(u===D){this.debug("GLOBSTAR",[r,u,h]);var d=s,l=a+1;if(l===c){for(this.debug("** at the end");s<o;s++)if(e[s]==="."||e[s]===".."||!n.dot&&e[s].charAt(0)===".")return!1;return!0}for(;d<o;){var f=e[d];if(this.debug(`
globstar while`,e,d,r,l,f),this.matchOne(e.slice(d),r.slice(l),i))return this.debug("globstar found match!",d,o,f),!0;if(f==="."||f===".."||!n.dot&&f.charAt(0)==="."){this.debug("dot detected!",e,d,r,l);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(i&&(this.debug(`
>>> no match, partial?`,e,d,r,l),d===o))}var p;if(typeof u=="string"?(p=h===u,this.debug("string match",u,h,p)):(p=h.match(u),this.debug("pattern match",u,h,p)),!p)return!1}if(s===o&&a===c)return!0;if(s===o)return i;if(a===c)return s===o-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return ve(this.pattern,this.options)}parse(e,r){at(e);let i=this.options;if(e==="**")if(i.noglobstar)e="*";else return D;if(e==="")return"";let n="",s=!1,a=!1,o=[],c=[],u,h=!1,d=-1,l=-1,f,p,b,g=e.charAt(0)===".",N=i.dot||g,j=()=>g?"":N?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",F=m=>m.charAt(0)==="."?"":i.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",I=()=>{if(u){switch(u){case"*":n+=Et,s=!0;break;case"?":n+=_t,s=!0;break;default:n+="\\"+u;break}this.debug("clearStateChar %j %j",u,n),u=!1}};for(let m=0,v;m<e.length&&(v=e.charAt(m));m++){if(this.debug("%s	%s %s %j",e,m,n,v),a){if(v==="/")return!1;pe[v]&&(n+="\\"),n+=v,a=!1;continue}switch(v){case"/":return!1;case"\\":if(h&&e.charAt(m+1)==="-"){n+=v;continue}I(),a=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,m,n,v),h){this.debug("  in class"),v==="!"&&m===l+1&&(v="^"),n+=v;continue}this.debug("call clearStateChar %j",u),I(),u=v,i.noext&&I();continue;case"(":{if(h){n+="(";continue}if(!u){n+="\\(";continue}let E={type:u,start:m-1,reStart:n.length,open:fe[u].open,close:fe[u].close};this.debug(this.pattern,"	",E),o.push(E),n+=E.open,E.start===0&&E.type!=="!"&&(g=!0,n+=F(e.slice(m+1))),this.debug("plType %j %j",u,n),u=!1;continue}case")":{let E=o[o.length-1];if(h||!E){n+="\\)";continue}o.pop(),I(),s=!0,p=E,n+=p.close,p.type==="!"&&c.push(Object.assign(p,{reEnd:n.length}));continue}case"|":{let E=o[o.length-1];if(h||!E){n+="\\|";continue}I(),n+="|",E.start===0&&E.type!=="!"&&(g=!0,n+=F(e.slice(m+1)));continue}case"[":if(I(),h){n+="\\"+v;continue}h=!0,l=m,d=n.length,n+=v;continue;case"]":if(m===l+1||!h){n+="\\"+v;continue}f=e.substring(l+1,m);try{RegExp("["+Nr(Ar(f))+"]"),n+=v}catch{n=n.substring(0,d)+"(?:$.)"}s=!0,h=!1;continue;default:I(),pe[v]&&!(v==="^"&&h)&&(n+="\\"),n+=v;break}}for(h&&(f=e.slice(l+1),b=this.parse(f,bt),n=n.substring(0,d)+"\\["+b[0],s=s||b[1]),p=o.pop();p;p=o.pop()){let m;m=n.slice(p.reStart+p.open.length),this.debug("setting tail",n,p),m=m.replace(/((?:\\{2}){0,64})(\\?)\|/g,(E,K,L)=>(L||(L="\\"),K+K+L+"|")),this.debug(`tail=%j
   %s`,m,m,p,n);let v=p.type==="*"?Et:p.type==="?"?_t:"\\"+p.type;s=!0,n=n.slice(0,p.reStart)+v+"\\("+m}I(),a&&(n+="\\\\");let M=wr[n.charAt(0)];for(let m=c.length-1;m>-1;m--){let v=c[m],E=n.slice(0,v.reStart),K=n.slice(v.reStart,v.reEnd-8),L=n.slice(v.reEnd),Be=n.slice(v.reEnd-8,v.reEnd)+L,He=E.split(")").length,Qe=E.split("(").length-He,lt=L;for(let Ut=0;Ut<Qe;Ut++)lt=lt.replace(/\)[+*?]?/,"");L=lt;let Ye=L===""&&r!==bt?"(?:$|\\/)":"";n=E+K+L+Ye+Be}if(n!==""&&s&&(n="(?=.)"+n),M&&(n=j()+n),r===bt)return[n,s];if(i.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return Sr(e);let P=i.nocase?"i":"";try{return Object.assign(new RegExp("^"+n+"$",P),{_glob:e,_src:n})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let r=this.options,i=r.noglobstar?Et:r.dot?Er:br,n=r.nocase?"i":"",s=e.map(a=>(a=a.map(o=>typeof o=="string"?kr(o):o===D?D:o._src).reduce((o,c)=>(o[o.length-1]===D&&c===D||o.push(c),o),[]),a.forEach((o,c)=>{o!==D||a[c-1]===D||(c===0?a.length>1?a[c+1]="(?:\\/|"+i+"\\/)?"+a[c+1]:a[c]=i:c===a.length-1?a[c-1]+="(?:\\/|"+i+")?":(a[c-1]+="(?:\\/|\\/"+i+"\\/)"+a[c+1],a[c+1]=D))}),a.filter(o=>o!==D).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,n)}catch{this.regexp=!1}return this.regexp}match(e,r=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&r)return!0;let i=this.options;wt.sep!=="/"&&(e=e.split(wt.sep).join("/")),e=e.split(de),this.debug(this.pattern,"split",e);let n=this.set;this.debug(this.pattern,"set",n);let s;for(let a=e.length-1;a>=0&&(s=e[a],!s);a--);for(let a=0;a<n.length;a++){let o=n[a],c=e;if(i.matchBase&&o.length===1&&(c=[s]),this.matchOne(c,o,r))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(e){return C.defaults(e).Minimatch}};C.Minimatch=Z});var me=O((Oi,At)=>{typeof Object.create=="function"?At.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:At.exports=function(e,r){if(r){e.super_=r;var i=function(){};i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e}}});var ye=O((Ci,Nt)=>{try{if(kt=w("util"),typeof kt.inherits!="function")throw"";Nt.exports=kt.inherits}catch{Nt.exports=me()}var kt});var Ct=O(q=>{q.setopts=jr;q.ownProp=Ee;q.makeAbs=tt;q.finish=Fr;q.mark=Mr;q.isIgnored=we;q.childrenIgnored=Lr;function Ee(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Or=w("fs"),V=w("path"),Cr=ot(),be=w("path").isAbsolute,Ot=Cr.Minimatch;function Ir(t,e){return t.localeCompare(e,"en")}function Pr(t,e){t.ignore=e.ignore||[],Array.isArray(t.ignore)||(t.ignore=[t.ignore]),t.ignore.length&&(t.ignore=t.ignore.map(Dr))}function Dr(t){var e=null;if(t.slice(-3)==="/**"){var r=t.replace(/(\/\*\*)+$/,"");e=new Ot(r,{dot:!0})}return{matcher:new Ot(t,{dot:!0}),gmatcher:e}}function jr(t,e,r){if(r||(r={}),r.matchBase&&e.indexOf("/")===-1){if(r.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}t.windowsPathsNoEscape=!!r.windowsPathsNoEscape||r.allowWindowsEscape===!1,t.windowsPathsNoEscape&&(e=e.replace(/\\/g,"/")),t.silent=!!r.silent,t.pattern=e,t.strict=r.strict!==!1,t.realpath=!!r.realpath,t.realpathCache=r.realpathCache||Object.create(null),t.follow=!!r.follow,t.dot=!!r.dot,t.mark=!!r.mark,t.nodir=!!r.nodir,t.nodir&&(t.mark=!0),t.sync=!!r.sync,t.nounique=!!r.nounique,t.nonull=!!r.nonull,t.nosort=!!r.nosort,t.nocase=!!r.nocase,t.stat=!!r.stat,t.noprocess=!!r.noprocess,t.absolute=!!r.absolute,t.fs=r.fs||Or,t.maxLength=r.maxLength||1/0,t.cache=r.cache||Object.create(null),t.statCache=r.statCache||Object.create(null),t.symlinks=r.symlinks||Object.create(null),Pr(t,r),t.changedCwd=!1;var i=process.cwd();Ee(r,"cwd")?(t.cwd=V.resolve(r.cwd),t.changedCwd=t.cwd!==i):t.cwd=V.resolve(i),t.root=r.root||V.resolve(t.cwd,"/"),t.root=V.resolve(t.root),t.cwdAbs=be(t.cwd)?t.cwd:tt(t,t.cwd),t.nomount=!!r.nomount,process.platform==="win32"&&(t.root=t.root.replace(/\\/g,"/"),t.cwd=t.cwd.replace(/\\/g,"/"),t.cwdAbs=t.cwdAbs.replace(/\\/g,"/")),r.nonegate=!0,r.nocomment=!0,t.minimatch=new Ot(e,r),t.options=t.minimatch.options}function Fr(t){for(var e=t.nounique,r=e?[]:Object.create(null),i=0,n=t.matches.length;i<n;i++){var s=t.matches[i];if(!s||Object.keys(s).length===0){if(t.nonull){var a=t.minimatch.globSet[i];e?r.push(a):r[a]=!0}}else{var o=Object.keys(s);e?r.push.apply(r,o):o.forEach(function(c){r[c]=!0})}}if(e||(r=Object.keys(r)),t.nosort||(r=r.sort(Ir)),t.mark){for(var i=0;i<r.length;i++)r[i]=t._mark(r[i]);t.nodir&&(r=r.filter(function(c){var u=!/\/$/.test(c),h=t.cache[c]||t.cache[tt(t,c)];return u&&h&&(u=h!=="DIR"&&!Array.isArray(h)),u}))}t.ignore.length&&(r=r.filter(function(c){return!we(t,c)})),t.found=r}function Mr(t,e){var r=tt(t,e),i=t.cache[r],n=e;if(i){var s=i==="DIR"||Array.isArray(i),a=e.slice(-1)==="/";if(s&&!a?n+="/":!s&&a&&(n=n.slice(0,-1)),n!==e){var o=tt(t,n);t.statCache[o]=t.statCache[r],t.cache[o]=t.cache[r]}}return n}function tt(t,e){var r=e;return e.charAt(0)==="/"?r=V.join(t.root,e):be(e)||e===""?r=e:t.changedCwd?r=V.resolve(t.cwd,e):r=V.resolve(e),process.platform==="win32"&&(r=r.replace(/\\/g,"/")),r}function we(t,e){return t.ignore.length?t.ignore.some(function(r){return r.matcher.match(e)||!!(r.gmatcher&&r.gmatcher.match(e))}):!1}function Lr(t,e){return t.ignore.length?t.ignore.some(function(r){return!!(r.gmatcher&&r.gmatcher.match(e))}):!1}});var Ne=O((Fi,ke)=>{ke.exports=Ae;Ae.GlobSync=S;var Rr=vt(),_e=ot(),Pi=_e.Minimatch,Di=Dt().Glob,ji=w("util"),It=w("path"),Se=w("assert"),ct=w("path").isAbsolute,B=Ct(),$r=B.setopts,Pt=B.ownProp,xr=B.childrenIgnored,Gr=B.isIgnored;function Ae(t,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new S(t,e).found}function S(t,e){if(!t)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof S))return new S(t,e);if($r(this,t,e),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var i=0;i<r;i++)this._process(this.minimatch.set[i],i,!1);this._finish()}S.prototype._finish=function(){if(Se.ok(this instanceof S),this.realpath){var t=this;this.matches.forEach(function(e,r){var i=t.matches[r]=Object.create(null);for(var n in e)try{n=t._makeAbs(n);var s=Rr.realpathSync(n,t.realpathCache);i[s]=!0}catch(a){if(a.syscall==="stat")i[t._makeAbs(n)]=!0;else throw a}})}B.finish(this)};S.prototype._process=function(t,e,r){Se.ok(this instanceof S);for(var i=0;typeof t[i]=="string";)i++;var n;switch(i){case t.length:this._processSimple(t.join("/"),e);return;case 0:n=null;break;default:n=t.slice(0,i).join("/");break}var s=t.slice(i),a;n===null?a=".":((ct(n)||ct(t.map(function(u){return typeof u=="string"?u:"[*]"}).join("/")))&&(!n||!ct(n))&&(n="/"+n),a=n);var o=this._makeAbs(a);if(!xr(this,a)){var c=s[0]===_e.GLOBSTAR;c?this._processGlobStar(n,a,o,s,e,r):this._processReaddir(n,a,o,s,e,r)}};S.prototype._processReaddir=function(t,e,r,i,n,s){var a=this._readdir(r,s);if(!!a){for(var o=i[0],c=!!this.minimatch.negate,u=o._glob,h=this.dot||u.charAt(0)===".",d=[],l=0;l<a.length;l++){var f=a[l];if(f.charAt(0)!=="."||h){var p;c&&!t?p=!f.match(o):p=f.match(o),p&&d.push(f)}}var b=d.length;if(b!==0){if(i.length===1&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(var l=0;l<b;l++){var f=d[l];t&&(t.slice(-1)!=="/"?f=t+"/"+f:f=t+f),f.charAt(0)==="/"&&!this.nomount&&(f=It.join(this.root,f)),this._emitMatch(n,f)}return}i.shift();for(var l=0;l<b;l++){var f=d[l],g;t?g=[t,f]:g=[f],this._process(g.concat(i),n,s)}}}};S.prototype._emitMatch=function(t,e){if(!Gr(this,e)){var r=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=r),!this.matches[t][e]){if(this.nodir){var i=this.cache[r];if(i==="DIR"||Array.isArray(i))return}this.matches[t][e]=!0,this.stat&&this._stat(e)}}};S.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var e,r,i;try{r=this.fs.lstatSync(t)}catch(s){if(s.code==="ENOENT")return null}var n=r&&r.isSymbolicLink();return this.symlinks[t]=n,!n&&r&&!r.isDirectory()?this.cache[t]="FILE":e=this._readdir(t,!1),e};S.prototype._readdir=function(t,e){var r;if(e&&!Pt(this.symlinks,t))return this._readdirInGlobStar(t);if(Pt(this.cache,t)){var i=this.cache[t];if(!i||i==="FILE")return null;if(Array.isArray(i))return i}try{return this._readdirEntries(t,this.fs.readdirSync(t))}catch(n){return this._readdirError(t,n),null}};S.prototype._readdirEntries=function(t,e){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];t==="/"?i=t+i:i=t+"/"+i,this.cache[i]=!0}return this.cache[t]=e,e};S.prototype._readdirError=function(t,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(t);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);throw i.path=this.cwd,i.code=e.code,i}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};S.prototype._processGlobStar=function(t,e,r,i,n,s){var a=this._readdir(r,s);if(!!a){var o=i.slice(1),c=t?[t]:[],u=c.concat(o);this._process(u,n,!1);var h=a.length,d=this.symlinks[r];if(!(d&&s))for(var l=0;l<h;l++){var f=a[l];if(!(f.charAt(0)==="."&&!this.dot)){var p=c.concat(a[l],o);this._process(p,n,!0);var b=c.concat(a[l],i);this._process(b,n,!0)}}}};S.prototype._processSimple=function(t,e){var r=this._stat(t);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!r){if(t&&ct(t)&&!this.nomount){var i=/[\/\\]$/.test(t);t.charAt(0)==="/"?t=It.join(this.root,t):(t=It.resolve(this.root,t),i&&(t+="/"))}process.platform==="win32"&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t)}};S.prototype._stat=function(t){var e=this._makeAbs(t),r=t.slice(-1)==="/";if(t.length>this.maxLength)return!1;if(!this.stat&&Pt(this.cache,e)){var a=this.cache[e];if(Array.isArray(a)&&(a="DIR"),!r||a==="DIR")return a;if(r&&a==="FILE")return!1}var i,n=this.statCache[e];if(!n){var s;try{s=this.fs.lstatSync(e)}catch(o){if(o&&(o.code==="ENOENT"||o.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(s&&s.isSymbolicLink())try{n=this.fs.statSync(e)}catch{n=s}else n=s}this.statCache[e]=n;var a=!0;return n&&(a=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||a,r&&a==="FILE"?!1:a};S.prototype._mark=function(t){return B.mark(this,t)};S.prototype._makeAbs=function(t){return B.makeAbs(this,t)}});var jt=O((Mi,Ce)=>{Ce.exports=Oe;function Oe(t,e){if(t&&e)return Oe(t)(e);if(typeof t!="function")throw new TypeError("need wrapper function");return Object.keys(t).forEach(function(i){r[i]=t[i]}),r;function r(){for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];var s=t.apply(this,i),a=i[i.length-1];return typeof s=="function"&&s!==a&&Object.keys(a).forEach(function(o){s[o]=a[o]}),s}}});var Mt=O((Li,Ft)=>{var Ie=jt();Ft.exports=Ie(ut);Ft.exports.strict=Ie(Pe);ut.proto=ut(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return ut(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return Pe(this)},configurable:!0})});function ut(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function Pe(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}});var je=O((Ri,De)=>{var Tr=jt(),et=Object.create(null),qr=Mt();De.exports=Tr(Wr);function Wr(t,e){return et[t]?(et[t].push(e),null):(et[t]=[e],Ur(t))}function Ur(t){return qr(function e(){var r=et[t],i=r.length,n=Vr(arguments);try{for(var s=0;s<i;s++)r[s].apply(null,n)}finally{r.length>i?(r.splice(0,i),process.nextTick(function(){e.apply(null,n)})):delete et[t]}})}function Vr(t){for(var e=t.length,r=[],i=0;i<e;i++)r[i]=t[i];return r}});var Dt=O((Gi,Me)=>{Me.exports=H;var Br=vt(),Fe=ot(),$i=Fe.Minimatch,Hr=ye(),Qr=w("events").EventEmitter,Lt=w("path"),Rt=w("assert"),rt=w("path").isAbsolute,xt=Ne(),Q=Ct(),Yr=Q.setopts,$t=Q.ownProp,Gt=je(),xi=w("util"),Kr=Q.childrenIgnored,zr=Q.isIgnored,Zr=Mt();function H(t,e,r){if(typeof e=="function"&&(r=e,e={}),e||(e={}),e.sync){if(r)throw new TypeError("callback provided to sync glob");return xt(t,e)}return new y(t,e,r)}H.sync=xt;var Xr=H.GlobSync=xt.GlobSync;H.glob=H;function Jr(t,e){if(e===null||typeof e!="object")return t;for(var r=Object.keys(e),i=r.length;i--;)t[r[i]]=e[r[i]];return t}H.hasMagic=function(t,e){var r=Jr({},e);r.noprocess=!0;var i=new y(t,r),n=i.minimatch.set;if(!t)return!1;if(n.length>1)return!0;for(var s=0;s<n[0].length;s++)if(typeof n[0][s]!="string")return!0;return!1};H.Glob=y;Hr(y,Qr);function y(t,e,r){if(typeof e=="function"&&(r=e,e=null),e&&e.sync){if(r)throw new TypeError("callback provided to sync glob");return new Xr(t,e)}if(!(this instanceof y))return new y(t,e,r);Yr(this,t,e),this._didRealPath=!1;var i=this.minimatch.set.length;this.matches=new Array(i),typeof r=="function"&&(r=Zr(r),this.on("error",r),this.on("end",function(c){r(null,c)}));var n=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(i===0)return o();for(var s=!0,a=0;a<i;a++)this._process(this.minimatch.set[a],a,!1,o);s=!1;function o(){--n._processing,n._processing<=0&&(s?process.nextTick(function(){n._finish()}):n._finish())}}y.prototype._finish=function(){if(Rt(this instanceof y),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Q.finish(this),this.emit("end",this.found)}};y.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var t=this.matches.length;if(t===0)return this._finish();for(var e=this,r=0;r<this.matches.length;r++)this._realpathSet(r,i);function i(){--t===0&&e._finish()}};y.prototype._realpathSet=function(t,e){var r=this.matches[t];if(!r)return e();var i=Object.keys(r),n=this,s=i.length;if(s===0)return e();var a=this.matches[t]=Object.create(null);i.forEach(function(o,c){o=n._makeAbs(o),Br.realpath(o,n.realpathCache,function(u,h){u?u.syscall==="stat"?a[o]=!0:n.emit("error",u):a[h]=!0,--s===0&&(n.matches[t]=a,e())})})};y.prototype._mark=function(t){return Q.mark(this,t)};y.prototype._makeAbs=function(t){return Q.makeAbs(this,t)};y.prototype.abort=function(){this.aborted=!0,this.emit("abort")};y.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};y.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var t=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<t.length;e++){var r=t[e];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var i=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<i.length;e++){var n=i[e];this._processing--,this._process(n[0],n[1],n[2],n[3])}}}};y.prototype._process=function(t,e,r,i){if(Rt(this instanceof y),Rt(typeof i=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([t,e,r,i]);return}for(var n=0;typeof t[n]=="string";)n++;var s;switch(n){case t.length:this._processSimple(t.join("/"),e,i);return;case 0:s=null;break;default:s=t.slice(0,n).join("/");break}var a=t.slice(n),o;s===null?o=".":((rt(s)||rt(t.map(function(h){return typeof h=="string"?h:"[*]"}).join("/")))&&(!s||!rt(s))&&(s="/"+s),o=s);var c=this._makeAbs(o);if(Kr(this,o))return i();var u=a[0]===Fe.GLOBSTAR;u?this._processGlobStar(s,o,c,a,e,r,i):this._processReaddir(s,o,c,a,e,r,i)}};y.prototype._processReaddir=function(t,e,r,i,n,s,a){var o=this;this._readdir(r,s,function(c,u){return o._processReaddir2(t,e,r,i,n,s,u,a)})};y.prototype._processReaddir2=function(t,e,r,i,n,s,a,o){if(!a)return o();for(var c=i[0],u=!!this.minimatch.negate,h=c._glob,d=this.dot||h.charAt(0)===".",l=[],f=0;f<a.length;f++){var p=a[f];if(p.charAt(0)!=="."||d){var b;u&&!t?b=!p.match(c):b=p.match(c),b&&l.push(p)}}var g=l.length;if(g===0)return o();if(i.length===1&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(var f=0;f<g;f++){var p=l[f];t&&(t!=="/"?p=t+"/"+p:p=t+p),p.charAt(0)==="/"&&!this.nomount&&(p=Lt.join(this.root,p)),this._emitMatch(n,p)}return o()}i.shift();for(var f=0;f<g;f++){var p=l[f],N;t&&(t!=="/"?p=t+"/"+p:p=t+p),this._process([p].concat(i),n,s,o)}o()};y.prototype._emitMatch=function(t,e){if(!this.aborted&&!zr(this,e)){if(this.paused){this._emitQueue.push([t,e]);return}var r=rt(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=r),!this.matches[t][e]){if(this.nodir){var i=this.cache[r];if(i==="DIR"||Array.isArray(i))return}this.matches[t][e]=!0;var n=this.statCache[r];n&&this.emit("stat",e,n),this.emit("match",e)}}};y.prototype._readdirInGlobStar=function(t,e){if(this.aborted)return;if(this.follow)return this._readdir(t,!1,e);var r="lstat\0"+t,i=this,n=Gt(r,s);n&&i.fs.lstat(t,n);function s(a,o){if(a&&a.code==="ENOENT")return e();var c=o&&o.isSymbolicLink();i.symlinks[t]=c,!c&&o&&!o.isDirectory()?(i.cache[t]="FILE",e()):i._readdir(t,!1,e)}};y.prototype._readdir=function(t,e,r){if(!this.aborted&&(r=Gt("readdir\0"+t+"\0"+e,r),!!r)){if(e&&!$t(this.symlinks,t))return this._readdirInGlobStar(t,r);if($t(this.cache,t)){var i=this.cache[t];if(!i||i==="FILE")return r();if(Array.isArray(i))return r(null,i)}var n=this;n.fs.readdir(t,ti(this,t,r))}};function ti(t,e,r){return function(i,n){i?t._readdirError(e,i,r):t._readdirEntries(e,n,r)}}y.prototype._readdirEntries=function(t,e,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var i=0;i<e.length;i++){var n=e[i];t==="/"?n=t+n:n=t+"/"+n,this.cache[n]=!0}return this.cache[t]=e,r(null,e)}};y.prototype._readdirError=function(t,e,r){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var i=this._makeAbs(t);if(this.cache[i]="FILE",i===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);n.path=this.cwd,n.code=e.code,this.emit("error",n),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:this.cache[this._makeAbs(t)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return r()}};y.prototype._processGlobStar=function(t,e,r,i,n,s,a){var o=this;this._readdir(r,s,function(c,u){o._processGlobStar2(t,e,r,i,n,s,u,a)})};y.prototype._processGlobStar2=function(t,e,r,i,n,s,a,o){if(!a)return o();var c=i.slice(1),u=t?[t]:[],h=u.concat(c);this._process(h,n,!1,o);var d=this.symlinks[r],l=a.length;if(d&&s)return o();for(var f=0;f<l;f++){var p=a[f];if(!(p.charAt(0)==="."&&!this.dot)){var b=u.concat(a[f],c);this._process(b,n,!0,o);var g=u.concat(a[f],i);this._process(g,n,!0,o)}}o()};y.prototype._processSimple=function(t,e,r){var i=this;this._stat(t,function(n,s){i._processSimple2(t,e,n,s,r)})};y.prototype._processSimple2=function(t,e,r,i,n){if(this.matches[e]||(this.matches[e]=Object.create(null)),!i)return n();if(t&&rt(t)&&!this.nomount){var s=/[\/\\]$/.test(t);t.charAt(0)==="/"?t=Lt.join(this.root,t):(t=Lt.resolve(this.root,t),s&&(t+="/"))}process.platform==="win32"&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t),n()};y.prototype._stat=function(t,e){var r=this._makeAbs(t),i=t.slice(-1)==="/";if(t.length>this.maxLength)return e();if(!this.stat&&$t(this.cache,r)){var n=this.cache[r];if(Array.isArray(n)&&(n="DIR"),!i||n==="DIR")return e(null,n);if(i&&n==="FILE")return e()}var s,a=this.statCache[r];if(a!==void 0){if(a===!1)return e(null,a);var o=a.isDirectory()?"DIR":"FILE";return i&&o==="FILE"?e():e(null,o,a)}var c=this,u=Gt("stat\0"+r,h);u&&c.fs.lstat(r,u);function h(d,l){if(l&&l.isSymbolicLink())return c.fs.stat(r,function(f,p){f?c._stat2(t,r,null,l,e):c._stat2(t,r,f,p,e)});c._stat2(t,r,d,l,e)}};y.prototype._stat2=function(t,e,r,i,n){if(r&&(r.code==="ENOENT"||r.code==="ENOTDIR"))return this.statCache[e]=!1,n();var s=t.slice(-1)==="/";if(this.statCache[e]=i,e.slice(-1)==="/"&&i&&!i.isDirectory())return n(null,!1,i);var a=!0;return i&&(a=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||a,s&&a==="FILE"?n():n(null,a,i)}});var pi={};tr(pi,{default:()=>fi});var Y=w("@yarnpkg/core");var A=w("@yarnpkg/core"),W=w("@yarnpkg/fslib"),_=".yarn-scripts-cache-rc.json";async function st(t,e){let r=W.ppath.join(t,(0,W.toFilename)(_));if(await W.xfs.existsPromise(r)){let i=await W.xfs.readFilePromise(r,"utf-8");try{let n=JSON.parse(i);if(rr(n,e))return n}catch(n){e.reportErrorOnce(A.MessageName.EXCEPTION,`${_} is not valid:`),e.reportExceptionOnce(n)}}}function rr(t,e){return typeof t!="object"?(e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config is not an object!`),!1):Array.isArray(t.scriptsToCache)?t.scriptsToCache.find(r=>typeof r!="object")!==void 0?(e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache should only contain objects!`),!1):t.scriptsToCache.find(r=>!ir(r,e))!==void 0?!1:t.cacheDisabled!==void 0&&typeof t.cacheDisabled!="boolean"?(e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.cacheDisabled should be a boolean!`),!1):t.cacheConfigs&&typeof t.cacheConfigs!="object"?(e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.cacheConfigs should be an object!`),!1):!0:(e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache is not an array!`),!1)}function ir(t,e){if(typeof t.scriptName!="string")return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.scriptName is no string!`),!1;if(t.inputIncludes!==void 0&&typeof t.inputIncludes!="string"){if(!Array.isArray(t.inputIncludes))return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.inputIncludes for ${t.scriptName} is not an array!`),!1;if(t.inputIncludes.find(r=>typeof r!="string")!==void 0)return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.inputIncludes for ${t.scriptName} should only contain strings!`),!1}if(t.inputExcludes!==void 0&&typeof t.inputExcludes!="string"){if(!Array.isArray(t.inputExcludes))return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.inputExcludes for ${t.scriptName} is not an array!`),!1;if(t.inputExcludes.find(r=>typeof r!="string")!==void 0)return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.inputExcludes for ${t.scriptName} should only contain strings!`),!1}if(t.outputIncludes!==void 0&&typeof t.outputIncludes!="string"){if(!Array.isArray(t.outputIncludes))return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.outputIncludes for ${t.scriptName} is not an array!`),!1;if(t.outputIncludes.find(r=>typeof r!="string")!==void 0)return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.outputIncludes for ${t.scriptName} should only contain strings!`),!1}if(t.outputExcludes!==void 0&&typeof t.outputExcludes!="string"){if(!Array.isArray(t.outputExcludes))return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.outputExcludes for ${t.scriptName} is not an array!`),!1;if(t.outputExcludes.find(r=>typeof r!="string")!==void 0)return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.outputExcludes for ${t.scriptName} should only contain strings!`),!1}if(t.environmentVariableIncludes!==void 0&&typeof t.environmentVariableIncludes!="string"){if(!Array.isArray(t.environmentVariableIncludes))return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.environmentVariableIncludes for ${t.scriptName} is not an array!`),!1;if(t.environmentVariableIncludes.find(r=>typeof r!="string")!==void 0)return e.reportError(A.MessageName.UNNAMED,`${_} is not valid: config.scriptsToCache.environmentVariableIncludes for ${t.scriptName} should only contain strings!`),!1}return!0}async function Bt(t,e){let r=e.project.configuration,i=[];return await r.triggerHook(n=>n.beforeYarnScriptsCacheUsage,i,t,e),i.sort((n,s)=>n.order-s.order)}var Le=w("@yarnpkg/core"),k=w("@yarnpkg/fslib"),Re=ht(w("crypto")),qt=ht(Dt()),$e=ht(w("os"));async function xe(t,e,r,i,n,s){let a=await Te(t,e,r,i,n);if(!a)return;let o=await ni(r.cwd,i),c={key:a,value:o};for(let u of s)await u.saveCacheEntry(c)}async function Ge(t,e,r,i,n,s){let a=await Te(t,e,r,i,n);if(!!a)for(let o of s){let c=await o.loadCacheEntry(a);if(c)return await si(r.cwd,c.value),[c,o]}}async function Te(t,e,r,i,n){let s=r.script,a=r.args,o=t.lockFileChecksum,c=Tt(t.topLevelWorkspace.locator),u=Tt(e),h=await qe(r.cwd,i.inputIncludes,i.inputExcludes),d=await ri(t,e,n),l=ei(r,i);if(!!d)return{script:s,args:a,lockFileChecksum:o,topLevelWorkspaceLocator:c,workspaceLocator:u,globFileHashes:h,dependencyWorkspacesGlobFileHashes:d,environmentVariables:l}}function ei(t,e){let r={};for(let i of it(e.environmentVariableIncludes)){let n={},s=new RegExp(i);for(let[a,o]of Object.entries(t.env))s.test(a)&&(n[a]=o);r[i]=n}return r}async function ri(t,e,r){let i={},n=t.getWorkspaceByLocator(e);for(let s of n.getRecursiveWorkspaceDependencies()){let a=Tt(s.locator),o=await st(s.cwd,r);if(!o){r.reportError(Le.MessageName.UNNAMED,`Did not find a valid ${_} in workspace ${a}. All workspaces you depend on also need to be cachable!`);return}let c={};for(let u of o.scriptsToCache)c[u.scriptName]=await qe(s.cwd,u.outputIncludes,u.outputExcludes);i[a]=c}return i}async function qe(t,e,r){let i={};for(let n of it(e)){let s=k.npath.fromPortablePath(t),a=qt.glob.sync(n,{cwd:s,ignore:it(r)}),o={};for(let c of a){let u=k.npath.toPortablePath(c),h=k.ppath.resolve(t,u);(await k.xfs.statPromise(h)).isFile()&&(o[u]=await ii(h))}i[n]=o}return i}async function ii(t){let e=Re.default.createHash("sha512"),r=await k.xfs.readFilePromise(t,"base64");return e.update(r),e.digest("base64")}async function ni(t,e){let r={};for(let s of it(e.outputIncludes)){let a=k.npath.fromPortablePath(t),o=qt.glob.sync(s,{cwd:a,ignore:it(e.outputExcludes)}),c={};for(let u of o){let h=k.npath.toPortablePath(u),d=k.ppath.resolve(t,h);(await k.xfs.statPromise(d)).isFile()&&(c[h]=await k.xfs.readFilePromise(d,"base64"))}r[s]=c}let i=Date.now(),n=$e.default.hostname();return{globFileContents:r,createdAt:i,createdBy:n}}async function si(t,e){for(let r of Object.values(e.globFileContents))for(let[i,n]of Object.entries(r)){let s=k.ppath.join(t,i),a=k.ppath.dirname(s);await k.xfs.mkdirPromise(a,{recursive:!0}),await k.xfs.writeFilePromise(s,n,{encoding:"base64"})}}function Tt(t){return t.scope?`${t.scope}/${t.name}@${t.reference}`:`${t.name}@${t.reference}`}function it(t){return t===void 0?[]:typeof t=="string"?[t]:t}var ai="YSC_DISABLED",oi="YSC_READ_DISABLED",ci="YSC_WRITE_DISABLED";function We(t){return Wt(t,ai,"cacheDisabled")}function Ue(t){return Wt(t,oi,"cacheReadDisabled")}function Ve(t){return Wt(t,ci,"cacheWriteDisabled")}function Wt(t,e,r){let i=process.env[e];return typeof i=="string"?i==="true":t[r]||!1}async function ui(t){let e=Y.Configuration.create(t.cwd);return Y.StreamReport.start({configuration:e,includeFooter:!1,stdout:t.stdout},async()=>{})}var li=async(t,e,r,i,n)=>{let s=await ui(n),a=await st(n.cwd,s);if(!a||We(a))return t;let o=a.scriptsToCache.find(u=>u.scriptName===i);if(!o)return t;let c=await Bt(a,{project:e,locator:r,scriptName:i,extra:n});return c.length===0&&s.reportError(Y.MessageName.UNNAMED,"Script was configured to be cached but no cache implementation was found! Please make sure to add cache implementations via their own plugin."),async()=>{if(!Ue(a)){let h=await Ge(e,r,n,o,s,c);if(h){let[d,l]=h,f=new Date(d.value.createdAt).toUTCString(),p=d.value.createdBy;return s.reportInfo(Y.MessageName.UNNAMED,`Script execution result was restored from ${l.name} cache! Created ${f} by ${p}`),Promise.resolve(0)}}let u=await t();return u===0&&!Ve(a)&&await s.startTimerPromise("Updating script execution result cache",async()=>{await xe(e,r,n,o,s,c)}),u}},hi={hooks:{wrapScriptExecution:li}},fi=hi;return er(pi);})();
return plugin;
}
};
