/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-scripts-cache",
factory: function (require) {
"use strict";var plugin=(()=>{var Br=Object.create;var ts=Object.defineProperty;var Ur=Object.getOwnPropertyDescriptor;var zr=Object.getOwnPropertyNames;var Gr=Object.getPrototypeOf,Hr=Object.prototype.hasOwnProperty;var Vr=(r,t,e)=>t in r?ts(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var X=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var En=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),qr=(r,t)=>{for(var e in t)ts(r,e,{get:t[e],enumerable:!0})},vn=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of zr(t))!Hr.call(r,n)&&n!==e&&ts(r,n,{get:()=>t[n],enumerable:!(s=Ur(t,n))||s.enumerable});return r};var es=(r,t,e)=>(e=r!=null?Br(Gr(r)):{},vn(t||!r||!r.__esModule?ts(e,"default",{value:r,enumerable:!0}):e,r)),Kr=r=>vn(ts({},"__esModule",{value:!0}),r);var N=(r,t,e)=>(Vr(r,typeof t!="symbol"?t+"":t,e),e),Bi=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var i=(r,t,e)=>(Bi(r,t,"read from private field"),e?e.call(r):t.get(r)),d=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},f=(r,t,e,s)=>(Bi(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e),ai=(r,t,e,s)=>({set _(n){f(r,t,n,e)},get _(){return i(r,t,s)}}),g=(r,t,e)=>(Bi(r,t,"access private method"),e);var kn=En((Rh,Tn)=>{"use strict";Tn.exports=An;function An(r,t,e){r instanceof RegExp&&(r=Cn(r,e)),t instanceof RegExp&&(t=Cn(t,e));var s=Nn(r,t,e);return s&&{start:s[0],end:s[1],pre:e.slice(0,s[0]),body:e.slice(s[0]+r.length,s[1]),post:e.slice(s[1]+t.length)}}function Cn(r,t){var e=t.match(r);return e?e[0]:null}An.range=Nn;function Nn(r,t,e){var s,n,o,h,a,l=e.indexOf(r),c=e.indexOf(t,l+1),u=l;if(l>=0&&c>0){if(r===t)return[l,c];for(s=[],o=e.length;u>=0&&!a;)u==l?(s.push(u),l=e.indexOf(r,u+1)):s.length==1?a=[s.pop(),c]:(n=s.pop(),n<o&&(o=n,h=c),c=e.indexOf(t,u+1)),u=l<c&&l>=0?l:c;s.length&&(a=[o,h])}return a}});var Ln=En((Oh,Pn)=>{var Fn=kn();Pn.exports=Qr;var Dn="\0SLASH"+Math.random()+"\0",Rn="\0OPEN"+Math.random()+"\0",zi="\0CLOSE"+Math.random()+"\0",On="\0COMMA"+Math.random()+"\0",Mn="\0PERIOD"+Math.random()+"\0";function Ui(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function Xr(r){return r.split("\\\\").join(Dn).split("\\{").join(Rn).split("\\}").join(zi).split("\\,").join(On).split("\\.").join(Mn)}function Zr(r){return r.split(Dn).join("\\").split(Rn).join("{").split(zi).join("}").split(On).join(",").split(Mn).join(".")}function In(r){if(!r)return[""];var t=[],e=Fn("{","}",r);if(!e)return r.split(",");var s=e.pre,n=e.body,o=e.post,h=s.split(",");h[h.length-1]+="{"+n+"}";var a=In(o);return o.length&&(h[h.length-1]+=a.shift(),h.push.apply(h,a)),t.push.apply(t,h),t}function Qr(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),ss(Xr(r),!0).map(Zr)):[]}function to(r){return"{"+r+"}"}function eo(r){return/^-?0\d/.test(r)}function so(r,t){return r<=t}function io(r,t){return r>=t}function ss(r,t){var e=[],s=Fn("{","}",r);if(!s)return[r];var n=s.pre,o=s.post.length?ss(s.post,!1):[""];if(/\$$/.test(s.pre))for(var h=0;h<o.length;h++){var a=n+"{"+s.body+"}"+o[h];e.push(a)}else{var l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),u=l||c,p=s.body.indexOf(",")>=0;if(!u&&!p)return s.post.match(/,.*\}/)?(r=s.pre+"{"+s.body+zi+s.post,ss(r)):[r];var m;if(u)m=s.body.split(/\.\./);else if(m=In(s.body),m.length===1&&(m=ss(m[0],!1).map(to),m.length===1))return o.map(function(hi){return s.pre+m[0]+hi});var b;if(u){var E=Ui(m[0]),w=Ui(m[1]),S=Math.max(m[0].length,m[1].length),y=m.length==3?Math.abs(Ui(m[2])):1,v=so,A=w<E;A&&(y*=-1,v=io);var T=m.some(eo);b=[];for(var k=E;v(k,w);k+=y){var I;if(c)I=String.fromCharCode(k),I==="\\"&&(I="");else if(I=String(k),T){var gt=S-I.length;if(gt>0){var oi=new Array(gt+1).join("0");k<0?I="-"+oi+I.slice(1):I=oi+I}}b.push(I)}}else{b=[];for(var Ft=0;Ft<m.length;Ft++)b.push.apply(b,ss(m[Ft],!1))}for(var Ft=0;Ft<b.length;Ft++)for(var h=0;h<o.length;h++){var a=n+b[Ft]+o[h];(!t||u||a)&&e.push(a)}}return e}});var Ah={};qr(Ah,{default:()=>Ch});var _t=X("@yarnpkg/core");var B=X("@yarnpkg/core"),ce=X("@yarnpkg/fslib"),P=".yarn-scripts-cache-rc.json";async function li(r,t){let e=ce.ppath.join(r,(0,ce.toFilename)(P));if(await ce.xfs.existsPromise(e)){let s=await ce.xfs.readFilePromise(e,"utf-8");try{let n=JSON.parse(s.toString());if(Yr(n,t))return n}catch(n){t.reportErrorOnce(B.MessageName.EXCEPTION,`${P} is not valid:`),t.reportExceptionOnce(n)}}}function Yr(r,t){return typeof r!="object"?(t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config is not an object!`),!1):Array.isArray(r.scriptsToCache)?r.scriptsToCache.find(e=>typeof e!="object")!==void 0?(t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache should only contain objects!`),!1):r.scriptsToCache.find(e=>!Jr(e,t))!==void 0?!1:r.cacheDisabled!==void 0&&typeof r.cacheDisabled!="boolean"?(t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.cacheDisabled should be a boolean!`),!1):r.cacheConfigs&&typeof r.cacheConfigs!="object"?(t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.cacheConfigs should be an object!`),!1):!0:(t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache is not an array!`),!1)}function Jr(r,t){if(typeof r.scriptName!="string")return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.scriptName is no string!`),!1;if(r.inputIncludes!==void 0&&typeof r.inputIncludes!="string"){if(!Array.isArray(r.inputIncludes))return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.inputIncludes for ${r.scriptName} is not an array!`),!1;if(r.inputIncludes.find(e=>typeof e!="string")!==void 0)return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.inputIncludes for ${r.scriptName} should only contain strings!`),!1}if(r.inputExcludes!==void 0&&typeof r.inputExcludes!="string"){if(!Array.isArray(r.inputExcludes))return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.inputExcludes for ${r.scriptName} is not an array!`),!1;if(r.inputExcludes.find(e=>typeof e!="string")!==void 0)return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.inputExcludes for ${r.scriptName} should only contain strings!`),!1}if(r.outputIncludes!==void 0&&typeof r.outputIncludes!="string"){if(!Array.isArray(r.outputIncludes))return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.outputIncludes for ${r.scriptName} is not an array!`),!1;if(r.outputIncludes.find(e=>typeof e!="string")!==void 0)return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.outputIncludes for ${r.scriptName} should only contain strings!`),!1}if(r.outputExcludes!==void 0&&typeof r.outputExcludes!="string"){if(!Array.isArray(r.outputExcludes))return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.outputExcludes for ${r.scriptName} is not an array!`),!1;if(r.outputExcludes.find(e=>typeof e!="string")!==void 0)return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.outputExcludes for ${r.scriptName} should only contain strings!`),!1}if(r.environmentVariableIncludes!==void 0&&typeof r.environmentVariableIncludes!="string"){if(!Array.isArray(r.environmentVariableIncludes))return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.environmentVariableIncludes for ${r.scriptName} is not an array!`),!1;if(r.environmentVariableIncludes.find(e=>typeof e!="string")!==void 0)return t.reportError(B.MessageName.UNNAMED,`${P} is not valid: config.scriptsToCache.environmentVariableIncludes for ${r.scriptName} should only contain strings!`),!1}return!0}async function xn(r,t){let e=t.project.configuration,s=[];return await e.triggerHook(n=>n.beforeYarnScriptsCacheUsage,s,r,t),s.sort((n,o)=>n.order-o.order)}var Rr=X("@yarnpkg/core"),J=X("@yarnpkg/fslib"),Or=es(X("crypto"));var Vn=es(Ln(),1);var is=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")};var no={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},ns=r=>r.replace(/[[\]\\-]/g,"\\$&"),ro=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),_n=r=>r.join(""),Wn=(r,t)=>{let e=t;if(r.charAt(e)!=="[")throw new Error("not in a brace expression");let s=[],n=[],o=e+1,h=!1,a=!1,l=!1,c=!1,u=e,p="";t:for(;o<r.length;){let w=r.charAt(o);if((w==="!"||w==="^")&&o===e+1){c=!0,o++;continue}if(w==="]"&&h&&!l){u=o+1;break}if(h=!0,w==="\\"&&!l){l=!0,o++;continue}if(w==="["&&!l){for(let[S,[y,v,A]]of Object.entries(no))if(r.startsWith(S,o)){if(p)return["$.",!1,r.length-e,!0];o+=S.length,A?n.push(y):s.push(y),a=a||v;continue t}}if(l=!1,p){w>p?s.push(ns(p)+"-"+ns(w)):w===p&&s.push(ns(w)),p="",o++;continue}if(r.startsWith("-]",o+1)){s.push(ns(w+"-")),o+=2;continue}if(r.startsWith("-",o+1)){p=w,o+=2;continue}s.push(ns(w)),o++}if(u<o)return["",!1,0,!1];if(!s.length&&!n.length)return["$.",!1,r.length-e,!0];if(n.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!c){let w=s[0].length===2?s[0].slice(-1):s[0];return[ro(w),!1,u-e,!1]}let m="["+(c?"^":"")+_n(s)+"]",b="["+(c?"":"^")+_n(n)+"]";return[s.length&&n.length?"("+m+"|"+b+")":s.length?m:b,a,u-e,!0]};var wt=(r,{windowsPathsNoEscape:t=!1}={})=>t?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var oo=new Set(["!","?","+","*","@"]),jn=r=>oo.has(r),ho="(?!(?:^|/)\\.\\.?(?:$|/))",ci="(?!\\.)",ao=new Set(["[","."]),lo=new Set(["..","."]),co=new Set("().*{}+?[]^$\\!"),fo=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Hi="[^/]",$n=Hi+"*?",Bn=Hi+"+?",_,U,Wt,R,L,Jt,fe,Xt,jt,ue,rs,ui,Un,Te,fi,os,Gi,di,zn,ot=class{constructor(t,e,s={}){d(this,ui);d(this,os);N(this,"type");d(this,_,void 0);d(this,U,void 0);d(this,Wt,!1);d(this,R,[]);d(this,L,void 0);d(this,Jt,void 0);d(this,fe,void 0);d(this,Xt,!1);d(this,jt,void 0);d(this,ue,void 0);d(this,rs,!1);this.type=t,t&&f(this,U,!0),f(this,L,e),f(this,_,i(this,L)?i(i(this,L),_):this),f(this,jt,i(this,_)===this?s:i(i(this,_),jt)),f(this,fe,i(this,_)===this?[]:i(i(this,_),fe)),t==="!"&&!i(i(this,_),Xt)&&i(this,fe).push(this),f(this,Jt,i(this,L)?i(i(this,L),R).length:0)}get hasMagic(){if(i(this,U)!==void 0)return i(this,U);for(let t of i(this,R))if(typeof t!="string"&&(t.type||t.hasMagic))return f(this,U,!0);return i(this,U)}toString(){return i(this,ue)!==void 0?i(this,ue):this.type?f(this,ue,this.type+"("+i(this,R).map(t=>String(t)).join("|")+")"):f(this,ue,i(this,R).map(t=>String(t)).join(""))}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof ot&&i(e,L)===this))throw new Error("invalid part: "+e);i(this,R).push(e)}}toJSON(){var e;let t=this.type===null?i(this,R).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...i(this,R).map(s=>s.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===i(this,_)||i(i(this,_),Xt)&&((e=i(this,L))==null?void 0:e.type)==="!")&&t.push({}),t}isStart(){var e;if(i(this,_)===this)return!0;if(!((e=i(this,L))!=null&&e.isStart()))return!1;if(i(this,Jt)===0)return!0;let t=i(this,L);for(let s=0;s<i(this,Jt);s++){let n=i(t,R)[s];if(!(n instanceof ot&&n.type==="!"))return!1}return!0}isEnd(){var e,s,n;if(i(this,_)===this||((e=i(this,L))==null?void 0:e.type)==="!")return!0;if(!((s=i(this,L))!=null&&s.isEnd()))return!1;if(!this.type)return(n=i(this,L))==null?void 0:n.isEnd();let t=i(this,L)?i(i(this,L),R).length:0;return i(this,Jt)===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new ot(this.type,t);for(let s of i(this,R))e.copyIn(s);return e}static fromGlob(t,e={}){var n;let s=new ot(null,void 0,e);return g(n=ot,Te,fi).call(n,t,s,0,e),s}toMMPattern(){if(this!==i(this,_))return i(this,_).toMMPattern();let t=this.toString(),[e,s,n,o]=this.toRegExpSource();if(!(n||i(this,U)||i(this,jt).nocase&&!i(this,jt).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;let a=(i(this,jt).nocase?"i":"")+(o?"u":"");return Object.assign(new RegExp(`^${e}$`,a),{_src:e,_glob:t})}toRegExpSource(t){var l;let e=t!=null?t:!!i(this,jt).dot;if(i(this,_)===this&&g(this,ui,Un).call(this),!this.type){let c=this.isStart()&&this.isEnd(),u=i(this,R).map(E=>{var A;let[w,S,y,v]=typeof E=="string"?g(A=ot,di,zn).call(A,E,i(this,U),c):E.toRegExpSource(t);return f(this,U,i(this,U)||y),f(this,Wt,i(this,Wt)||v),w}).join(""),p="";if(this.isStart()&&typeof i(this,R)[0]=="string"&&!(i(this,R).length===1&&lo.has(i(this,R)[0]))){let w=ao,S=e&&w.has(u.charAt(0))||u.startsWith("\\.")&&w.has(u.charAt(2))||u.startsWith("\\.\\.")&&w.has(u.charAt(4)),y=!e&&!t&&w.has(u.charAt(0));p=S?ho:y?ci:""}let m="";return this.isEnd()&&i(i(this,_),Xt)&&((l=i(this,L))==null?void 0:l.type)==="!"&&(m="(?:$|\\/)"),[p+u+m,wt(u),f(this,U,!!i(this,U)),i(this,Wt)]}let s=this.type==="*"||this.type==="+",n=this.type==="!"?"(?:(?!(?:":"(?:",o=g(this,os,Gi).call(this,e);if(this.isStart()&&this.isEnd()&&!o&&this.type!=="!"){let c=this.toString();return f(this,R,[c]),this.type=null,f(this,U,void 0),[c,wt(this.toString()),!1,!1]}let h=!s||t||e||!ci?"":g(this,os,Gi).call(this,!0);h===o&&(h=""),h&&(o=`(?:${o})(?:${h})*?`);let a="";if(this.type==="!"&&i(this,rs))a=(this.isStart()&&!e?ci:"")+Bn;else{let c=this.type==="!"?"))"+(this.isStart()&&!e&&!t?ci:"")+$n+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&h?")":this.type==="*"&&h?")?":`)${this.type}`;a=n+o+c}return[a,wt(o),f(this,U,!!i(this,U)),i(this,Wt)]}},Zt=ot;_=new WeakMap,U=new WeakMap,Wt=new WeakMap,R=new WeakMap,L=new WeakMap,Jt=new WeakMap,fe=new WeakMap,Xt=new WeakMap,jt=new WeakMap,ue=new WeakMap,rs=new WeakMap,ui=new WeakSet,Un=function(){if(this!==i(this,_))throw new Error("should only call on root");if(i(this,Xt))return this;this.toString(),f(this,Xt,!0);let t;for(;t=i(this,fe).pop();){if(t.type!=="!")continue;let e=t,s=i(e,L);for(;s;){for(let n=i(e,Jt)+1;!s.type&&n<i(s,R).length;n++)for(let o of i(t,R)){if(typeof o=="string")throw new Error("string part in extglob AST??");o.copyIn(i(s,R)[n])}e=s,s=i(e,L)}}return this},Te=new WeakSet,fi=function(t,e,s,n){var b,E;let o=!1,h=!1,a=-1,l=!1;if(e.type===null){let w=s,S="";for(;w<t.length;){let y=t.charAt(w++);if(o||y==="\\"){o=!o,S+=y;continue}if(h){w===a+1?(y==="^"||y==="!")&&(l=!0):y==="]"&&!(w===a+2&&l)&&(h=!1),S+=y;continue}else if(y==="["){h=!0,a=w,l=!1,S+=y;continue}if(!n.noext&&jn(y)&&t.charAt(w)==="("){e.push(S),S="";let v=new ot(y,e);w=g(b=ot,Te,fi).call(b,t,v,w,n),e.push(v);continue}S+=y}return e.push(S),w}let c=s+1,u=new ot(null,e),p=[],m="";for(;c<t.length;){let w=t.charAt(c++);if(o||w==="\\"){o=!o,m+=w;continue}if(h){c===a+1?(w==="^"||w==="!")&&(l=!0):w==="]"&&!(c===a+2&&l)&&(h=!1),m+=w;continue}else if(w==="["){h=!0,a=c,l=!1,m+=w;continue}if(jn(w)&&t.charAt(c)==="("){u.push(m),m="";let S=new ot(w,u);u.push(S),c=g(E=ot,Te,fi).call(E,t,S,c,n);continue}if(w==="|"){u.push(m),m="",p.push(u),u=new ot(null,e);continue}if(w===")")return m===""&&i(e,R).length===0&&f(e,rs,!0),u.push(m),m="",e.push(...p,u),c;m+=w}return e.type=null,f(e,U,void 0),f(e,R,[t.substring(s-1)]),c},os=new WeakSet,Gi=function(t){return i(this,R).map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[s,n,o,h]=e.toRegExpSource(t);return f(this,Wt,i(this,Wt)||h),s}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")},di=new WeakSet,zn=function(t,e,s=!1){let n=!1,o="",h=!1;for(let a=0;a<t.length;a++){let l=t.charAt(a);if(n){n=!1,o+=(co.has(l)?"\\":"")+l;continue}if(l==="\\"){a===t.length-1?o+="\\\\":n=!0;continue}if(l==="["){let[c,u,p,m]=Wn(t,a);if(p){o+=c,h=h||u,a+=p-1,e=e||m;continue}}if(l==="*"){s&&t==="*"?o+=Bn:o+=$n,e=!0;continue}if(l==="?"){o+=Hi,e=!0;continue}o+=fo(l)}return[o,wt(t),!!e,h]},d(Zt,Te),d(Zt,di);var ke=(r,{windowsPathsNoEscape:t=!1}={})=>t?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&");var et=(r,t,e={})=>(is(t),!e.nocomment&&t.charAt(0)==="#"?!1:new ht(t,e).match(r)),uo=/^\*+([^+@!?\*\[\(]*)$/,po=r=>t=>!t.startsWith(".")&&t.endsWith(r),mo=r=>t=>t.endsWith(r),go=r=>(r=r.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(r)),wo=r=>(r=r.toLowerCase(),t=>t.toLowerCase().endsWith(r)),yo=/^\*+\.\*+$/,bo=r=>!r.startsWith(".")&&r.includes("."),So=r=>r!=="."&&r!==".."&&r.includes("."),Eo=/^\.\*+$/,vo=r=>r!=="."&&r!==".."&&r.startsWith("."),xo=/^\*+$/,Co=r=>r.length!==0&&!r.startsWith("."),Ao=r=>r.length!==0&&r!=="."&&r!=="..",No=/^\?+([^+@!?\*\[\(]*)?$/,To=([r,t=""])=>{let e=qn([r]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},ko=([r,t=""])=>{let e=Kn([r]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},Fo=([r,t=""])=>{let e=Kn([r]);return t?s=>e(s)&&s.endsWith(t):e},Do=([r,t=""])=>{let e=qn([r]);return t?s=>e(s)&&s.endsWith(t):e},qn=([r])=>{let t=r.length;return e=>e.length===t&&!e.startsWith(".")},Kn=([r])=>{let t=r.length;return e=>e.length===t&&e!=="."&&e!==".."},Yn=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Gn={win32:{sep:"\\"},posix:{sep:"/"}},Ro=Yn==="win32"?Gn.win32.sep:Gn.posix.sep;et.sep=Ro;var Y=Symbol("globstar **");et.GLOBSTAR=Y;var Oo="[^/]",Mo=Oo+"*?",Io="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Po="(?:(?!(?:\\/|^)\\.).)*?",Lo=(r,t={})=>e=>et(e,r,t);et.filter=Lo;var dt=(r,t={})=>Object.assign({},r,t),_o=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return et;let t=et;return Object.assign((s,n,o={})=>t(s,n,dt(r,o)),{Minimatch:class extends t.Minimatch{constructor(n,o={}){super(n,dt(r,o))}static defaults(n){return t.defaults(dt(r,n)).Minimatch}},AST:class extends t.AST{constructor(n,o,h={}){super(n,o,dt(r,h))}static fromGlob(n,o={}){return t.AST.fromGlob(n,dt(r,o))}},unescape:(s,n={})=>t.unescape(s,dt(r,n)),escape:(s,n={})=>t.escape(s,dt(r,n)),filter:(s,n={})=>t.filter(s,dt(r,n)),defaults:s=>t.defaults(dt(r,s)),makeRe:(s,n={})=>t.makeRe(s,dt(r,n)),braceExpand:(s,n={})=>t.braceExpand(s,dt(r,n)),match:(s,n,o={})=>t.match(s,n,dt(r,o)),sep:t.sep,GLOBSTAR:Y})};et.defaults=_o;var Jn=(r,t={})=>(is(r),t.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:(0,Vn.default)(r));et.braceExpand=Jn;var Wo=(r,t={})=>new ht(r,t).makeRe();et.makeRe=Wo;var jo=(r,t,e={})=>{let s=new ht(t,e);return r=r.filter(n=>s.match(n)),s.options.nonull&&!r.length&&r.push(t),r};et.match=jo;var Hn=/[?*]|[+@!]\(.*?\)|\[|\]/,$o=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ht=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){is(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||Yn,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...o)=>console.error(...o)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(o=>this.slashSplit(o));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let n=this.globParts.map((o,h,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){let l=o[0]===""&&o[1]===""&&(o[2]==="?"||!Hn.test(o[2]))&&!Hn.test(o[3]),c=/^[a-z]:/i.test(o[0]);if(l)return[...o.slice(0,4),...o.slice(4).map(u=>this.parse(u))];if(c)return[o[0],...o.slice(1).map(u=>this.parse(u))]}return o.map(l=>this.parse(l))});if(this.debug(this.pattern,n),this.set=n.filter(o=>o.indexOf(!1)===-1),this.isWindows)for(let o=0;o<this.set.length;o++){let h=this.set[o];h[0]===""&&h[1]===""&&this.globParts[o][2]==="?"&&typeof h[3]=="string"&&/^[a-z]:$/i.test(h[3])&&(h[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]==="**"&&(t[s][n]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let s=-1;for(;(s=e.indexOf("**",s+1))!==-1;){let n=s;for(;e[n+1]==="**";)n++;n!==s&&e.splice(s,n-s)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((s,n)=>{let o=s[s.length-1];return n==="**"&&o==="**"?s:n===".."&&o&&o!==".."&&o!=="."&&o!=="**"?(s.pop(),s):(s.push(n),s)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let n=1;n<t.length-1;n++){let o=t[n];n===1&&o===""&&t[0]===""||(o==="."||o==="")&&(e=!0,t.splice(n,1),n--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let s=0;for(;(s=t.indexOf("..",s+1))!==-1;){let n=t[s-1];n&&n!=="."&&n!==".."&&n!=="**"&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let n=-1;for(;(n=s.indexOf("**",n+1))!==-1;){let h=n;for(;s[h+1]==="**";)h++;h>n&&s.splice(n+1,h-n);let a=s[n+1],l=s[n+2],c=s[n+3];if(a!==".."||!l||l==="."||l===".."||!c||c==="."||c==="..")continue;e=!0,s.splice(n,1);let u=s.slice(0);u[n]="**",t.push(u),n--}if(!this.preserveMultipleSlashes){for(let h=1;h<s.length-1;h++){let a=s[h];h===1&&a===""&&s[0]===""||(a==="."||a==="")&&(e=!0,s.splice(h,1),h--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(e=!0,s.pop())}let o=0;for(;(o=s.indexOf("..",o+1))!==-1;){let h=s[o-1];if(h&&h!=="."&&h!==".."&&h!=="**"){e=!0;let l=o===1&&s[o+1]==="**"?["."]:[];s.splice(o-1,2,...l),s.length===0&&s.push(""),o-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){let n=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);!n||(t[e]=n,t[s]=[])}return t.filter(e=>e.length)}partsMatch(t,e,s=!1){let n=0,o=0,h=[],a="";for(;n<t.length&&o<e.length;)if(t[n]===e[o])h.push(a==="b"?e[o]:t[n]),n++,o++;else if(s&&t[n]==="**"&&e[o]===t[n+1])h.push(t[n]),n++;else if(s&&e[o]==="**"&&t[n]===e[o+1])h.push(e[o]),o++;else if(t[n]==="*"&&e[o]&&(this.options.dot||!e[o].startsWith("."))&&e[o]!=="**"){if(a==="b")return!1;a="a",h.push(t[n]),n++,o++}else if(e[o]==="*"&&t[n]&&(this.options.dot||!t[n].startsWith("."))&&t[n]!=="**"){if(a==="a")return!1;a="b",h.push(e[o]),n++,o++}else return!1;return t.length===e.length&&h}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,s=0;for(let n=0;n<t.length&&t.charAt(n)==="!";n++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){let n=this.options;if(this.isWindows){let w=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),S=!w&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),y=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),v=!y&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),A=S?3:w?0:void 0,T=v?3:y?0:void 0;if(typeof A=="number"&&typeof T=="number"){let[k,I]=[t[A],e[T]];k.toLowerCase()===I.toLowerCase()&&(e[T]=k,T>A?e=e.slice(T):A>T&&(t=t.slice(A)))}}let{optimizationLevel:o=1}=this.options;o>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var h=0,a=0,l=t.length,c=e.length;h<l&&a<c;h++,a++){this.debug("matchOne loop");var u=e[a],p=t[h];if(this.debug(e,u,p),u===!1)return!1;if(u===Y){this.debug("GLOBSTAR",[e,u,p]);var m=h,b=a+1;if(b===c){for(this.debug("** at the end");h<l;h++)if(t[h]==="."||t[h]===".."||!n.dot&&t[h].charAt(0)===".")return!1;return!0}for(;m<l;){var E=t[m];if(this.debug(`
globstar while`,t,m,e,b,E),this.matchOne(t.slice(m),e.slice(b),s))return this.debug("globstar found match!",m,l,E),!0;if(E==="."||E===".."||!n.dot&&E.charAt(0)==="."){this.debug("dot detected!",t,m,e,b);break}this.debug("globstar swallow a segment, and continue"),m++}return!!(s&&(this.debug(`
>>> no match, partial?`,t,m,e,b),m===l))}let w;if(typeof u=="string"?(w=p===u,this.debug("string match",u,p,w)):(w=u.test(p),this.debug("pattern match",u,p,w)),!w)return!1}if(h===l&&a===c)return!0;if(h===l)return s;if(a===c)return h===l-1&&t[h]==="";throw new Error("wtf?")}braceExpand(){return Jn(this.pattern,this.options)}parse(t){is(t);let e=this.options;if(t==="**")return Y;if(t==="")return"";let s,n=null;(s=t.match(xo))?n=e.dot?Ao:Co:(s=t.match(uo))?n=(e.nocase?e.dot?wo:go:e.dot?mo:po)(s[1]):(s=t.match(No))?n=(e.nocase?e.dot?ko:To:e.dot?Fo:Do)(s):(s=t.match(yo))?n=e.dot?So:bo:(s=t.match(Eo))&&(n=vo);let o=Zt.fromGlob(t,this.options).toMMPattern();return n?Object.assign(o,{test:n}):o}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,s=e.noglobstar?Mo:e.dot?Io:Po,n=new Set(e.nocase?["i"]:[]),o=t.map(l=>{let c=l.map(u=>{if(u instanceof RegExp)for(let p of u.flags.split(""))n.add(p);return typeof u=="string"?$o(u):u===Y?Y:u._src});return c.forEach((u,p)=>{let m=c[p+1],b=c[p-1];u!==Y||b===Y||(b===void 0?m!==void 0&&m!==Y?c[p+1]="(?:\\/|"+s+"\\/)?"+m:c[p]=s:m===void 0?c[p-1]=b+"(?:\\/|"+s+")?":m!==Y&&(c[p-1]=b+"(?:\\/|\\/"+s+"\\/)"+m,c[p+1]=Y))}),c.filter(u=>u!==Y).join("/")}).join("|"),[h,a]=t.length>1?["(?:",")"]:["",""];o="^"+h+o+a+"$",this.negate&&(o="^(?!"+o+").+$");try{this.regexp=new RegExp(o,[...n].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let s=this.options;this.isWindows&&(t=t.split("\\").join("/"));let n=this.slashSplit(t);this.debug(this.pattern,"split",n);let o=this.set;this.debug(this.pattern,"set",o);let h=n[n.length-1];if(!h)for(let a=n.length-2;!h&&a>=0;a--)h=n[a];for(let a=0;a<o.length;a++){let l=o[a],c=n;if(s.matchBase&&l.length===1&&(c=[h]),this.matchOne(c,l,e))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(t){return et.defaults(t).Minimatch}};et.AST=Zt;et.Minimatch=ht;et.escape=ke;et.unescape=wt;var hs=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Qn=new Set,Vi=typeof process=="object"&&!!process?process:{},tr=(r,t,e,s)=>{typeof Vi.emitWarning=="function"?Vi.emitWarning(r,t,e,s):console.error(`[${e}] ${t}: ${r}`)},wi=globalThis.AbortController,Xn=globalThis.AbortSignal,Zn;if(typeof wi>"u"){Xn=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,n){this._onabort.push(n)}},wi=class{constructor(){t()}signal=new Xn;abort(s){var n,o;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(let h of this.signal._onabort)h(s);(o=(n=this.signal).onabort)==null||o.call(n,s)}}};let r=((Zn=Vi.env)==null?void 0:Zn.LRU_CACHE_IGNORE_AC_WARNING)!=="1",t=()=>{!r||(r=!1,tr("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}var Bo=r=>!Qn.has(r),Qh=Symbol("type"),Qt=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),er=r=>Qt(r)?r<=Math.pow(2,8)?Uint8Array:r<=Math.pow(2,16)?Uint16Array:r<=Math.pow(2,32)?Uint32Array:r<=Number.MAX_SAFE_INTEGER?De:null:null,De=class extends Array{constructor(t){super(t),this.fill(0)}},Re,Fe=class{heap;length;static create(t){let e=er(t);if(!e)return[];f(Fe,Re,!0);let s=new Fe(t,e);return f(Fe,Re,!1),s}constructor(t,e){if(!i(Fe,Re))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},pi=Fe;Re=new WeakMap,d(pi,Re,!1);var yt,at,bt,St,Oe,W,Et,j,D,C,st,lt,Z,z,vt,G,$t,Bt,xt,Ct,se,it,cs,qi,de,Ut,fs,ct,yi,sr,pe,Me,us,Dt,te,Rt,ee,ds,Ki,Ie,mi,Pe,gi,F,O,ps,Yi,me,as,Ji=class{constructor(t){d(this,cs);d(this,yi);d(this,Dt);d(this,Rt);d(this,ds);d(this,Ie);d(this,Pe);d(this,F);d(this,ps);d(this,me);d(this,yt,void 0);d(this,at,void 0);d(this,bt,void 0);d(this,St,void 0);d(this,Oe,void 0);N(this,"ttl");N(this,"ttlResolution");N(this,"ttlAutopurge");N(this,"updateAgeOnGet");N(this,"updateAgeOnHas");N(this,"allowStale");N(this,"noDisposeOnSet");N(this,"noUpdateTTL");N(this,"maxEntrySize");N(this,"sizeCalculation");N(this,"noDeleteOnFetchRejection");N(this,"noDeleteOnStaleGet");N(this,"allowStaleOnFetchAbort");N(this,"allowStaleOnFetchRejection");N(this,"ignoreFetchAbort");d(this,W,void 0);d(this,Et,void 0);d(this,j,void 0);d(this,D,void 0);d(this,C,void 0);d(this,st,void 0);d(this,lt,void 0);d(this,Z,void 0);d(this,z,void 0);d(this,vt,void 0);d(this,G,void 0);d(this,$t,void 0);d(this,Bt,void 0);d(this,xt,void 0);d(this,Ct,void 0);d(this,se,void 0);d(this,it,void 0);d(this,de,()=>{});d(this,Ut,()=>{});d(this,fs,()=>{});d(this,ct,()=>!1);d(this,pe,t=>{});d(this,Me,(t,e,s)=>{});d(this,us,(t,e,s,n)=>{if(s||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});let{max:e=0,ttl:s,ttlResolution:n=1,ttlAutopurge:o,updateAgeOnGet:h,updateAgeOnHas:a,allowStale:l,dispose:c,disposeAfter:u,noDisposeOnSet:p,noUpdateTTL:m,maxSize:b=0,maxEntrySize:E=0,sizeCalculation:w,fetchMethod:S,noDeleteOnFetchRejection:y,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:A,allowStaleOnFetchAbort:T,ignoreFetchAbort:k}=t;if(e!==0&&!Qt(e))throw new TypeError("max option must be a nonnegative integer");let I=e?er(e):Array;if(!I)throw new Error("invalid max value: "+e);if(f(this,yt,e),f(this,at,b),this.maxEntrySize=E||i(this,at),this.sizeCalculation=w,this.sizeCalculation){if(!i(this,at)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(S!==void 0&&typeof S!="function")throw new TypeError("fetchMethod must be a function if specified");if(f(this,Oe,S),f(this,se,!!S),f(this,j,new Map),f(this,D,new Array(e).fill(void 0)),f(this,C,new Array(e).fill(void 0)),f(this,st,new I(e)),f(this,lt,new I(e)),f(this,Z,0),f(this,z,0),f(this,vt,pi.create(e)),f(this,W,0),f(this,Et,0),typeof c=="function"&&f(this,bt,c),typeof u=="function"?(f(this,St,u),f(this,G,[])):(f(this,St,void 0),f(this,G,void 0)),f(this,Ct,!!i(this,bt)),f(this,it,!!i(this,St)),this.noDisposeOnSet=!!p,this.noUpdateTTL=!!m,this.noDeleteOnFetchRejection=!!y,this.allowStaleOnFetchRejection=!!A,this.allowStaleOnFetchAbort=!!T,this.ignoreFetchAbort=!!k,this.maxEntrySize!==0){if(i(this,at)!==0&&!Qt(i(this,at)))throw new TypeError("maxSize must be a positive integer if specified");if(!Qt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");g(this,yi,sr).call(this)}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!h,this.updateAgeOnHas=!!a,this.ttlResolution=Qt(n)||n===0?n:1,this.ttlAutopurge=!!o,this.ttl=s||0,this.ttl){if(!Qt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");g(this,cs,qi).call(this)}if(i(this,yt)===0&&this.ttl===0&&i(this,at)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!i(this,yt)&&!i(this,at)){let gt="LRU_CACHE_UNBOUNDED";Bo(gt)&&(Qn.add(gt),tr("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",gt,Ji))}}static unsafeExposeInternals(t){return{starts:i(t,Bt),ttls:i(t,xt),sizes:i(t,$t),keyMap:i(t,j),keyList:i(t,D),valList:i(t,C),next:i(t,st),prev:i(t,lt),get head(){return i(t,Z)},get tail(){return i(t,z)},free:i(t,vt),isBackgroundFetch:e=>{var s;return g(s=t,F,O).call(s,e)},backgroundFetch:(e,s,n,o)=>{var h;return g(h=t,Pe,gi).call(h,e,s,n,o)},moveToTail:e=>{var s;return g(s=t,me,as).call(s,e)},indexes:e=>{var s;return g(s=t,Dt,te).call(s,e)},rindexes:e=>{var s;return g(s=t,Rt,ee).call(s,e)},isStale:e=>{var s;return i(s=t,ct).call(s,e)}}}get max(){return i(this,yt)}get maxSize(){return i(this,at)}get calculatedSize(){return i(this,Et)}get size(){return i(this,W)}get fetchMethod(){return i(this,Oe)}get dispose(){return i(this,bt)}get disposeAfter(){return i(this,St)}getRemainingTTL(t){return i(this,j).has(t)?1/0:0}*entries(){for(let t of g(this,Dt,te).call(this))i(this,C)[t]!==void 0&&i(this,D)[t]!==void 0&&!g(this,F,O).call(this,i(this,C)[t])&&(yield[i(this,D)[t],i(this,C)[t]])}*rentries(){for(let t of g(this,Rt,ee).call(this))i(this,C)[t]!==void 0&&i(this,D)[t]!==void 0&&!g(this,F,O).call(this,i(this,C)[t])&&(yield[i(this,D)[t],i(this,C)[t]])}*keys(){for(let t of g(this,Dt,te).call(this)){let e=i(this,D)[t];e!==void 0&&!g(this,F,O).call(this,i(this,C)[t])&&(yield e)}}*rkeys(){for(let t of g(this,Rt,ee).call(this)){let e=i(this,D)[t];e!==void 0&&!g(this,F,O).call(this,i(this,C)[t])&&(yield e)}}*values(){for(let t of g(this,Dt,te).call(this))i(this,C)[t]!==void 0&&!g(this,F,O).call(this,i(this,C)[t])&&(yield i(this,C)[t])}*rvalues(){for(let t of g(this,Rt,ee).call(this))i(this,C)[t]!==void 0&&!g(this,F,O).call(this,i(this,C)[t])&&(yield i(this,C)[t])}[Symbol.iterator](){return this.entries()}find(t,e={}){for(let s of g(this,Dt,te).call(this)){let n=i(this,C)[s],o=g(this,F,O).call(this,n)?n.__staleWhileFetching:n;if(o!==void 0&&t(o,i(this,D)[s],this))return this.get(i(this,D)[s],e)}}forEach(t,e=this){for(let s of g(this,Dt,te).call(this)){let n=i(this,C)[s],o=g(this,F,O).call(this,n)?n.__staleWhileFetching:n;o!==void 0&&t.call(e,o,i(this,D)[s],this)}}rforEach(t,e=this){for(let s of g(this,Rt,ee).call(this)){let n=i(this,C)[s],o=g(this,F,O).call(this,n)?n.__staleWhileFetching:n;o!==void 0&&t.call(e,o,i(this,D)[s],this)}}purgeStale(){let t=!1;for(let e of g(this,Rt,ee).call(this,{allowStale:!0}))i(this,ct).call(this,e)&&(this.delete(i(this,D)[e]),t=!0);return t}dump(){let t=[];for(let e of g(this,Dt,te).call(this,{allowStale:!0})){let s=i(this,D)[e],n=i(this,C)[e],o=g(this,F,O).call(this,n)?n.__staleWhileFetching:n;if(o===void 0||s===void 0)continue;let h={value:o};if(i(this,xt)&&i(this,Bt)){h.ttl=i(this,xt)[e];let a=hs.now()-i(this,Bt)[e];h.start=Math.floor(Date.now()-a)}i(this,$t)&&(h.size=i(this,$t)[e]),t.unshift([s,h])}return t}load(t){this.clear();for(let[e,s]of t){if(s.start){let n=Date.now()-s.start;s.start=hs.now()-n}this.set(e,s.value,s)}}set(t,e,s={}){var m,b,E,w,S;if(e===void 0)return this.delete(t),this;let{ttl:n=this.ttl,start:o,noDisposeOnSet:h=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=s,{noUpdateTTL:c=this.noUpdateTTL}=s,u=i(this,us).call(this,t,e,s.size||0,a);if(this.maxEntrySize&&u>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.delete(t),this;let p=i(this,W)===0?void 0:i(this,j).get(t);if(p===void 0)p=i(this,W)===0?i(this,z):i(this,vt).length!==0?i(this,vt).pop():i(this,W)===i(this,yt)?g(this,Ie,mi).call(this,!1):i(this,W),i(this,D)[p]=t,i(this,C)[p]=e,i(this,j).set(t,p),i(this,st)[i(this,z)]=p,i(this,lt)[p]=i(this,z),f(this,z,p),ai(this,W)._++,i(this,Me).call(this,p,u,l),l&&(l.set="add"),c=!1;else{g(this,me,as).call(this,p);let y=i(this,C)[p];if(e!==y){if(i(this,se)&&g(this,F,O).call(this,y)){y.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:v}=y;v!==void 0&&!h&&(i(this,Ct)&&((m=i(this,bt))==null||m.call(this,v,t,"set")),i(this,it)&&((b=i(this,G))==null||b.push([v,t,"set"])))}else h||(i(this,Ct)&&((E=i(this,bt))==null||E.call(this,y,t,"set")),i(this,it)&&((w=i(this,G))==null||w.push([y,t,"set"])));if(i(this,pe).call(this,p),i(this,Me).call(this,p,u,l),i(this,C)[p]=e,l){l.set="replace";let v=y&&g(this,F,O).call(this,y)?y.__staleWhileFetching:y;v!==void 0&&(l.oldValue=v)}}else l&&(l.set="update")}if(n!==0&&!i(this,xt)&&g(this,cs,qi).call(this),i(this,xt)&&(c||i(this,fs).call(this,p,n,o),l&&i(this,Ut).call(this,l,p)),!h&&i(this,it)&&i(this,G)){let y=i(this,G),v;for(;v=y==null?void 0:y.shift();)(S=i(this,St))==null||S.call(this,...v)}return this}pop(){var t;try{for(;i(this,W);){let e=i(this,C)[i(this,Z)];if(g(this,Ie,mi).call(this,!0),g(this,F,O).call(this,e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(i(this,it)&&i(this,G)){let e=i(this,G),s;for(;s=e==null?void 0:e.shift();)(t=i(this,St))==null||t.call(this,...s)}}}has(t,e={}){let{updateAgeOnHas:s=this.updateAgeOnHas,status:n}=e,o=i(this,j).get(t);if(o!==void 0){let h=i(this,C)[o];if(g(this,F,O).call(this,h)&&h.__staleWhileFetching===void 0)return!1;if(i(this,ct).call(this,o))n&&(n.has="stale",i(this,Ut).call(this,n,o));else return s&&i(this,de).call(this,o),n&&(n.has="hit",i(this,Ut).call(this,n,o)),!0}else n&&(n.has="miss");return!1}peek(t,e={}){let{allowStale:s=this.allowStale}=e,n=i(this,j).get(t);if(n!==void 0&&(s||!i(this,ct).call(this,n))){let o=i(this,C)[n];return g(this,F,O).call(this,o)?o.__staleWhileFetching:o}}async fetch(t,e={}){let{allowStale:s=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:h=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:m=this.allowStaleOnFetchRejection,ignoreFetchAbort:b=this.ignoreFetchAbort,allowStaleOnFetchAbort:E=this.allowStaleOnFetchAbort,context:w,forceRefresh:S=!1,status:y,signal:v}=e;if(!i(this,se))return y&&(y.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:n,noDeleteOnStaleGet:o,status:y});let A={allowStale:s,updateAgeOnGet:n,noDeleteOnStaleGet:o,ttl:h,noDisposeOnSet:a,size:l,sizeCalculation:c,noUpdateTTL:u,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:m,allowStaleOnFetchAbort:E,ignoreFetchAbort:b,status:y,signal:v},T=i(this,j).get(t);if(T===void 0){y&&(y.fetch="miss");let k=g(this,Pe,gi).call(this,t,T,A,w);return k.__returned=k}else{let k=i(this,C)[T];if(g(this,F,O).call(this,k)){let hi=s&&k.__staleWhileFetching!==void 0;return y&&(y.fetch="inflight",hi&&(y.returnedStale=!0)),hi?k.__staleWhileFetching:k.__returned=k}let I=i(this,ct).call(this,T);if(!S&&!I)return y&&(y.fetch="hit"),g(this,me,as).call(this,T),n&&i(this,de).call(this,T),y&&i(this,Ut).call(this,y,T),k;let gt=g(this,Pe,gi).call(this,t,T,A,w),Ft=gt.__staleWhileFetching!==void 0&&s;return y&&(y.fetch=I?"stale":"refresh",Ft&&I&&(y.returnedStale=!0)),Ft?gt.__staleWhileFetching:gt.__returned=gt}}get(t,e={}){let{allowStale:s=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:h}=e,a=i(this,j).get(t);if(a!==void 0){let l=i(this,C)[a],c=g(this,F,O).call(this,l);return h&&i(this,Ut).call(this,h,a),i(this,ct).call(this,a)?(h&&(h.get="stale"),c?(h&&s&&l.__staleWhileFetching!==void 0&&(h.returnedStale=!0),s?l.__staleWhileFetching:void 0):(o||this.delete(t),h&&s&&(h.returnedStale=!0),s?l:void 0)):(h&&(h.get="hit"),c?l.__staleWhileFetching:(g(this,me,as).call(this,a),n&&i(this,de).call(this,a),l))}else h&&(h.get="miss")}delete(t){var s,n,o,h;let e=!1;if(i(this,W)!==0){let a=i(this,j).get(t);if(a!==void 0)if(e=!0,i(this,W)===1)this.clear();else{i(this,pe).call(this,a);let l=i(this,C)[a];g(this,F,O).call(this,l)?l.__abortController.abort(new Error("deleted")):(i(this,Ct)||i(this,it))&&(i(this,Ct)&&((s=i(this,bt))==null||s.call(this,l,t,"delete")),i(this,it)&&((n=i(this,G))==null||n.push([l,t,"delete"]))),i(this,j).delete(t),i(this,D)[a]=void 0,i(this,C)[a]=void 0,a===i(this,z)?f(this,z,i(this,lt)[a]):a===i(this,Z)?f(this,Z,i(this,st)[a]):(i(this,st)[i(this,lt)[a]]=i(this,st)[a],i(this,lt)[i(this,st)[a]]=i(this,lt)[a]),ai(this,W)._--,i(this,vt).push(a)}}if(i(this,it)&&((o=i(this,G))==null?void 0:o.length)){let a=i(this,G),l;for(;l=a==null?void 0:a.shift();)(h=i(this,St))==null||h.call(this,...l)}return e}clear(){var t,e,s;for(let n of g(this,Rt,ee).call(this,{allowStale:!0})){let o=i(this,C)[n];if(g(this,F,O).call(this,o))o.__abortController.abort(new Error("deleted"));else{let h=i(this,D)[n];i(this,Ct)&&((t=i(this,bt))==null||t.call(this,o,h,"delete")),i(this,it)&&((e=i(this,G))==null||e.push([o,h,"delete"]))}}if(i(this,j).clear(),i(this,C).fill(void 0),i(this,D).fill(void 0),i(this,xt)&&i(this,Bt)&&(i(this,xt).fill(0),i(this,Bt).fill(0)),i(this,$t)&&i(this,$t).fill(0),f(this,Z,0),f(this,z,0),i(this,vt).length=0,f(this,Et,0),f(this,W,0),i(this,it)&&i(this,G)){let n=i(this,G),o;for(;o=n==null?void 0:n.shift();)(s=i(this,St))==null||s.call(this,...o)}}},ls=Ji;yt=new WeakMap,at=new WeakMap,bt=new WeakMap,St=new WeakMap,Oe=new WeakMap,W=new WeakMap,Et=new WeakMap,j=new WeakMap,D=new WeakMap,C=new WeakMap,st=new WeakMap,lt=new WeakMap,Z=new WeakMap,z=new WeakMap,vt=new WeakMap,G=new WeakMap,$t=new WeakMap,Bt=new WeakMap,xt=new WeakMap,Ct=new WeakMap,se=new WeakMap,it=new WeakMap,cs=new WeakSet,qi=function(){let t=new De(i(this,yt)),e=new De(i(this,yt));f(this,xt,t),f(this,Bt,e),f(this,fs,(o,h,a=hs.now())=>{if(e[o]=h!==0?a:0,t[o]=h,h!==0&&this.ttlAutopurge){let l=setTimeout(()=>{i(this,ct).call(this,o)&&this.delete(i(this,D)[o])},h+1);l.unref&&l.unref()}}),f(this,de,o=>{e[o]=t[o]!==0?hs.now():0}),f(this,Ut,(o,h)=>{if(t[h]){let a=t[h],l=e[h];o.ttl=a,o.start=l,o.now=s||n();let c=o.now-l;o.remainingTTL=a-c}});let s=0,n=()=>{let o=hs.now();if(this.ttlResolution>0){s=o;let h=setTimeout(()=>s=0,this.ttlResolution);h.unref&&h.unref()}return o};this.getRemainingTTL=o=>{let h=i(this,j).get(o);if(h===void 0)return 0;let a=t[h],l=e[h];if(a===0||l===0)return 1/0;let c=(s||n())-l;return a-c},f(this,ct,o=>t[o]!==0&&e[o]!==0&&(s||n())-e[o]>t[o])},de=new WeakMap,Ut=new WeakMap,fs=new WeakMap,ct=new WeakMap,yi=new WeakSet,sr=function(){let t=new De(i(this,yt));f(this,Et,0),f(this,$t,t),f(this,pe,e=>{f(this,Et,i(this,Et)-t[e]),t[e]=0}),f(this,us,(e,s,n,o)=>{if(g(this,F,O).call(this,s))return 0;if(!Qt(n))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(n=o(s,e),!Qt(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n}),f(this,Me,(e,s,n)=>{if(t[e]=s,i(this,at)){let o=i(this,at)-t[e];for(;i(this,Et)>o;)g(this,Ie,mi).call(this,!0)}f(this,Et,i(this,Et)+t[e]),n&&(n.entrySize=s,n.totalCalculatedSize=i(this,Et))})},pe=new WeakMap,Me=new WeakMap,us=new WeakMap,Dt=new WeakSet,te=function*({allowStale:t=this.allowStale}={}){if(i(this,W))for(let e=i(this,z);!(!g(this,ds,Ki).call(this,e)||((t||!i(this,ct).call(this,e))&&(yield e),e===i(this,Z)));)e=i(this,lt)[e]},Rt=new WeakSet,ee=function*({allowStale:t=this.allowStale}={}){if(i(this,W))for(let e=i(this,Z);!(!g(this,ds,Ki).call(this,e)||((t||!i(this,ct).call(this,e))&&(yield e),e===i(this,z)));)e=i(this,st)[e]},ds=new WeakSet,Ki=function(t){return t!==void 0&&i(this,j).get(i(this,D)[t])===t},Ie=new WeakSet,mi=function(t){var o,h;let e=i(this,Z),s=i(this,D)[e],n=i(this,C)[e];return i(this,se)&&g(this,F,O).call(this,n)?n.__abortController.abort(new Error("evicted")):(i(this,Ct)||i(this,it))&&(i(this,Ct)&&((o=i(this,bt))==null||o.call(this,n,s,"evict")),i(this,it)&&((h=i(this,G))==null||h.push([n,s,"evict"]))),i(this,pe).call(this,e),t&&(i(this,D)[e]=void 0,i(this,C)[e]=void 0,i(this,vt).push(e)),i(this,W)===1?(f(this,Z,f(this,z,0)),i(this,vt).length=0):f(this,Z,i(this,st)[e]),i(this,j).delete(s),ai(this,W)._--,e},Pe=new WeakSet,gi=function(t,e,s,n){let o=e===void 0?void 0:i(this,C)[e];if(g(this,F,O).call(this,o))return o;let h=new wi,{signal:a}=s;a==null||a.addEventListener("abort",()=>h.abort(a.reason),{signal:h.signal});let l={signal:h.signal,options:s,context:n},c=(w,S=!1)=>{let{aborted:y}=h.signal,v=s.ignoreFetchAbort&&w!==void 0;if(s.status&&(y&&!S?(s.status.fetchAborted=!0,s.status.fetchError=h.signal.reason,v&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),y&&!v&&!S)return p(h.signal.reason);let A=b;return i(this,C)[e]===b&&(w===void 0?A.__staleWhileFetching?i(this,C)[e]=A.__staleWhileFetching:this.delete(t):(s.status&&(s.status.fetchUpdated=!0),this.set(t,w,l.options))),w},u=w=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=w),p(w)),p=w=>{let{aborted:S}=h.signal,y=S&&s.allowStaleOnFetchAbort,v=y||s.allowStaleOnFetchRejection,A=v||s.noDeleteOnFetchRejection,T=b;if(i(this,C)[e]===b&&(!A||T.__staleWhileFetching===void 0?this.delete(t):y||(i(this,C)[e]=T.__staleWhileFetching)),v)return s.status&&T.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),T.__staleWhileFetching;if(T.__returned===T)throw w},m=(w,S)=>{var v;let y=(v=i(this,Oe))==null?void 0:v.call(this,t,o,l);y&&y instanceof Promise&&y.then(A=>w(A===void 0?void 0:A),S),h.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(w(void 0),s.allowStaleOnFetchAbort&&(w=A=>c(A,!0)))})};s.status&&(s.status.fetchDispatched=!0);let b=new Promise(m).then(c,u),E=Object.assign(b,{__abortController:h,__staleWhileFetching:o,__returned:void 0});return e===void 0?(this.set(t,E,{...l.options,status:void 0}),e=i(this,j).get(t)):i(this,C)[e]=E,E},F=new WeakSet,O=function(t){if(!i(this,se))return!1;let e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof wi},ps=new WeakSet,Yi=function(t,e){i(this,lt)[e]=t,i(this,st)[t]=e},me=new WeakSet,as=function(t){t!==i(this,z)&&(t===i(this,Z)?f(this,Z,i(this,st)[t]):g(this,ps,Yi).call(this,i(this,lt)[t],i(this,st)[t]),g(this,ps,Yi).call(this,i(this,z),t),f(this,z,t))};var He=X("path"),ur=X("url"),Xo=es(X("fs"),1),Lt=X("fs"),oe=X("fs/promises");var Ai=X("events"),nn=es(X("stream"),1),hr=X("string_decoder"),ir=typeof process=="object"&&process?process:{stdout:null,stderr:null},Uo=r=>!!r&&typeof r=="object"&&(r instanceof ne||r instanceof nn.default||zo(r)||Go(r)),zo=r=>!!r&&typeof r=="object"&&r instanceof Ai.EventEmitter&&typeof r.pipe=="function"&&r.pipe!==nn.default.Writable.prototype.pipe,Go=r=>!!r&&typeof r=="object"&&r instanceof Ai.EventEmitter&&typeof r.write=="function"&&typeof r.end=="function",zt=Symbol("EOF"),Gt=Symbol("maybeEmitEnd"),ie=Symbol("emittedEnd"),bi=Symbol("emittingEnd"),ms=Symbol("emittedError"),Si=Symbol("closed"),nr=Symbol("read"),Ei=Symbol("flush"),rr=Symbol("flushChunk"),At=Symbol("encoding"),Le=Symbol("decoder"),H=Symbol("flowing"),gs=Symbol("paused"),_e=Symbol("resume"),V=Symbol("buffer"),nt=Symbol("pipes"),q=Symbol("bufferLength"),Xi=Symbol("bufferPush"),vi=Symbol("bufferShift"),Q=Symbol("objectMode"),M=Symbol("destroyed"),Zi=Symbol("error"),Qi=Symbol("emitData"),or=Symbol("emitEnd"),tn=Symbol("emitEnd2"),Ot=Symbol("async"),en=Symbol("abort"),xi=Symbol("aborted"),ws=Symbol("signal"),ge=Symbol("dataListeners"),ft=Symbol("discarded"),ys=r=>Promise.resolve().then(r),Ho=r=>r(),Vo=r=>r==="end"||r==="finish"||r==="prefinish",qo=r=>r instanceof ArrayBuffer||!!r&&typeof r=="object"&&r.constructor&&r.constructor.name==="ArrayBuffer"&&r.byteLength>=0,Ko=r=>!Buffer.isBuffer(r)&&ArrayBuffer.isView(r),Ci=class{src;dest;opts;ondrain;constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[_e](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},sn=class extends Ci{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=n=>e.emit("error",n),t.on("error",this.proxyErrors)}},Yo=r=>!!r.objectMode,Jo=r=>!r.objectMode&&!!r.encoding&&r.encoding!=="buffer",ne=class extends Ai.EventEmitter{[H]=!1;[gs]=!1;[nt]=[];[V]=[];[Q];[At];[Ot];[Le];[zt]=!1;[ie]=!1;[bi]=!1;[Si]=!1;[ms]=null;[q]=0;[M]=!1;[ws];[xi]=!1;[ge]=0;[ft]=!1;writable=!0;readable=!0;constructor(...t){let e=t[0]||{};if(super(),e.objectMode&&typeof e.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");Yo(e)?(this[Q]=!0,this[At]=null):Jo(e)?(this[At]=e.encoding,this[Q]=!1):(this[Q]=!1,this[At]=null),this[Ot]=!!e.async,this[Le]=this[At]?new hr.StringDecoder(this[At]):null,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[V]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[nt]});let{signal:s}=e;s&&(this[ws]=s,s.aborted?this[en]():s.addEventListener("abort",()=>this[en]()))}get bufferLength(){return this[q]}get encoding(){return this[At]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[Q]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[Ot]}set async(t){this[Ot]=this[Ot]||!!t}[en](){var t,e;this[xi]=!0,this.emit("abort",(t=this[ws])==null?void 0:t.reason),this.destroy((e=this[ws])==null?void 0:e.reason)}get aborted(){return this[xi]}set aborted(t){}write(t,e,s){var o;if(this[xi])return!1;if(this[zt])throw new Error("write after end");if(this[M])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(s=e,e="utf8"),e||(e="utf8");let n=this[Ot]?ys:Ho;if(!this[Q]&&!Buffer.isBuffer(t)){if(Ko(t))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if(qo(t))t=Buffer.from(t);else if(typeof t!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[Q]?(this[H]&&this[q]!==0&&this[Ei](!0),this[H]?this.emit("data",t):this[Xi](t),this[q]!==0&&this.emit("readable"),s&&n(s),this[H]):t.length?(typeof t=="string"&&!(e===this[At]&&!((o=this[Le])!=null&&o.lastNeed))&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[At]&&(t=this[Le].write(t)),this[H]&&this[q]!==0&&this[Ei](!0),this[H]?this.emit("data",t):this[Xi](t),this[q]!==0&&this.emit("readable"),s&&n(s),this[H]):(this[q]!==0&&this.emit("readable"),s&&n(s),this[H])}read(t){if(this[M])return null;if(this[ft]=!1,this[q]===0||t===0||t&&t>this[q])return this[Gt](),null;this[Q]&&(t=null),this[V].length>1&&!this[Q]&&(this[V]=[this[At]?this[V].join(""):Buffer.concat(this[V],this[q])]);let e=this[nr](t||null,this[V][0]);return this[Gt](),e}[nr](t,e){if(this[Q])this[vi]();else{let s=e;t===s.length||t===null?this[vi]():typeof s=="string"?(this[V][0]=s.slice(t),e=s.slice(0,t),this[q]-=t):(this[V][0]=s.subarray(t),e=s.subarray(0,t),this[q]-=t)}return this.emit("data",e),!this[V].length&&!this[zt]&&this.emit("drain"),e}end(t,e,s){return typeof t=="function"&&(s=t,t=void 0),typeof e=="function"&&(s=e,e="utf8"),t!==void 0&&this.write(t,e),s&&this.once("end",s),this[zt]=!0,this.writable=!1,(this[H]||!this[gs])&&this[Gt](),this}[_e](){this[M]||(!this[ge]&&!this[nt].length&&(this[ft]=!0),this[gs]=!1,this[H]=!0,this.emit("resume"),this[V].length?this[Ei]():this[zt]?this[Gt]():this.emit("drain"))}resume(){return this[_e]()}pause(){this[H]=!1,this[gs]=!0,this[ft]=!1}get destroyed(){return this[M]}get flowing(){return this[H]}get paused(){return this[gs]}[Xi](t){this[Q]?this[q]+=1:this[q]+=t.length,this[V].push(t)}[vi](){return this[Q]?this[q]-=1:this[q]-=this[V][0].length,this[V].shift()}[Ei](t=!1){do;while(this[rr](this[vi]())&&this[V].length);!t&&!this[V].length&&!this[zt]&&this.emit("drain")}[rr](t){return this.emit("data",t),this[H]}pipe(t,e){if(this[M])return t;this[ft]=!1;let s=this[ie];return e=e||{},t===ir.stdout||t===ir.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[nt].push(e.proxyErrors?new sn(this,t,e):new Ci(this,t,e)),this[Ot]?ys(()=>this[_e]()):this[_e]()),t}unpipe(t){let e=this[nt].find(s=>s.dest===t);e&&(this[nt].length===1?(this[H]&&this[ge]===0&&(this[H]=!1),this[nt]=[]):this[nt].splice(this[nt].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){let s=super.on(t,e);if(t==="data")this[ft]=!1,this[ge]++,!this[nt].length&&!this[H]&&this[_e]();else if(t==="readable"&&this[q]!==0)super.emit("readable");else if(Vo(t)&&this[ie])super.emit(t),this.removeAllListeners(t);else if(t==="error"&&this[ms]){let n=e;this[Ot]?ys(()=>n.call(this,this[ms])):n.call(this,this[ms])}return s}removeListener(t,e){return this.off(t,e)}off(t,e){let s=super.off(t,e);return t==="data"&&(this[ge]=this.listeners("data").length,this[ge]===0&&!this[ft]&&!this[nt].length&&(this[H]=!1)),s}removeAllListeners(t){let e=super.removeAllListeners(t);return(t==="data"||t===void 0)&&(this[ge]=0,!this[ft]&&!this[nt].length&&(this[H]=!1)),e}get emittedEnd(){return this[ie]}[Gt](){!this[bi]&&!this[ie]&&!this[M]&&this[V].length===0&&this[zt]&&(this[bi]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Si]&&this.emit("close"),this[bi]=!1)}emit(t,...e){let s=e[0];if(t!=="error"&&t!=="close"&&t!==M&&this[M])return!1;if(t==="data")return!this[Q]&&!s?!1:this[Ot]?(ys(()=>this[Qi](s)),!0):this[Qi](s);if(t==="end")return this[or]();if(t==="close"){if(this[Si]=!0,!this[ie]&&!this[M])return!1;let o=super.emit("close");return this.removeAllListeners("close"),o}else if(t==="error"){this[ms]=s,super.emit(Zi,s);let o=!this[ws]||this.listeners("error").length?super.emit("error",s):!1;return this[Gt](),o}else if(t==="resume"){let o=super.emit("resume");return this[Gt](),o}else if(t==="finish"||t==="prefinish"){let o=super.emit(t);return this.removeAllListeners(t),o}let n=super.emit(t,...e);return this[Gt](),n}[Qi](t){for(let s of this[nt])s.dest.write(t)===!1&&this.pause();let e=this[ft]?!1:super.emit("data",t);return this[Gt](),e}[or](){return this[ie]?!1:(this[ie]=!0,this.readable=!1,this[Ot]?(ys(()=>this[tn]()),!0):this[tn]())}[tn](){if(this[Le]){let e=this[Le].end();if(e){for(let s of this[nt])s.dest.write(e);this[ft]||super.emit("data",e)}}for(let e of this[nt])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){let t=Object.assign([],{dataLength:0});this[Q]||(t.dataLength=0);let e=this.promise();return this.on("data",s=>{t.push(s),this[Q]||(t.dataLength+=s.length)}),await e,t}async concat(){if(this[Q])throw new Error("cannot concat in objectMode");let t=await this.collect();return this[At]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise((t,e)=>{this.on(M,()=>e(new Error("stream destroyed"))),this.on("error",s=>e(s)),this.on("end",()=>t())})}[Symbol.asyncIterator](){this[ft]=!1;let t=!1,e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();let n=this.read();if(n!==null)return Promise.resolve({done:!1,value:n});if(this[zt])return e();let o,h,a=p=>{this.off("data",l),this.off("end",c),this.off(M,u),e(),h(p)},l=p=>{this.off("error",a),this.off("end",c),this.off(M,u),this.pause(),o({value:p,done:!!this[zt]})},c=()=>{this.off("error",a),this.off("data",l),this.off(M,u),e(),o({done:!0,value:void 0})},u=()=>a(new Error("stream destroyed"));return new Promise((p,m)=>{h=m,o=p,this.once(M,u),this.once("error",a),this.once("end",c),this.once("data",l)})},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[ft]=!1;let t=!1,e=()=>(this.pause(),this.off(Zi,e),this.off(M,e),this.off("end",e),t=!0,{done:!0,value:void 0}),s=()=>{if(t)return e();let n=this.read();return n===null?e():{done:!1,value:n}};return this.once("end",e),this.once(Zi,e),this.once(M,e),{next:s,throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[M])return t?this.emit("error",t):this.emit(M),this;this[M]=!0,this[ft]=!0,this[V].length=0,this[q]=0;let e=this;return typeof e.close=="function"&&!this[Si]&&e.close(),t?this.emit("error",t):this.emit(M),this}static get isStream(){return Uo}};var Zo=Lt.realpathSync.native,Ss={lstatSync:Lt.lstatSync,readdir:Lt.readdir,readdirSync:Lt.readdirSync,readlinkSync:Lt.readlinkSync,realpathSync:Zo,promises:{lstat:oe.lstat,readdir:oe.readdir,readlink:oe.readlink,realpath:oe.realpath}},dr=r=>!r||r===Ss||r===Xo?Ss:{...Ss,...r,promises:{...Ss.promises,...r.promises||{}}},pr=/^\\\\\?\\([a-z]:)\\?$/i,Qo=r=>r.replace(/\//g,"\\").replace(pr,"$1\\"),th=/[\\\/]/,mt=0,mr=1,gr=2,Mt=4,wr=6,yr=8,we=10,br=12,pt=15,bs=~pt,rn=16,ar=32,Es=64,Nt=128,Ni=256,ki=512,lr=Es|Nt|ki,eh=1023,on=r=>r.isFile()?yr:r.isDirectory()?Mt:r.isSymbolicLink()?we:r.isCharacterDevice()?gr:r.isBlockDevice()?wr:r.isSocket()?br:r.isFIFO()?mr:mt,cr=new Map,vs=r=>{let t=cr.get(r);if(t)return t;let e=r.normalize("NFKD");return cr.set(r,e),e},fr=new Map,Ti=r=>{let t=fr.get(r);if(t)return t;let e=vs(r.toLowerCase());return fr.set(r,e),e},Oi=class extends ls{constructor(){super({max:256})}},hn=class extends ls{constructor(t=16*1024){super({maxSize:t,sizeCalculation:e=>e.length+1})}},Sr=Symbol("PathScurry setAsCwd"),rt,Ns,Ts,ks,Fs,Ds,Rs,Os,Ms,Is,Ps,Ls,_s,Ws,js,$s,Bs,Us,zs,re,ye,It,Ht,Vt,qt,x,be,Kt,Pt,Gs,an,We,Fi,Se,xs,Hs,ln,Vs,cn,Ee,Cs,je,Di,qs,fn,Ks,un,$e,Ri,Ii,Er,Pi,vr,Li,xr,Ys,dn,Be,Ue,_i,Cr,ve,tt=class{constructor(t,e=mt,s,n,o,h,a){d(this,Gs);d(this,We);d(this,Se);d(this,Hs);d(this,Vs);d(this,Ee);d(this,je);d(this,qs);d(this,Ks);d(this,$e);d(this,Ii);d(this,Pi);d(this,Li);d(this,Ys);d(this,_i);N(this,"name");N(this,"root");N(this,"roots");N(this,"parent");N(this,"nocase");d(this,rt,void 0);d(this,Ns,void 0);d(this,Ts,void 0);d(this,ks,void 0);d(this,Fs,void 0);d(this,Ds,void 0);d(this,Rs,void 0);d(this,Os,void 0);d(this,Ms,void 0);d(this,Is,void 0);d(this,Ps,void 0);d(this,Ls,void 0);d(this,_s,void 0);d(this,Ws,void 0);d(this,js,void 0);d(this,$s,void 0);d(this,Bs,void 0);d(this,Us,void 0);d(this,zs,void 0);d(this,re,void 0);d(this,ye,void 0);d(this,It,void 0);d(this,Ht,void 0);d(this,Vt,void 0);d(this,qt,void 0);d(this,x,void 0);d(this,be,void 0);d(this,Kt,void 0);d(this,Pt,void 0);d(this,Be,[]);d(this,Ue,!1);d(this,ve,void 0);this.name=t,f(this,re,o?Ti(t):vs(t)),f(this,x,e&eh),this.nocase=o,this.roots=n,this.root=s||this,f(this,be,h),f(this,It,a.fullpath),f(this,Vt,a.relative),f(this,qt,a.relativePosix),this.parent=a.parent,this.parent?f(this,rt,i(this.parent,rt)):f(this,rt,dr(a.fs))}get dev(){return i(this,Ns)}get mode(){return i(this,Ts)}get nlink(){return i(this,ks)}get uid(){return i(this,Fs)}get gid(){return i(this,Ds)}get rdev(){return i(this,Rs)}get blksize(){return i(this,Os)}get ino(){return i(this,Ms)}get size(){return i(this,Is)}get blocks(){return i(this,Ps)}get atimeMs(){return i(this,Ls)}get mtimeMs(){return i(this,_s)}get ctimeMs(){return i(this,Ws)}get birthtimeMs(){return i(this,js)}get atime(){return i(this,$s)}get mtime(){return i(this,Bs)}get ctime(){return i(this,Us)}get birthtime(){return i(this,zs)}get path(){return(this.parent||this).fullpath()}depth(){return i(this,ye)!==void 0?i(this,ye):this.parent?f(this,ye,this.parent.depth()+1):f(this,ye,0)}childrenCache(){return i(this,be)}resolve(t){var h;if(!t)return this;let e=this.getRootString(t),n=t.substring(e.length).split(this.splitSep);return e?g(h=this.getRoot(e),Gs,an).call(h,n):g(this,Gs,an).call(this,n)}children(){let t=i(this,be).get(this);if(t)return t;let e=Object.assign([],{provisional:0});return i(this,be).set(this,e),f(this,x,i(this,x)&~rn),e}child(t,e){if(t===""||t===".")return this;if(t==="..")return this.parent||this;let s=this.children(),n=this.nocase?Ti(t):vs(t);for(let l of s)if(i(l,re)===n)return l;let o=this.parent?this.sep:"",h=i(this,It)?i(this,It)+o+t:void 0,a=this.newChild(t,mt,{...e,parent:this,fullpath:h});return this.canReaddir()||f(a,x,i(a,x)|Nt),s.push(a),a}relative(){if(i(this,Vt)!==void 0)return i(this,Vt);let t=this.name,e=this.parent;if(!e)return f(this,Vt,this.name);let s=e.relative();return s+(!s||!e.parent?"":this.sep)+t}relativePosix(){if(this.sep==="/")return this.relative();if(i(this,qt)!==void 0)return i(this,qt);let t=this.name,e=this.parent;if(!e)return f(this,qt,this.fullpathPosix());let s=e.relativePosix();return s+(!s||!e.parent?"":"/")+t}fullpath(){if(i(this,It)!==void 0)return i(this,It);let t=this.name,e=this.parent;if(!e)return f(this,It,this.name);let n=e.fullpath()+(e.parent?this.sep:"")+t;return f(this,It,n)}fullpathPosix(){if(i(this,Ht)!==void 0)return i(this,Ht);if(this.sep==="/")return f(this,Ht,this.fullpath());if(!this.parent){let n=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(n)?f(this,Ht,`//?/${n}`):f(this,Ht,n)}let t=this.parent,e=t.fullpathPosix(),s=e+(!e||!t.parent?"":"/")+this.name;return f(this,Ht,s)}isUnknown(){return(i(this,x)&pt)===mt}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(i(this,x)&pt)===yr}isDirectory(){return(i(this,x)&pt)===Mt}isCharacterDevice(){return(i(this,x)&pt)===gr}isBlockDevice(){return(i(this,x)&pt)===wr}isFIFO(){return(i(this,x)&pt)===mr}isSocket(){return(i(this,x)&pt)===br}isSymbolicLink(){return(i(this,x)&we)===we}lstatCached(){return i(this,x)&ar?this:void 0}readlinkCached(){return i(this,Kt)}realpathCached(){return i(this,Pt)}readdirCached(){let t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(i(this,Kt))return!0;if(!this.parent)return!1;let t=i(this,x)&pt;return!(t!==mt&&t!==we||i(this,x)&Ni||i(this,x)&Nt)}calledReaddir(){return!!(i(this,x)&rn)}isENOENT(){return!!(i(this,x)&Nt)}isNamed(t){return this.nocase?i(this,re)===Ti(t):i(this,re)===vs(t)}async readlink(){let t=i(this,Kt);if(t)return t;if(!!this.canReadlink()&&!!this.parent)try{let e=await i(this,rt).promises.readlink(this.fullpath()),s=this.parent.resolve(e);if(s)return f(this,Kt,s)}catch(e){g(this,Ks,un).call(this,e.code);return}}readlinkSync(){let t=i(this,Kt);if(t)return t;if(!!this.canReadlink()&&!!this.parent)try{let e=i(this,rt).readlinkSync(this.fullpath()),s=this.parent.resolve(e);if(s)return f(this,Kt,s)}catch(e){g(this,Ks,un).call(this,e.code);return}}async lstat(){if((i(this,x)&Nt)===0)try{return g(this,Ys,dn).call(this,await i(this,rt).promises.lstat(this.fullpath())),this}catch(t){g(this,qs,fn).call(this,t.code)}}lstatSync(){if((i(this,x)&Nt)===0)try{return g(this,Ys,dn).call(this,i(this,rt).lstatSync(this.fullpath())),this}catch(t){g(this,qs,fn).call(this,t.code)}}readdirCB(t,e=!1){if(!this.canReaddir()){e?t(null,[]):queueMicrotask(()=>t(null,[]));return}let s=this.children();if(this.calledReaddir()){let o=s.slice(0,s.provisional);e?t(null,o):queueMicrotask(()=>t(null,o));return}if(i(this,Be).push(t),i(this,Ue))return;f(this,Ue,!0);let n=this.fullpath();i(this,rt).readdir(n,{withFileTypes:!0},(o,h)=>{if(o)g(this,je,Di).call(this,o.code),s.provisional=0;else{for(let a of h)g(this,$e,Ri).call(this,a,s);g(this,We,Fi).call(this,s)}g(this,_i,Cr).call(this,s.slice(0,s.provisional))})}async readdir(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();if(i(this,ve))await i(this,ve);else{let s=()=>{};f(this,ve,new Promise(n=>s=n));try{for(let n of await i(this,rt).promises.readdir(e,{withFileTypes:!0}))g(this,$e,Ri).call(this,n,t);g(this,We,Fi).call(this,t)}catch(n){g(this,je,Di).call(this,n.code),t.provisional=0}f(this,ve,void 0),s()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();try{for(let s of i(this,rt).readdirSync(e,{withFileTypes:!0}))g(this,$e,Ri).call(this,s,t);g(this,We,Fi).call(this,t)}catch(s){g(this,je,Di).call(this,s.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(i(this,x)&lr)return!1;let t=pt&i(this,x);return t===mt||t===Mt||t===we}shouldWalk(t,e){return(i(this,x)&Mt)===Mt&&!(i(this,x)&lr)&&!t.has(this)&&(!e||e(this))}async realpath(){if(i(this,Pt))return i(this,Pt);if(!((ki|Ni|Nt)&i(this,x)))try{let t=await i(this,rt).promises.realpath(this.fullpath());return f(this,Pt,this.resolve(t))}catch{g(this,Vs,cn).call(this)}}realpathSync(){if(i(this,Pt))return i(this,Pt);if(!((ki|Ni|Nt)&i(this,x)))try{let t=i(this,rt).realpathSync(this.fullpath());return f(this,Pt,this.resolve(t))}catch{g(this,Vs,cn).call(this)}}[Sr](t){if(t===this)return;let e=new Set([]),s=[],n=this;for(;n&&n.parent;)e.add(n),f(n,Vt,s.join(this.sep)),f(n,qt,s.join("/")),n=n.parent,s.push("..");for(n=t;n&&n.parent&&!e.has(n);)f(n,Vt,void 0),f(n,qt,void 0),n=n.parent}};rt=new WeakMap,Ns=new WeakMap,Ts=new WeakMap,ks=new WeakMap,Fs=new WeakMap,Ds=new WeakMap,Rs=new WeakMap,Os=new WeakMap,Ms=new WeakMap,Is=new WeakMap,Ps=new WeakMap,Ls=new WeakMap,_s=new WeakMap,Ws=new WeakMap,js=new WeakMap,$s=new WeakMap,Bs=new WeakMap,Us=new WeakMap,zs=new WeakMap,re=new WeakMap,ye=new WeakMap,It=new WeakMap,Ht=new WeakMap,Vt=new WeakMap,qt=new WeakMap,x=new WeakMap,be=new WeakMap,Kt=new WeakMap,Pt=new WeakMap,Gs=new WeakSet,an=function(t){let e=this;for(let s of t)e=e.child(s);return e},We=new WeakSet,Fi=function(t){var e;f(this,x,i(this,x)|rn);for(let s=t.provisional;s<t.length;s++)g(e=t[s],Se,xs).call(e)},Se=new WeakSet,xs=function(){i(this,x)&Nt||(f(this,x,(i(this,x)|Nt)&bs),g(this,Hs,ln).call(this))},Hs=new WeakSet,ln=function(){var e;let t=this.children();t.provisional=0;for(let s of t)g(e=s,Se,xs).call(e)},Vs=new WeakSet,cn=function(){f(this,x,i(this,x)|ki),g(this,Ee,Cs).call(this)},Ee=new WeakSet,Cs=function(){if(i(this,x)&Es)return;let t=i(this,x);(t&pt)===Mt&&(t&=bs),f(this,x,t|Es),g(this,Hs,ln).call(this)},je=new WeakSet,Di=function(t=""){t==="ENOTDIR"||t==="EPERM"?g(this,Ee,Cs).call(this):t==="ENOENT"?g(this,Se,xs).call(this):this.children().provisional=0},qs=new WeakSet,fn=function(t=""){var e;if(t==="ENOTDIR"){let s=this.parent;g(e=s,Ee,Cs).call(e)}else t==="ENOENT"&&g(this,Se,xs).call(this)},Ks=new WeakSet,un=function(t=""){var s;let e=i(this,x);e|=Ni,t==="ENOENT"&&(e|=Nt),(t==="EINVAL"||t==="UNKNOWN")&&(e&=bs),f(this,x,e),t==="ENOTDIR"&&this.parent&&g(s=this.parent,Ee,Cs).call(s)},$e=new WeakSet,Ri=function(t,e){return g(this,Pi,vr).call(this,t,e)||g(this,Ii,Er).call(this,t,e)},Ii=new WeakSet,Er=function(t,e){let s=on(t),n=this.newChild(t.name,s,{parent:this}),o=i(n,x)&pt;return o!==Mt&&o!==we&&o!==mt&&f(n,x,i(n,x)|Es),e.unshift(n),e.provisional++,n},Pi=new WeakSet,vr=function(t,e){for(let s=e.provisional;s<e.length;s++){let n=e[s];if((this.nocase?Ti(t.name):vs(t.name))===i(n,re))return g(this,Li,xr).call(this,t,n,s,e)}},Li=new WeakSet,xr=function(t,e,s,n){let o=e.name;return f(e,x,i(e,x)&bs|on(t)),o!==t.name&&(e.name=t.name),s!==n.provisional&&(s===n.length-1?n.pop():n.splice(s,1),n.unshift(e)),n.provisional++,e},Ys=new WeakSet,dn=function(t){let{atime:e,atimeMs:s,birthtime:n,birthtimeMs:o,blksize:h,blocks:a,ctime:l,ctimeMs:c,dev:u,gid:p,ino:m,mode:b,mtime:E,mtimeMs:w,nlink:S,rdev:y,size:v,uid:A}=t;f(this,$s,e),f(this,Ls,s),f(this,zs,n),f(this,js,o),f(this,Os,h),f(this,Ps,a),f(this,Us,l),f(this,Ws,c),f(this,Ns,u),f(this,Ds,p),f(this,Ms,m),f(this,Ts,b),f(this,Bs,E),f(this,_s,w),f(this,ks,S),f(this,Rs,y),f(this,Is,v),f(this,Fs,A);let T=on(t);f(this,x,i(this,x)&bs|T|ar),T!==mt&&T!==Mt&&T!==we&&f(this,x,i(this,x)|Es)},Be=new WeakMap,Ue=new WeakMap,_i=new WeakSet,Cr=function(t){f(this,Ue,!1);let e=i(this,Be).slice();i(this,Be).length=0,e.forEach(s=>s(null,t))},ve=new WeakMap;var Ve=class extends tt{sep="\\";splitSep=th;constructor(t,e=mt,s,n,o,h,a){super(t,e,s,n,o,h,a)}newChild(t,e=mt,s={}){return new Ve(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}getRootString(t){return He.win32.parse(t).root}getRoot(t){if(t=Qo(t.toUpperCase()),t===this.root.name)return this.root;for(let[e,s]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=s;return this.roots[t]=new Ke(t,this).root}sameRoot(t,e=this.root.name){return t=t.toUpperCase().replace(/\//g,"\\").replace(pr,"$1\\"),t===e}},qe=class extends tt{splitSep="/";sep="/";constructor(t,e=mt,s,n,o,h,a){super(t,e,s,n,o,h,a)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=mt,s={}){return new qe(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}},ze,Ge,Js,Xs,Mi=class{constructor(t=process.cwd(),e,s,{nocase:n,childrenCacheSize:o=16*1024,fs:h=Ss}={}){N(this,"root");N(this,"rootPath");N(this,"roots");N(this,"cwd");d(this,ze,void 0);d(this,Ge,void 0);d(this,Js,void 0);N(this,"nocase");d(this,Xs,void 0);f(this,Xs,dr(h)),(t instanceof URL||t.startsWith("file://"))&&(t=(0,ur.fileURLToPath)(t));let a=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(a),f(this,ze,new Oi),f(this,Ge,new Oi),f(this,Js,new hn(o));let l=a.substring(this.rootPath.length).split(s);if(l.length===1&&!l[0]&&l.pop(),n===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=n,this.root=this.newRoot(i(this,Xs)),this.roots[this.rootPath]=this.root;let c=this.root,u=l.length-1,p=e.sep,m=this.rootPath,b=!1;for(let E of l){let w=u--;c=c.child(E,{relative:new Array(w).fill("..").join(p),relativePosix:new Array(w).fill("..").join("/"),fullpath:m+=(b?"":p)+E}),b=!0}this.cwd=c}depth(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return i(this,Js)}resolve(...t){let e="";for(let o=t.length-1;o>=0;o--){let h=t[o];if(!(!h||h===".")&&(e=e?`${h}/${e}`:h,this.isAbsolute(h)))break}let s=i(this,ze).get(e);if(s!==void 0)return s;let n=this.cwd.resolve(e).fullpath();return i(this,ze).set(e,n),n}resolvePosix(...t){let e="";for(let o=t.length-1;o>=0;o--){let h=t[o];if(!(!h||h===".")&&(e=e?`${h}/${e}`:h,this.isAbsolute(h)))break}let s=i(this,Ge).get(e);if(s!==void 0)return s;let n=this.cwd.resolve(e).fullpathPosix();return i(this,Ge).set(e,n),n}relative(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s}=e;if(t.canReaddir()){let n=await t.readdir();return s?n:n.map(o=>o.name)}else return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s=!0}=e;return t.canReaddir()?s?t.readdirSync():t.readdirSync().map(n=>n.name):[]}async lstat(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t.withFileTypes,t=this.cwd);let s=await t.readlink();return e?s:s==null?void 0:s.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t.withFileTypes,t=this.cwd);let s=t.readlinkSync();return e?s:s==null?void 0:s.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t.withFileTypes,t=this.cwd);let s=await t.realpath();return e?s:s==null?void 0:s.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t.withFileTypes,t=this.cwd);let s=t.realpathSync();return e?s:s==null?void 0:s.fullpath()}async walk(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:n=!1,filter:o,walkFilter:h}=e,a=[];(!o||o(t))&&a.push(s?t:t.fullpath());let l=new Set,c=(p,m)=>{l.add(p),p.readdirCB((b,E)=>{if(b)return m(b);let w=E.length;if(!w)return m();let S=()=>{--w===0&&m()};for(let y of E)(!o||o(y))&&a.push(s?y:y.fullpath()),n&&y.isSymbolicLink()?y.realpath().then(v=>v!=null&&v.isUnknown()?v.lstat():v).then(v=>v!=null&&v.shouldWalk(l,h)?c(v,S):S()):y.shouldWalk(l,h)?c(y,S):S()},!0)},u=t;return new Promise((p,m)=>{c(u,b=>{if(b)return m(b);p(a)})})}walkSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:n=!1,filter:o,walkFilter:h}=e,a=[];(!o||o(t))&&a.push(s?t:t.fullpath());let l=new Set([t]);for(let c of l){let u=c.readdirSync();for(let p of u){(!o||o(p))&&a.push(s?p:p.fullpath());let m=p;if(p.isSymbolicLink()){if(!(n&&(m=p.realpathSync())))continue;m.isUnknown()&&m.lstatSync()}m.shouldWalk(l,h)&&l.add(m)}}return a}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:n=!1,filter:o,walkFilter:h}=e;(!o||o(t))&&(yield s?t:t.fullpath());let a=new Set([t]);for(let l of a){let c=l.readdirSync();for(let u of c){(!o||o(u))&&(yield s?u:u.fullpath());let p=u;if(u.isSymbolicLink()){if(!(n&&(p=u.realpathSync())))continue;p.isUnknown()&&p.lstatSync()}p.shouldWalk(a,h)&&a.add(p)}}}stream(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:n=!1,filter:o,walkFilter:h}=e,a=new ne({objectMode:!0});(!o||o(t))&&a.write(s?t:t.fullpath());let l=new Set,c=[t],u=0,p=()=>{let m=!1;for(;!m;){let b=c.shift();if(!b){u===0&&a.end();return}u++,l.add(b);let E=(S,y,v=!1)=>{if(S)return a.emit("error",S);if(n&&!v){let A=[];for(let T of y)T.isSymbolicLink()&&A.push(T.realpath().then(k=>k!=null&&k.isUnknown()?k.lstat():k));if(A.length){Promise.all(A).then(()=>E(null,y,!0));return}}for(let A of y)A&&(!o||o(A))&&(a.write(s?A:A.fullpath())||(m=!0));u--;for(let A of y){let T=A.realpathCached()||A;T.shouldWalk(l,h)&&c.push(T)}m&&!a.flowing?a.once("drain",p):w||p()},w=!0;b.readdirCB(E,!0),w=!1}};return p(),a}streamSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof tt||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:n=!1,filter:o,walkFilter:h}=e,a=new ne({objectMode:!0}),l=new Set;(!o||o(t))&&a.write(s?t:t.fullpath());let c=[t],u=0,p=()=>{let m=!1;for(;!m;){let b=c.shift();if(!b){u===0&&a.end();return}u++,l.add(b);let E=b.readdirSync();for(let w of E)(!o||o(w))&&(a.write(s?w:w.fullpath())||(m=!0));u--;for(let w of E){let S=w;if(w.isSymbolicLink()){if(!(n&&(S=w.realpathSync())))continue;S.isUnknown()&&S.lstatSync()}S.shouldWalk(l,h)&&c.push(S)}}m&&!a.flowing&&a.once("drain",p)};return p(),a}chdir(t=this.cwd){let e=this.cwd;this.cwd=typeof t=="string"?this.cwd.resolve(t):t,this.cwd[Sr](e)}};ze=new WeakMap,Ge=new WeakMap,Js=new WeakMap,Xs=new WeakMap;var Ke=class extends Mi{sep="\\";constructor(t=process.cwd(),e={}){let{nocase:s=!0}=e;super(t,He.win32,"\\",{...e,nocase:s}),this.nocase=s;for(let n=this.cwd;n;n=n.parent)n.nocase=this.nocase}parseRootPath(t){return He.win32.parse(t).root.toUpperCase()}newRoot(t){return new Ve(this.rootPath,Mt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}},Ye=class extends Mi{sep="/";constructor(t=process.cwd(),e={}){let{nocase:s=!1}=e;super(t,He.posix,"/",{...e,nocase:s}),this.nocase=s}parseRootPath(t){return"/"}newRoot(t){return new qe(this.rootPath,Mt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}},As=class extends Ye{constructor(t=process.cwd(),e={}){let{nocase:s=!0}=e;super(t,{...e,nocase:s})}},ra=process.platform==="win32"?Ve:qe,Ar=process.platform==="win32"?Ke:process.platform==="darwin"?As:Ye;var Nr=X("url");var sh=r=>r.length>=1,ih=r=>r.length>=1,$,ut,K,xe,Tt,Zs,he,ae,le,Je,pn=class{constructor(t,e,s,n){d(this,$,void 0);d(this,ut,void 0);d(this,K,void 0);N(this,"length");d(this,xe,void 0);d(this,Tt,void 0);d(this,Zs,void 0);d(this,he,void 0);d(this,ae,void 0);d(this,le,void 0);d(this,Je,!0);if(!sh(t))throw new TypeError("empty pattern list");if(!ih(e))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,s<0||s>=this.length)throw new TypeError("index out of range");if(f(this,$,t),f(this,ut,e),f(this,K,s),f(this,xe,n),i(this,K)===0){if(this.isUNC()){let[o,h,a,l,...c]=i(this,$),[u,p,m,b,...E]=i(this,ut);c[0]===""&&(c.shift(),E.shift());let w=[o,h,a,l,""].join("/"),S=[u,p,m,b,""].join("/");f(this,$,[w,...c]),f(this,ut,[S,...E]),this.length=i(this,$).length}else if(this.isDrive()||this.isAbsolute()){let[o,...h]=i(this,$),[a,...l]=i(this,ut);h[0]===""&&(h.shift(),l.shift());let c=o+"/",u=a+"/";f(this,$,[c,...h]),f(this,ut,[u,...l]),this.length=i(this,$).length}}}pattern(){return i(this,$)[i(this,K)]}isString(){return typeof i(this,$)[i(this,K)]=="string"}isGlobstar(){return i(this,$)[i(this,K)]===Y}isRegExp(){return i(this,$)[i(this,K)]instanceof RegExp}globString(){return f(this,Zs,i(this,Zs)||(i(this,K)===0?this.isAbsolute()?i(this,ut)[0]+i(this,ut).slice(1).join("/"):i(this,ut).join("/"):i(this,ut).slice(i(this,K)).join("/")))}hasMore(){return this.length>i(this,K)+1}rest(){return i(this,Tt)!==void 0?i(this,Tt):this.hasMore()?(f(this,Tt,new pn(i(this,$),i(this,ut),i(this,K)+1,i(this,xe))),f(i(this,Tt),le,i(this,le)),f(i(this,Tt),ae,i(this,ae)),f(i(this,Tt),he,i(this,he)),i(this,Tt)):f(this,Tt,null)}isUNC(){let t=i(this,$);return i(this,ae)!==void 0?i(this,ae):f(this,ae,i(this,xe)==="win32"&&i(this,K)===0&&t[0]===""&&t[1]===""&&typeof t[2]=="string"&&!!t[2]&&typeof t[3]=="string"&&!!t[3])}isDrive(){let t=i(this,$);return i(this,he)!==void 0?i(this,he):f(this,he,i(this,xe)==="win32"&&i(this,K)===0&&this.length>1&&typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]))}isAbsolute(){let t=i(this,$);return i(this,le)!==void 0?i(this,le):f(this,le,t[0]===""&&t.length>1||this.isDrive()||this.isUNC())}root(){let t=i(this,$)[0];return typeof t=="string"&&this.isAbsolute()&&i(this,K)===0?t:""}checkFollowGlobstar(){return!(i(this,K)===0||!this.isGlobstar()||!i(this,Je))}markFollowGlobstar(){return i(this,K)===0||!this.isGlobstar()||!i(this,Je)?!1:(f(this,Je,!1),!0)}},Xe=pn;$=new WeakMap,ut=new WeakMap,K=new WeakMap,xe=new WeakMap,Tt=new WeakMap,Zs=new WeakMap,he=new WeakMap,ae=new WeakMap,le=new WeakMap,Je=new WeakMap;var nh=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",Qs=class{relative;relativeChildren;absolute;absoluteChildren;constructor(t,{nobrace:e,nocase:s,noext:n,noglobstar:o,platform:h=nh}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[];let a={dot:!0,nobrace:e,nocase:s,noext:n,noglobstar:o,optimizationLevel:2,platform:h,nocomment:!0,nonegate:!0};for(let l of t){let c=new ht(l,a);for(let u=0;u<c.set.length;u++){let p=c.set[u],m=c.globParts[u];if(!p||!m)throw new Error("invalid pattern object");let b=new Xe(p,m,0,h),E=new ht(b.globString(),a),w=m[m.length-1]==="**",S=b.isAbsolute();S?this.absolute.push(E):this.relative.push(E),w&&(S?this.absoluteChildren.push(E):this.relativeChildren.push(E))}}}ignored(t){let e=t.fullpath(),s=`${e}/`,n=t.relative()||".",o=`${n}/`;for(let h of this.relative)if(h.match(n)||h.match(o))return!0;for(let h of this.absolute)if(h.match(e)||h.match(s))return!0;return!1}childrenIgnored(t){let e=t.fullpath()+"/",s=(t.relative()||".")+"/";for(let n of this.relativeChildren)if(n.match(s))return!0;for(let n of this.absoluteChildren)if(n.match(e))return!0;return!1}};var ti=class{store;constructor(t=new Map){this.store=t}copy(){return new ti(new Map(this.store))}hasWalked(t,e){var s;return(s=this.store.get(t.fullpath()))==null?void 0:s.has(e.globString())}storeWalked(t,e){let s=t.fullpath(),n=this.store.get(s);n?n.add(e.globString()):this.store.set(s,new Set([e.globString()]))}},mn=class{store=new Map;add(t,e,s){let n=(e?2:0)|(s?1:0),o=this.store.get(t);this.store.set(t,o===void 0?n:n&o)}entries(){return[...this.store.entries()].map(([t,e])=>[t,!!(e&2),!!(e&1)])}},gn=class{store=new Map;add(t,e){if(!t.canReaddir())return;let s=this.store.get(t);s?s.find(n=>n.globString()===e.globString())||s.push(e):this.store.set(t,[e])}get(t){let e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map(t=>[t,this.store.get(t)])}keys(){return[...this.store.keys()].filter(t=>t.canReaddir())}},Ce=class{hasWalkedCache;matches=new mn;subwalks=new gn;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new ti}processPatterns(t,e){this.patterns=e;let s=e.map(n=>[t,n]);for(let[n,o]of s){this.hasWalkedCache.storeWalked(n,o);let h=o.root(),a=o.isAbsolute()&&this.opts.absolute!==!1;if(h){n=n.resolve(h==="/"&&this.opts.root!==void 0?this.opts.root:h);let p=o.rest();if(p)o=p;else{this.matches.add(n,!0,!1);continue}}if(n.isENOENT())continue;let l,c,u=!1;for(;typeof(l=o.pattern())=="string"&&(c=o.rest());)n=n.resolve(l),o=c,u=!0;if(l=o.pattern(),c=o.rest(),u){if(this.hasWalkedCache.hasWalked(n,o))continue;this.hasWalkedCache.storeWalked(n,o)}if(typeof l=="string"){let p=l===".."||l===""||l===".";this.matches.add(n.resolve(l),a,p);continue}else if(l===Y){(!n.isSymbolicLink()||this.follow||o.checkFollowGlobstar())&&this.subwalks.add(n,o);let p=c==null?void 0:c.pattern(),m=c==null?void 0:c.rest();if(!c||(p===""||p===".")&&!m)this.matches.add(n,a,p===""||p===".");else if(p===".."){let b=n.parent||n;m?this.hasWalkedCache.hasWalked(b,m)||this.subwalks.add(b,m):this.matches.add(b,a,!0)}}else l instanceof RegExp&&this.subwalks.add(n,o)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new Ce(this.opts,this.hasWalkedCache)}filterEntries(t,e){let s=this.subwalks.get(t),n=this.child();for(let o of e)for(let h of s){let a=h.isAbsolute(),l=h.pattern(),c=h.rest();l===Y?n.testGlobstar(o,h,c,a):l instanceof RegExp?n.testRegExp(o,l,c,a):n.testString(o,l,c,a)}return n}testGlobstar(t,e,s,n){if((this.dot||!t.name.startsWith("."))&&(e.hasMore()||this.matches.add(t,n,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(s&&e.checkFollowGlobstar()?this.subwalks.add(t,s):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),s){let o=s.pattern();if(typeof o=="string"&&o!==".."&&o!==""&&o!==".")this.testString(t,o,s.rest(),n);else if(o===".."){let h=t.parent||t;this.subwalks.add(h,s)}else o instanceof RegExp&&this.testRegExp(t,o,s.rest(),n)}}testRegExp(t,e,s,n){!e.test(t.name)||(s?this.subwalks.add(t,s):this.matches.add(t,n,!1))}testString(t,e,s,n){!t.isNamed(e)||(s?this.subwalks.add(t,s):this.matches.add(t,n,!1))}};var rh=(r,t)=>typeof r=="string"?new Qs([r],t):Array.isArray(r)?new Qs(r,t):r,Ze,Qe,Ne,Yt,Ae,ii,wn,Wi=class{constructor(t,e,s){d(this,Yt);d(this,ii);N(this,"path");N(this,"patterns");N(this,"opts");N(this,"seen",new Set);N(this,"paused",!1);N(this,"aborted",!1);d(this,Ze,[]);d(this,Qe,void 0);d(this,Ne,void 0);N(this,"signal");N(this,"maxDepth");this.patterns=t,this.path=e,this.opts=s,f(this,Ne,!s.posix&&s.platform==="win32"?"\\":"/"),s.ignore&&f(this,Qe,rh(s.ignore,s)),this.maxDepth=s.maxDepth||1/0,s.signal&&(this.signal=s.signal,this.signal.addEventListener("abort",()=>{i(this,Ze).length=0}))}pause(){this.paused=!0}resume(){var e;if((e=this.signal)!=null&&e.aborted)return;this.paused=!1;let t;for(;!this.paused&&(t=i(this,Ze).shift());)t()}onResume(t){var e;(e=this.signal)!=null&&e.aborted||(this.paused?i(this,Ze).push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||await t.realpath(),!s)return;t=s}let n=t.isUnknown()||this.opts.stat;return this.matchCheckTest(n?await t.lstat():t,e)}matchCheckTest(t,e){return t&&(this.maxDepth===1/0||t.depth()<=this.maxDepth)&&(!e||t.canReaddir())&&(!this.opts.nodir||!t.isDirectory())&&!g(this,Yt,Ae).call(this,t)?t:void 0}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||t.realpathSync(),!s)return;t=s}let n=t.isUnknown()||this.opts.stat;return this.matchCheckTest(n?t.lstatSync():t,e)}matchFinish(t,e){if(g(this,Yt,Ae).call(this,t))return;let s=this.opts.absolute===void 0?e:this.opts.absolute;this.seen.add(t);let n=this.opts.mark&&t.isDirectory()?i(this,Ne):"";if(this.opts.withFileTypes)this.matchEmit(t);else if(s){let o=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(o+n)}else{let o=this.opts.posix?t.relativePosix():t.relative(),h=this.opts.dotRelative&&!o.startsWith(".."+i(this,Ne))?"."+i(this,Ne):"";this.matchEmit(o?h+o+n:"."+n)}}async match(t,e,s){let n=await this.matchCheck(t,s);n&&this.matchFinish(n,e)}matchSync(t,e,s){let n=this.matchCheckSync(t,s);n&&this.matchFinish(n,e)}walkCB(t,e,s){var n;(n=this.signal)!=null&&n.aborted&&s(),this.walkCB2(t,e,new Ce(this.opts),s)}walkCB2(t,e,s,n){var a;if(g(this,ii,wn).call(this,t))return n();if((a=this.signal)!=null&&a.aborted&&n(),this.paused){this.onResume(()=>this.walkCB2(t,e,s,n));return}s.processPatterns(t,e);let o=1,h=()=>{--o===0&&n()};for(let[l,c,u]of s.matches.entries())g(this,Yt,Ae).call(this,l)||(o++,this.match(l,c,u).then(()=>h()));for(let l of s.subwalkTargets()){if(this.maxDepth!==1/0&&l.depth()>=this.maxDepth)continue;o++;let c=l.readdirCached();l.calledReaddir()?this.walkCB3(l,c,s,h):l.readdirCB((u,p)=>this.walkCB3(l,p,s,h),!0)}h()}walkCB3(t,e,s,n){s=s.filterEntries(t,e);let o=1,h=()=>{--o===0&&n()};for(let[a,l,c]of s.matches.entries())g(this,Yt,Ae).call(this,a)||(o++,this.match(a,l,c).then(()=>h()));for(let[a,l]of s.subwalks.entries())o++,this.walkCB2(a,l,s.child(),h);h()}walkCBSync(t,e,s){var n;(n=this.signal)!=null&&n.aborted&&s(),this.walkCB2Sync(t,e,new Ce(this.opts),s)}walkCB2Sync(t,e,s,n){var a;if(g(this,ii,wn).call(this,t))return n();if((a=this.signal)!=null&&a.aborted&&n(),this.paused){this.onResume(()=>this.walkCB2Sync(t,e,s,n));return}s.processPatterns(t,e);let o=1,h=()=>{--o===0&&n()};for(let[l,c,u]of s.matches.entries())g(this,Yt,Ae).call(this,l)||this.matchSync(l,c,u);for(let l of s.subwalkTargets()){if(this.maxDepth!==1/0&&l.depth()>=this.maxDepth)continue;o++;let c=l.readdirSync();this.walkCB3Sync(l,c,s,h)}h()}walkCB3Sync(t,e,s,n){s=s.filterEntries(t,e);let o=1,h=()=>{--o===0&&n()};for(let[a,l,c]of s.matches.entries())g(this,Yt,Ae).call(this,a)||this.matchSync(a,l,c);for(let[a,l]of s.subwalks.entries())o++,this.walkCB2Sync(a,l,s.child(),h);h()}};Ze=new WeakMap,Qe=new WeakMap,Ne=new WeakMap,Yt=new WeakSet,Ae=function(t){var e,s;return this.seen.has(t)||!!((s=(e=i(this,Qe))==null?void 0:e.ignored)!=null&&s.call(e,t))},ii=new WeakSet,wn=function(t){var e,s;return!!((s=(e=i(this,Qe))==null?void 0:e.childrenIgnored)!=null&&s.call(e,t))};var ei=class extends Wi{matches;constructor(t,e,s){super(t,e,s),this.matches=new Set}matchEmit(t){this.matches.add(t)}async walk(){var t;if((t=this.signal)!=null&&t.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((e,s)=>{this.walkCB(this.path,this.patterns,()=>{var n;(n=this.signal)!=null&&n.aborted?s(this.signal.reason):e(this.matches)})}),this.matches}walkSync(){var t;if((t=this.signal)!=null&&t.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{var e;if((e=this.signal)!=null&&e.aborted)throw this.signal.reason}),this.matches}},si=class extends Wi{results;constructor(t,e,s){super(t,e,s),this.results=new ne({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){let t=this.path;return t.isUnknown()?t.lstat().then(()=>{this.walkCB(t,this.patterns,()=>this.results.end())}):this.walkCB(t,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var oh=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",kt=class{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=(0,Nr.fileURLToPath)(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof t=="string"&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(t=t.map(l=>l.replace(/\\/g,"/"))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map(l=>l.includes("/")?l:`./**/${l}`)}if(this.pattern=t,this.platform=e.platform||oh,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,e.nocase!==void 0&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let l=e.platform==="win32"?Ke:e.platform==="darwin"?As:e.platform?Ye:Ar;this.scurry=new l(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;let s=this.platform==="darwin"||this.platform==="win32",n={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:s,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},o=this.pattern.map(l=>new ht(l,n)),[h,a]=o.reduce((l,c)=>(l[0].push(...c.set),l[1].push(...c.globParts),l),[[],[]]);this.patterns=h.map((l,c)=>{let u=a[c];if(!u)throw new Error("invalid pattern object");return new Xe(l,u,0,this.platform)})}async walk(){return[...await new ei(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walk()]}walkSync(){return[...new ei(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walkSync()]}stream(){return new si(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).stream()}streamSync(){return new si(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var yn=(r,t={})=>{Array.isArray(r)||(r=[r]);for(let e of r)if(new ht(e,t).hasMagic())return!0;return!1};function ji(r,t={}){return new kt(r,t).streamSync()}function kr(r,t={}){return new kt(r,t).stream()}function Fr(r,t={}){return new kt(r,t).walkSync()}async function Tr(r,t={}){return new kt(r,t).walk()}function $i(r,t={}){return new kt(r,t).iterateSync()}function Dr(r,t={}){return new kt(r,t).iterate()}var hh=ji,ah=Object.assign(kr,{sync:ji}),lh=$i,ch=Object.assign(Dr,{sync:$i}),fh=Object.assign(Fr,{stream:ji,iterate:$i}),ni=Object.assign(Tr,{glob:Tr,globSync:Fr,sync:fh,globStream:kr,stream:ah,globStreamSync:ji,streamSync:hh,globIterate:Dr,iterate:ch,globIterateSync:$i,iterateSync:lh,Glob:kt,hasMagic:yn,escape:ke,unescape:wt});ni.glob=ni;var Mr=es(X("os"));async function Ir(r,t,e,s,n,o){let h=await Lr(r,t,e,s,n);if(!h)return;let a=await mh(e.cwd,s),l={key:h,value:a};for(let c of o)await c.saveCacheEntry(l)}async function Pr(r,t,e,s,n,o){let h=await Lr(r,t,e,s,n);if(!!h)for(let a of o){let l=await a.loadCacheEntry(h);if(l)return await gh(e.cwd,l.value),[l,a]}}async function Lr(r,t,e,s,n){let o=e.script,h=e.args,a=r.lockFileChecksum,l=bn(r.topLevelWorkspace.locator),c=bn(t),u=await _r(e.cwd,s.inputIncludes,s.inputExcludes),p=await dh(r,t,n),m=uh(e,s);if(!!p)return{script:o,args:h,lockFileChecksum:a,topLevelWorkspaceLocator:l,workspaceLocator:c,globFileHashes:u,dependencyWorkspacesGlobFileHashes:p,environmentVariables:m}}function uh(r,t){let e={};for(let s of ri(t.environmentVariableIncludes)){let n={},o=new RegExp(s);for(let[h,a]of Object.entries(r.env))o.test(h)&&(n[h]=a);e[s]=n}return e}async function dh(r,t,e){let s={},n=r.getWorkspaceByLocator(t);for(let o of n.getRecursiveWorkspaceDependencies()){let h=bn(o.locator),a=await li(o.cwd,e);if(!a){e.reportError(Rr.MessageName.UNNAMED,`Did not find a valid ${P} in workspace ${h}. All workspaces you depend on also need to be cachable!`);return}let l={};for(let c of a.scriptsToCache)l[c.scriptName]=await _r(o.cwd,c.outputIncludes,c.outputExcludes);s[h]=l}return s}async function _r(r,t,e){let s={};for(let n of ri(t)){let o=J.npath.fromPortablePath(r),h=ni.sync(n,{cwd:o,ignore:ri(e)});h.sort();let a={};for(let l of h){let c=J.npath.toPortablePath(l),u=J.ppath.resolve(r,c);(await J.xfs.statPromise(u)).isFile()&&(a[c]=await ph(u))}s[n]=a}return s}async function ph(r){let t=Or.default.createHash("sha512"),e=await J.xfs.readFilePromise(r,"base64");return t.update(e),t.digest("base64")}async function mh(r,t){let e={};for(let o of ri(t.outputIncludes)){let h=J.npath.fromPortablePath(r),a=ni.sync(o,{cwd:h,ignore:ri(t.outputExcludes)});a.sort();let l={};for(let c of a){let u=J.npath.toPortablePath(c),p=J.ppath.resolve(r,u);if((await J.xfs.statPromise(p)).isFile()){let b=await J.xfs.readFilePromise(p,"base64");l[u]=b.toString()}}e[o]=l}let s=Date.now(),n=Mr.default.hostname();return{globFileContents:e,createdAt:s,createdBy:n}}async function gh(r,t){for(let e of Object.values(t.globFileContents))for(let[s,n]of Object.entries(e)){let o=J.ppath.join(r,s),h=J.ppath.dirname(o);await J.xfs.mkdirPromise(h,{recursive:!0}),await J.xfs.writeFilePromise(o,n,{encoding:"base64"})}}function bn(r){return r.scope?`${r.scope}/${r.name}@${r.reference}`:`${r.name}@${r.reference}`}function ri(r){return r===void 0?[]:typeof r=="string"?[r]:r}var wh="YSC_DISABLED",yh="YSC_READ_DISABLED",bh="YSC_WRITE_DISABLED";function Wr(r){return Sn(r,wh,"cacheDisabled")}function jr(r){return Sn(r,yh,"cacheReadDisabled")}function $r(r){return Sn(r,bh,"cacheWriteDisabled")}function Sn(r,t,e){let s=process.env[t];return typeof s=="string"?s==="true":r[e]||!1}async function Sh(r){let t=_t.Configuration.create(r.cwd);return _t.StreamReport.start({configuration:t,includeFooter:!1,stdout:r.stdout},async()=>{}).then(e=>[e,t])}var Eh=async(r,t,e,s,n)=>{let[o,h]=await Sh(n),a=await li(n.cwd,o);if(!a||Wr(a))return r;let l=a.scriptsToCache.find(u=>u.scriptName===s);if(!l)return r;let c=await xn(a,{project:t,locator:e,scriptName:s,extra:n});return c.length===0&&o.reportError(_t.MessageName.UNNAMED,"Script was configured to be cached but no cache implementation was found! Please make sure to add cache implementations via their own plugin."),async()=>{if(!jr(a)){let p=await Pr(t,e,n,l,o,c);if(p){let[m,b]=p,E=new Date(m.value.createdAt).toUTCString(),w=m.value.createdBy;return o.reportInfo(_t.MessageName.UNNAMED,`Script execution result was restored from ${b.name} cache! Created ${E} by ${w}`),Promise.resolve(0)}}let u=await r();return u===0&&!$r(a)&&await vh(o,h,"Updating script execution result cache",async()=>{await Ir(t,e,n,l,o,c)}),u}};async function vh(r,t,e,s){let n=new Date().getMilliseconds();r.reportInfo(null,`\u250C ${e}`),await s();let h=new Date().getMilliseconds()-n;h>200?r.reportInfo(null,`\u2514 Completed in ${_t.formatUtils.pretty(t,h,_t.formatUtils.Type.DURATION)}`):r.reportInfo(null,"\u2514 Completed")}var xh={hooks:{wrapScriptExecution:Eh}},Ch=xh;return Kr(Ah);})();
return plugin;
}
};
