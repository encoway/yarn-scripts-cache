/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-build-result-cache",
factory: function (require) {
"use strict";var plugin=(()=>{var Ge=Object.create;var et=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var $e=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty;var w=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var O=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Be=(t,e)=>{for(var r in e)et(t,r,{get:e[r],enumerable:!0})},Ut=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ue(e))!We.call(t,n)&&n!==r&&et(t,n,{get:()=>e[n],enumerable:!(i=Te(e,n))||i.enumerable});return t};var $t=(t,e,r)=>(r=t!=null?Ge($e(t)):{},Ut(e||!t||!t.__esModule?et(r,"default",{value:t,enumerable:!0}):r,t)),He=t=>Ut(et({},"__esModule",{value:!0}),t);var Ht=O(ft=>{var $=w("path"),x=process.platform==="win32",L=w("fs"),ze=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Ze(){var t;if(ze){var e=new Error;t=r}else t=i;return t;function r(n){n&&(e.message=n.message,n=e,i(n))}function i(n){if(n){if(process.throwDeprecation)throw n;if(!process.noDeprecation){var a="fs: missing callback "+(n.stack||n.message);process.traceDeprecation?console.trace(a):console.error(a)}}}}function Xe(t){return typeof t=="function"?t:Ze()}var ui=$.normalize;x?D=/(.*?)(?:[\/\\]+|$)/g:D=/(.*?)(?:[\/]+|$)/g;var D;x?z=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:z=/^[\/]*/;var z;ft.realpathSync=function(e,r){if(e=$.resolve(e),r&&Object.prototype.hasOwnProperty.call(r,e))return r[e];var i=e,n={},a={},s,o,c,u;d();function d(){var v=z.exec(e);s=v[0].length,o=v[0],c=v[0],u="",x&&!a[c]&&(L.lstatSync(c),a[c]=!0)}for(;s<e.length;){D.lastIndex=s;var p=D.exec(e);if(u=o,o+=p[0],c=u+p[1],s=D.lastIndex,!(a[c]||r&&r[c]===c)){var l;if(r&&Object.prototype.hasOwnProperty.call(r,c))l=r[c];else{var h=L.lstatSync(c);if(!h.isSymbolicLink()){a[c]=!0,r&&(r[c]=c);continue}var f=null;if(!x){var g=h.dev.toString(32)+":"+h.ino.toString(32);n.hasOwnProperty(g)&&(f=n[g])}f===null&&(L.statSync(c),f=L.readlinkSync(c)),l=$.resolve(u,f),r&&(r[c]=l),x||(n[g]=f)}e=$.resolve(l,e.slice(s)),d()}}return r&&(r[i]=e),e};ft.realpath=function(e,r,i){if(typeof i!="function"&&(i=Xe(r),r=null),e=$.resolve(e),r&&Object.prototype.hasOwnProperty.call(r,e))return process.nextTick(i.bind(null,null,r[e]));var n=e,a={},s={},o,c,u,d;p();function p(){var v=z.exec(e);o=v[0].length,c=v[0],u=v[0],d="",x&&!s[u]?L.lstat(u,function(b){if(b)return i(b);s[u]=!0,l()}):process.nextTick(l)}function l(){if(o>=e.length)return r&&(r[n]=e),i(null,e);D.lastIndex=o;var v=D.exec(e);return d=c,c+=v[0],u=d+v[1],o=D.lastIndex,s[u]||r&&r[u]===u?process.nextTick(l):r&&Object.prototype.hasOwnProperty.call(r,u)?g(r[u]):L.lstat(u,h)}function h(v,b){if(v)return i(v);if(!b.isSymbolicLink())return s[u]=!0,r&&(r[u]=u),process.nextTick(l);if(!x){var I=b.dev.toString(32)+":"+b.ino.toString(32);if(a.hasOwnProperty(I))return f(null,a[I],u)}L.stat(u,function(M){if(M)return i(M);L.readlink(u,function(E,m){x||(a[I]=m),f(E,m)})})}function f(v,b,I){if(v)return i(v);var M=$.resolve(d,b);r&&(r[I]=M),g(M)}function g(v){e=$.resolve(v,e.slice(o)),p()}}});var vt=O((hi,Jt)=>{Jt.exports=R;R.realpath=R;R.sync=mt;R.realpathSync=mt;R.monkeypatch=tr;R.unmonkeypatch=er;var V=w("fs"),dt=V.realpath,pt=V.realpathSync,Ye=process.version,Kt=/^v[0-5]\./.test(Ye),Qt=Ht();function Vt(t){return t&&t.syscall==="realpath"&&(t.code==="ELOOP"||t.code==="ENOMEM"||t.code==="ENAMETOOLONG")}function R(t,e,r){if(Kt)return dt(t,e,r);typeof e=="function"&&(r=e,e=null),dt(t,e,function(i,n){Vt(i)?Qt.realpath(t,e,r):r(i,n)})}function mt(t,e){if(Kt)return pt(t,e);try{return pt(t,e)}catch(r){if(Vt(r))return Qt.realpathSync(t,e);throw r}}function tr(){V.realpath=R,V.realpathSync=mt}function er(){V.realpath=dt,V.realpathSync=pt}});var Zt=O((fi,zt)=>{var rr=typeof process=="object"&&process&&process.platform==="win32";zt.exports=rr?{sep:"\\"}:{sep:"/"}});var re=O((di,ee)=>{"use strict";ee.exports=Yt;function Yt(t,e,r){t instanceof RegExp&&(t=Xt(t,r)),e instanceof RegExp&&(e=Xt(e,r));var i=te(t,e,r);return i&&{start:i[0],end:i[1],pre:r.slice(0,i[0]),body:r.slice(i[0]+t.length,i[1]),post:r.slice(i[1]+e.length)}}function Xt(t,e){var r=e.match(t);return r?r[0]:null}Yt.range=te;function te(t,e,r){var i,n,a,s,o,c=r.indexOf(t),u=r.indexOf(e,c+1),d=c;if(c>=0&&u>0){if(t===e)return[c,u];for(i=[],a=r.length;d>=0&&!o;)d==c?(i.push(d),c=r.indexOf(t,d+1)):i.length==1?o=[i.pop(),u]:(n=i.pop(),n<a&&(a=n,s=u),u=r.indexOf(e,d+1)),d=c<u&&c>=0?c:u;i.length&&(o=[a,s])}return o}});var le=O((pi,ue)=>{var ie=re();ue.exports=sr;var ne="\0SLASH"+Math.random()+"\0",se="\0OPEN"+Math.random()+"\0",yt="\0CLOSE"+Math.random()+"\0",ae="\0COMMA"+Math.random()+"\0",oe="\0PERIOD"+Math.random()+"\0";function gt(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function ir(t){return t.split("\\\\").join(ne).split("\\{").join(se).split("\\}").join(yt).split("\\,").join(ae).split("\\.").join(oe)}function nr(t){return t.split(ne).join("\\").split(se).join("{").split(yt).join("}").split(ae).join(",").split(oe).join(".")}function ce(t){if(!t)return[""];var e=[],r=ie("{","}",t);if(!r)return t.split(",");var i=r.pre,n=r.body,a=r.post,s=i.split(",");s[s.length-1]+="{"+n+"}";var o=ce(a);return a.length&&(s[s.length-1]+=o.shift(),s.push.apply(s,o)),e.push.apply(e,s),e}function sr(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),Z(ir(t),!0).map(nr)):[]}function ar(t){return"{"+t+"}"}function or(t){return/^-?0\d/.test(t)}function cr(t,e){return t<=e}function ur(t,e){return t>=e}function Z(t,e){var r=[],i=ie("{","}",t);if(!i)return[t];var n=i.pre,a=i.post.length?Z(i.post,!1):[""];if(/\$$/.test(i.pre))for(var s=0;s<a.length;s++){var o=n+"{"+i.body+"}"+a[s];r.push(o)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),d=c||u,p=i.body.indexOf(",")>=0;if(!d&&!p)return i.post.match(/,.*\}/)?(t=i.pre+"{"+i.body+yt+i.post,Z(t)):[t];var l;if(d)l=i.body.split(/\.\./);else if(l=ce(i.body),l.length===1&&(l=Z(l[0],!1).map(ar),l.length===1))return a.map(function(lt){return i.pre+l[0]+lt});var h;if(d){var f=gt(l[0]),g=gt(l[1]),v=Math.max(l[0].length,l[1].length),b=l.length==3?Math.abs(gt(l[2])):1,I=cr,M=g<f;M&&(b*=-1,I=ur);var E=l.some(or);h=[];for(var m=f;I(m,g);m+=b){var A;if(u)A=String.fromCharCode(m),A==="\\"&&(A="");else if(A=String(m),E){var T=v-A.length;if(T>0){var j=new Array(T+1).join("0");m<0?A="-"+j+A.slice(1):A=j+A}}h.push(A)}}else{h=[];for(var F=0;F<l.length;F++)h.push.apply(h,Z(l[F],!1))}for(var F=0;F<h.length;F++)for(var s=0;s<a.length;s++){var o=n+h[F]+a[s];(!e||d||o)&&r.push(o)}}return r}});var at=O((vi,_t)=>{var P=_t.exports=(t,e,r={})=>(st(e),!r.nocomment&&e.charAt(0)==="#"?!1:new J(e,r).match(t));_t.exports=P;var bt=Zt();P.sep=bt.sep;var N=Symbol("globstar **");P.GLOBSTAR=N;var lr=le(),he={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},wt="[^/]",Et=wt+"*?",hr="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",fr="(?:(?!(?:\\/|^)\\.).)*?",pe=t=>t.split("").reduce((e,r)=>(e[r]=!0,e),{}),fe=pe("().*{}+?[]^$\\!"),dr=pe("[.("),de=/\/+/;P.filter=(t,e={})=>(r,i,n)=>P(r,t,e);var q=(t,e={})=>{let r={};return Object.keys(t).forEach(i=>r[i]=t[i]),Object.keys(e).forEach(i=>r[i]=e[i]),r};P.defaults=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return P;let e=P,r=(i,n,a)=>e(i,n,q(t,a));return r.Minimatch=class extends e.Minimatch{constructor(n,a){super(n,q(t,a))}},r.Minimatch.defaults=i=>e.defaults(q(t,i)).Minimatch,r.filter=(i,n)=>e.filter(i,q(t,n)),r.defaults=i=>e.defaults(q(t,i)),r.makeRe=(i,n)=>e.makeRe(i,q(t,n)),r.braceExpand=(i,n)=>e.braceExpand(i,q(t,n)),r.match=(i,n,a)=>e.match(i,n,q(t,a)),r};P.braceExpand=(t,e)=>me(t,e);var me=(t,e={})=>(st(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:lr(t)),pr=1024*64,st=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>pr)throw new TypeError("pattern is too long")},nt=Symbol("subparse");P.makeRe=(t,e)=>new J(t,e||{}).makeRe();P.match=(t,e,r={})=>{let i=new J(e,r);return t=t.filter(n=>i.match(n)),i.options.nonull&&!t.length&&t.push(e),t};var mr=t=>t.replace(/\\(.)/g,"$1"),vr=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),J=class{constructor(e,r){st(e),r||(r={}),this.options=r,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!r.windowsPathsNoEscape||r.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!r.partial,this.make()}debug(){}make(){let e=this.pattern,r=this.options;if(!r.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let i=this.globSet=this.braceExpand();r.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,i),i=this.globParts=i.map(n=>n.split(de)),this.debug(this.pattern,i),i=i.map((n,a,s)=>n.map(this.parse,this)),this.debug(this.pattern,i),i=i.filter(n=>n.indexOf(!1)===-1),this.debug(this.pattern,i),this.set=i}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,r=!1,i=0;for(let n=0;n<e.length&&e.charAt(n)==="!";n++)r=!r,i++;i&&(this.pattern=e.substr(i)),this.negate=r}matchOne(e,r,i){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:r}),this.debug("matchOne",e.length,r.length);for(var a=0,s=0,o=e.length,c=r.length;a<o&&s<c;a++,s++){this.debug("matchOne loop");var u=r[s],d=e[a];if(this.debug(r,u,d),u===!1)return!1;if(u===N){this.debug("GLOBSTAR",[r,u,d]);var p=a,l=s+1;if(l===c){for(this.debug("** at the end");a<o;a++)if(e[a]==="."||e[a]===".."||!n.dot&&e[a].charAt(0)===".")return!1;return!0}for(;p<o;){var h=e[p];if(this.debug(`
globstar while`,e,p,r,l,h),this.matchOne(e.slice(p),r.slice(l),i))return this.debug("globstar found match!",p,o,h),!0;if(h==="."||h===".."||!n.dot&&h.charAt(0)==="."){this.debug("dot detected!",e,p,r,l);break}this.debug("globstar swallow a segment, and continue"),p++}return!!(i&&(this.debug(`
>>> no match, partial?`,e,p,r,l),p===o))}var f;if(typeof u=="string"?(f=d===u,this.debug("string match",u,d,f)):(f=d.match(u),this.debug("pattern match",u,d,f)),!f)return!1}if(a===o&&s===c)return!0;if(a===o)return i;if(s===c)return a===o-1&&e[a]==="";throw new Error("wtf?")}braceExpand(){return me(this.pattern,this.options)}parse(e,r){st(e);let i=this.options;if(e==="**")if(i.noglobstar)e="*";else return N;if(e==="")return"";let n="",a=!!i.nocase,s=!1,o=[],c=[],u,d=!1,p=-1,l=-1,h,f,g,v=e.charAt(0)==="."?"":i.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",b=()=>{if(u){switch(u){case"*":n+=Et,a=!0;break;case"?":n+=wt,a=!0;break;default:n+="\\"+u;break}this.debug("clearStateChar %j %j",u,n),u=!1}};for(let E=0,m;E<e.length&&(m=e.charAt(E));E++){if(this.debug("%s	%s %s %j",e,E,n,m),s){if(m==="/")return!1;fe[m]&&(n+="\\"),n+=m,s=!1;continue}switch(m){case"/":return!1;case"\\":b(),s=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,E,n,m),d){this.debug("  in class"),m==="!"&&E===l+1&&(m="^"),n+=m;continue}this.debug("call clearStateChar %j",u),b(),u=m,i.noext&&b();continue;case"(":if(d){n+="(";continue}if(!u){n+="\\(";continue}o.push({type:u,start:E-1,reStart:n.length,open:he[u].open,close:he[u].close}),n+=u==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",u,n),u=!1;continue;case")":if(d||!o.length){n+="\\)";continue}b(),a=!0,f=o.pop(),n+=f.close,f.type==="!"&&c.push(f),f.reEnd=n.length;continue;case"|":if(d||!o.length){n+="\\|";continue}b(),n+="|";continue;case"[":if(b(),d){n+="\\"+m;continue}d=!0,l=E,p=n.length,n+=m;continue;case"]":if(E===l+1||!d){n+="\\"+m;continue}h=e.substring(l+1,E);try{RegExp("["+h+"]")}catch{g=this.parse(h,nt),n=n.substr(0,p)+"\\["+g[0]+"\\]",a=a||g[1],d=!1;continue}a=!0,d=!1,n+=m;continue;default:b(),fe[m]&&!(m==="^"&&d)&&(n+="\\"),n+=m;break}}for(d&&(h=e.substr(l+1),g=this.parse(h,nt),n=n.substr(0,p)+"\\["+g[0],a=a||g[1]),f=o.pop();f;f=o.pop()){let E;E=n.slice(f.reStart+f.open.length),this.debug("setting tail",n,f),E=E.replace(/((?:\\{2}){0,64})(\\?)\|/g,(A,T,j)=>(j||(j="\\"),T+T+j+"|")),this.debug(`tail=%j
   %s`,E,E,f,n);let m=f.type==="*"?Et:f.type==="?"?wt:"\\"+f.type;a=!0,n=n.slice(0,f.reStart)+m+"\\("+E}b(),s&&(n+="\\\\");let I=dr[n.charAt(0)];for(let E=c.length-1;E>-1;E--){let m=c[E],A=n.slice(0,m.reStart),T=n.slice(m.reStart,m.reEnd-8),j=n.slice(m.reEnd),F=n.slice(m.reEnd-8,m.reEnd)+j,lt=A.split("(").length-1,ht=j;for(let Tt=0;Tt<lt;Tt++)ht=ht.replace(/\)[+*?]?/,"");j=ht;let qe=j===""&&r!==nt?"$":"";n=A+T+j+qe+F}if(n!==""&&a&&(n="(?=.)"+n),I&&(n=v+n),r===nt)return[n,a];if(!a)return mr(e);let M=i.nocase?"i":"";try{return Object.assign(new RegExp("^"+n+"$",M),{_glob:e,_src:n})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let r=this.options,i=r.noglobstar?Et:r.dot?hr:fr,n=r.nocase?"i":"",a=e.map(s=>(s=s.map(o=>typeof o=="string"?vr(o):o===N?N:o._src).reduce((o,c)=>(o[o.length-1]===N&&c===N||o.push(c),o),[]),s.forEach((o,c)=>{o!==N||s[c-1]===N||(c===0?s.length>1?s[c+1]="(?:\\/|"+i+"\\/)?"+s[c+1]:s[c]=i:c===s.length-1?s[c-1]+="(?:\\/|"+i+")?":(s[c-1]+="(?:\\/|\\/"+i+"\\/)"+s[c+1],s[c+1]=N))}),s.filter(o=>o!==N).join("/"))).join("|");a="^(?:"+a+")$",this.negate&&(a="^(?!"+a+").*$");try{this.regexp=new RegExp(a,n)}catch{this.regexp=!1}return this.regexp}match(e,r=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&r)return!0;let i=this.options;bt.sep!=="/"&&(e=e.split(bt.sep).join("/")),e=e.split(de),this.debug(this.pattern,"split",e);let n=this.set;this.debug(this.pattern,"set",n);let a;for(let s=e.length-1;s>=0&&(a=e[s],!a);s--);for(let s=0;s<n.length;s++){let o=n[s],c=e;if(i.matchBase&&o.length===1&&(c=[a]),this.matchOne(c,o,r))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(e){return P.defaults(e).Minimatch}};P.Minimatch=J});var ve=O((gi,St)=>{typeof Object.create=="function"?St.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:St.exports=function(e,r){if(r){e.super_=r;var i=function(){};i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e}}});var ge=O((yi,At)=>{try{if(kt=w("util"),typeof kt.inherits!="function")throw"";At.exports=kt.inherits}catch{At.exports=ve()}var kt});var Ot=O(G=>{G.setopts=_r;G.ownProp=ye;G.makeAbs=X;G.finish=Sr;G.mark=kr;G.isIgnored=be;G.childrenIgnored=Ar;function ye(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var gr=w("fs"),W=w("path"),yr=at(),Ee=w("path").isAbsolute,Ct=yr.Minimatch;function Er(t,e){return t.localeCompare(e,"en")}function br(t,e){t.ignore=e.ignore||[],Array.isArray(t.ignore)||(t.ignore=[t.ignore]),t.ignore.length&&(t.ignore=t.ignore.map(wr))}function wr(t){var e=null;if(t.slice(-3)==="/**"){var r=t.replace(/(\/\*\*)+$/,"");e=new Ct(r,{dot:!0})}return{matcher:new Ct(t,{dot:!0}),gmatcher:e}}function _r(t,e,r){if(r||(r={}),r.matchBase&&e.indexOf("/")===-1){if(r.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}t.silent=!!r.silent,t.pattern=e,t.strict=r.strict!==!1,t.realpath=!!r.realpath,t.realpathCache=r.realpathCache||Object.create(null),t.follow=!!r.follow,t.dot=!!r.dot,t.mark=!!r.mark,t.nodir=!!r.nodir,t.nodir&&(t.mark=!0),t.sync=!!r.sync,t.nounique=!!r.nounique,t.nonull=!!r.nonull,t.nosort=!!r.nosort,t.nocase=!!r.nocase,t.stat=!!r.stat,t.noprocess=!!r.noprocess,t.absolute=!!r.absolute,t.fs=r.fs||gr,t.maxLength=r.maxLength||1/0,t.cache=r.cache||Object.create(null),t.statCache=r.statCache||Object.create(null),t.symlinks=r.symlinks||Object.create(null),br(t,r),t.changedCwd=!1;var i=process.cwd();ye(r,"cwd")?(t.cwd=W.resolve(r.cwd),t.changedCwd=t.cwd!==i):t.cwd=W.resolve(i),t.root=r.root||W.resolve(t.cwd,"/"),t.root=W.resolve(t.root),t.cwdAbs=Ee(t.cwd)?t.cwd:X(t,t.cwd),t.nomount=!!r.nomount,process.platform==="win32"&&(t.root=t.root.replace(/\\/g,"/"),t.cwd=t.cwd.replace(/\\/g,"/"),t.cwdAbs=t.cwdAbs.replace(/\\/g,"/")),r.nonegate=!0,r.nocomment=!0,r.allowWindowsEscape=!0,t.minimatch=new Ct(e,r),t.options=t.minimatch.options}function Sr(t){for(var e=t.nounique,r=e?[]:Object.create(null),i=0,n=t.matches.length;i<n;i++){var a=t.matches[i];if(!a||Object.keys(a).length===0){if(t.nonull){var s=t.minimatch.globSet[i];e?r.push(s):r[s]=!0}}else{var o=Object.keys(a);e?r.push.apply(r,o):o.forEach(function(c){r[c]=!0})}}if(e||(r=Object.keys(r)),t.nosort||(r=r.sort(Er)),t.mark){for(var i=0;i<r.length;i++)r[i]=t._mark(r[i]);t.nodir&&(r=r.filter(function(c){var u=!/\/$/.test(c),d=t.cache[c]||t.cache[X(t,c)];return u&&d&&(u=d!=="DIR"&&!Array.isArray(d)),u}))}t.ignore.length&&(r=r.filter(function(c){return!be(t,c)})),t.found=r}function kr(t,e){var r=X(t,e),i=t.cache[r],n=e;if(i){var a=i==="DIR"||Array.isArray(i),s=e.slice(-1)==="/";if(a&&!s?n+="/":!a&&s&&(n=n.slice(0,-1)),n!==e){var o=X(t,n);t.statCache[o]=t.statCache[r],t.cache[o]=t.cache[r]}}return n}function X(t,e){var r=e;return e.charAt(0)==="/"?r=W.join(t.root,e):Ee(e)||e===""?r=e:t.changedCwd?r=W.resolve(t.cwd,e):r=W.resolve(e),process.platform==="win32"&&(r=r.replace(/\\/g,"/")),r}function be(t,e){return t.ignore.length?t.ignore.some(function(r){return r.matcher.match(e)||!!(r.gmatcher&&r.gmatcher.match(e))}):!1}function Ar(t,e){return t.ignore.length?t.ignore.some(function(r){return!!(r.gmatcher&&r.gmatcher.match(e))}):!1}});var Ae=O((Si,ke)=>{ke.exports=Se;Se.GlobSync=_;var Cr=vt(),we=at(),bi=we.Minimatch,wi=Nt().Glob,_i=w("util"),Pt=w("path"),_e=w("assert"),ot=w("path").isAbsolute,B=Ot(),Or=B.setopts,jt=B.ownProp,Pr=B.childrenIgnored,jr=B.isIgnored;function Se(t,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new _(t,e).found}function _(t,e){if(!t)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof _))return new _(t,e);if(Or(this,t,e),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var i=0;i<r;i++)this._process(this.minimatch.set[i],i,!1);this._finish()}_.prototype._finish=function(){if(_e.ok(this instanceof _),this.realpath){var t=this;this.matches.forEach(function(e,r){var i=t.matches[r]=Object.create(null);for(var n in e)try{n=t._makeAbs(n);var a=Cr.realpathSync(n,t.realpathCache);i[a]=!0}catch(s){if(s.syscall==="stat")i[t._makeAbs(n)]=!0;else throw s}})}B.finish(this)};_.prototype._process=function(t,e,r){_e.ok(this instanceof _);for(var i=0;typeof t[i]=="string";)i++;var n;switch(i){case t.length:this._processSimple(t.join("/"),e);return;case 0:n=null;break;default:n=t.slice(0,i).join("/");break}var a=t.slice(i),s;n===null?s=".":((ot(n)||ot(t.map(function(u){return typeof u=="string"?u:"[*]"}).join("/")))&&(!n||!ot(n))&&(n="/"+n),s=n);var o=this._makeAbs(s);if(!Pr(this,s)){var c=a[0]===we.GLOBSTAR;c?this._processGlobStar(n,s,o,a,e,r):this._processReaddir(n,s,o,a,e,r)}};_.prototype._processReaddir=function(t,e,r,i,n,a){var s=this._readdir(r,a);if(!!s){for(var o=i[0],c=!!this.minimatch.negate,u=o._glob,d=this.dot||u.charAt(0)===".",p=[],l=0;l<s.length;l++){var h=s[l];if(h.charAt(0)!=="."||d){var f;c&&!t?f=!h.match(o):f=h.match(o),f&&p.push(h)}}var g=p.length;if(g!==0){if(i.length===1&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(var l=0;l<g;l++){var h=p[l];t&&(t.slice(-1)!=="/"?h=t+"/"+h:h=t+h),h.charAt(0)==="/"&&!this.nomount&&(h=Pt.join(this.root,h)),this._emitMatch(n,h)}return}i.shift();for(var l=0;l<g;l++){var h=p[l],v;t?v=[t,h]:v=[h],this._process(v.concat(i),n,a)}}}};_.prototype._emitMatch=function(t,e){if(!jr(this,e)){var r=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=r),!this.matches[t][e]){if(this.nodir){var i=this.cache[r];if(i==="DIR"||Array.isArray(i))return}this.matches[t][e]=!0,this.stat&&this._stat(e)}}};_.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var e,r,i;try{r=this.fs.lstatSync(t)}catch(a){if(a.code==="ENOENT")return null}var n=r&&r.isSymbolicLink();return this.symlinks[t]=n,!n&&r&&!r.isDirectory()?this.cache[t]="FILE":e=this._readdir(t,!1),e};_.prototype._readdir=function(t,e){var r;if(e&&!jt(this.symlinks,t))return this._readdirInGlobStar(t);if(jt(this.cache,t)){var i=this.cache[t];if(!i||i==="FILE")return null;if(Array.isArray(i))return i}try{return this._readdirEntries(t,this.fs.readdirSync(t))}catch(n){return this._readdirError(t,n),null}};_.prototype._readdirEntries=function(t,e){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];t==="/"?i=t+i:i=t+"/"+i,this.cache[i]=!0}return this.cache[t]=e,e};_.prototype._readdirError=function(t,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(t);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);throw i.path=this.cwd,i.code=e.code,i}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};_.prototype._processGlobStar=function(t,e,r,i,n,a){var s=this._readdir(r,a);if(!!s){var o=i.slice(1),c=t?[t]:[],u=c.concat(o);this._process(u,n,!1);var d=s.length,p=this.symlinks[r];if(!(p&&a))for(var l=0;l<d;l++){var h=s[l];if(!(h.charAt(0)==="."&&!this.dot)){var f=c.concat(s[l],o);this._process(f,n,!0);var g=c.concat(s[l],i);this._process(g,n,!0)}}}};_.prototype._processSimple=function(t,e){var r=this._stat(t);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!r){if(t&&ot(t)&&!this.nomount){var i=/[\/\\]$/.test(t);t.charAt(0)==="/"?t=Pt.join(this.root,t):(t=Pt.resolve(this.root,t),i&&(t+="/"))}process.platform==="win32"&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t)}};_.prototype._stat=function(t){var e=this._makeAbs(t),r=t.slice(-1)==="/";if(t.length>this.maxLength)return!1;if(!this.stat&&jt(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!r||s==="DIR")return s;if(r&&s==="FILE")return!1}var i,n=this.statCache[e];if(!n){var a;try{a=this.fs.lstatSync(e)}catch(o){if(o&&(o.code==="ENOENT"||o.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(a&&a.isSymbolicLink())try{n=this.fs.statSync(e)}catch{n=a}else n=a}this.statCache[e]=n;var s=!0;return n&&(s=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,r&&s==="FILE"?!1:s};_.prototype._mark=function(t){return B.mark(this,t)};_.prototype._makeAbs=function(t){return B.makeAbs(this,t)}});var It=O((ki,Oe)=>{Oe.exports=Ce;function Ce(t,e){if(t&&e)return Ce(t)(e);if(typeof t!="function")throw new TypeError("need wrapper function");return Object.keys(t).forEach(function(i){r[i]=t[i]}),r;function r(){for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];var a=t.apply(this,i),s=i[i.length-1];return typeof a=="function"&&a!==s&&Object.keys(s).forEach(function(o){a[o]=s[o]}),a}}});var Ft=O((Ai,Mt)=>{var Pe=It();Mt.exports=Pe(ct);Mt.exports.strict=Pe(je);ct.proto=ct(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return ct(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return je(this)},configurable:!0})});function ct(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function je(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}});var Ie=O((Ci,Ne)=>{var Nr=It(),Y=Object.create(null),Ir=Ft();Ne.exports=Nr(Mr);function Mr(t,e){return Y[t]?(Y[t].push(e),null):(Y[t]=[e],Fr(t))}function Fr(t){return Ir(function e(){var r=Y[t],i=r.length,n=Dr(arguments);try{for(var a=0;a<i;a++)r[a].apply(null,n)}finally{r.length>i?(r.splice(0,i),process.nextTick(function(){e.apply(null,n)})):delete Y[t]}})}function Dr(t){for(var e=t.length,r=[],i=0;i<e;i++)r[i]=t[i];return r}});var Nt=O((ji,Fe)=>{Fe.exports=H;var Lr=vt(),Me=at(),Oi=Me.Minimatch,xr=ge(),Rr=w("events").EventEmitter,Dt=w("path"),Lt=w("assert"),tt=w("path").isAbsolute,Rt=Ae(),K=Ot(),qr=K.setopts,xt=K.ownProp,qt=Ie(),Pi=w("util"),Gr=K.childrenIgnored,Tr=K.isIgnored,Ur=Ft();function H(t,e,r){if(typeof e=="function"&&(r=e,e={}),e||(e={}),e.sync){if(r)throw new TypeError("callback provided to sync glob");return Rt(t,e)}return new y(t,e,r)}H.sync=Rt;var $r=H.GlobSync=Rt.GlobSync;H.glob=H;function Wr(t,e){if(e===null||typeof e!="object")return t;for(var r=Object.keys(e),i=r.length;i--;)t[r[i]]=e[r[i]];return t}H.hasMagic=function(t,e){var r=Wr({},e);r.noprocess=!0;var i=new y(t,r),n=i.minimatch.set;if(!t)return!1;if(n.length>1)return!0;for(var a=0;a<n[0].length;a++)if(typeof n[0][a]!="string")return!0;return!1};H.Glob=y;xr(y,Rr);function y(t,e,r){if(typeof e=="function"&&(r=e,e=null),e&&e.sync){if(r)throw new TypeError("callback provided to sync glob");return new $r(t,e)}if(!(this instanceof y))return new y(t,e,r);qr(this,t,e),this._didRealPath=!1;var i=this.minimatch.set.length;this.matches=new Array(i),typeof r=="function"&&(r=Ur(r),this.on("error",r),this.on("end",function(c){r(null,c)}));var n=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(i===0)return o();for(var a=!0,s=0;s<i;s++)this._process(this.minimatch.set[s],s,!1,o);a=!1;function o(){--n._processing,n._processing<=0&&(a?process.nextTick(function(){n._finish()}):n._finish())}}y.prototype._finish=function(){if(Lt(this instanceof y),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();K.finish(this),this.emit("end",this.found)}};y.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var t=this.matches.length;if(t===0)return this._finish();for(var e=this,r=0;r<this.matches.length;r++)this._realpathSet(r,i);function i(){--t===0&&e._finish()}};y.prototype._realpathSet=function(t,e){var r=this.matches[t];if(!r)return e();var i=Object.keys(r),n=this,a=i.length;if(a===0)return e();var s=this.matches[t]=Object.create(null);i.forEach(function(o,c){o=n._makeAbs(o),Lr.realpath(o,n.realpathCache,function(u,d){u?u.syscall==="stat"?s[o]=!0:n.emit("error",u):s[d]=!0,--a===0&&(n.matches[t]=s,e())})})};y.prototype._mark=function(t){return K.mark(this,t)};y.prototype._makeAbs=function(t){return K.makeAbs(this,t)};y.prototype.abort=function(){this.aborted=!0,this.emit("abort")};y.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};y.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var t=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<t.length;e++){var r=t[e];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var i=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<i.length;e++){var n=i[e];this._processing--,this._process(n[0],n[1],n[2],n[3])}}}};y.prototype._process=function(t,e,r,i){if(Lt(this instanceof y),Lt(typeof i=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([t,e,r,i]);return}for(var n=0;typeof t[n]=="string";)n++;var a;switch(n){case t.length:this._processSimple(t.join("/"),e,i);return;case 0:a=null;break;default:a=t.slice(0,n).join("/");break}var s=t.slice(n),o;a===null?o=".":((tt(a)||tt(t.map(function(d){return typeof d=="string"?d:"[*]"}).join("/")))&&(!a||!tt(a))&&(a="/"+a),o=a);var c=this._makeAbs(o);if(Gr(this,o))return i();var u=s[0]===Me.GLOBSTAR;u?this._processGlobStar(a,o,c,s,e,r,i):this._processReaddir(a,o,c,s,e,r,i)}};y.prototype._processReaddir=function(t,e,r,i,n,a,s){var o=this;this._readdir(r,a,function(c,u){return o._processReaddir2(t,e,r,i,n,a,u,s)})};y.prototype._processReaddir2=function(t,e,r,i,n,a,s,o){if(!s)return o();for(var c=i[0],u=!!this.minimatch.negate,d=c._glob,p=this.dot||d.charAt(0)===".",l=[],h=0;h<s.length;h++){var f=s[h];if(f.charAt(0)!=="."||p){var g;u&&!t?g=!f.match(c):g=f.match(c),g&&l.push(f)}}var v=l.length;if(v===0)return o();if(i.length===1&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(var h=0;h<v;h++){var f=l[h];t&&(t!=="/"?f=t+"/"+f:f=t+f),f.charAt(0)==="/"&&!this.nomount&&(f=Dt.join(this.root,f)),this._emitMatch(n,f)}return o()}i.shift();for(var h=0;h<v;h++){var f=l[h],b;t&&(t!=="/"?f=t+"/"+f:f=t+f),this._process([f].concat(i),n,a,o)}o()};y.prototype._emitMatch=function(t,e){if(!this.aborted&&!Tr(this,e)){if(this.paused){this._emitQueue.push([t,e]);return}var r=tt(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=r),!this.matches[t][e]){if(this.nodir){var i=this.cache[r];if(i==="DIR"||Array.isArray(i))return}this.matches[t][e]=!0;var n=this.statCache[r];n&&this.emit("stat",e,n),this.emit("match",e)}}};y.prototype._readdirInGlobStar=function(t,e){if(this.aborted)return;if(this.follow)return this._readdir(t,!1,e);var r="lstat\0"+t,i=this,n=qt(r,a);n&&i.fs.lstat(t,n);function a(s,o){if(s&&s.code==="ENOENT")return e();var c=o&&o.isSymbolicLink();i.symlinks[t]=c,!c&&o&&!o.isDirectory()?(i.cache[t]="FILE",e()):i._readdir(t,!1,e)}};y.prototype._readdir=function(t,e,r){if(!this.aborted&&(r=qt("readdir\0"+t+"\0"+e,r),!!r)){if(e&&!xt(this.symlinks,t))return this._readdirInGlobStar(t,r);if(xt(this.cache,t)){var i=this.cache[t];if(!i||i==="FILE")return r();if(Array.isArray(i))return r(null,i)}var n=this;n.fs.readdir(t,Br(this,t,r))}};function Br(t,e,r){return function(i,n){i?t._readdirError(e,i,r):t._readdirEntries(e,n,r)}}y.prototype._readdirEntries=function(t,e,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var i=0;i<e.length;i++){var n=e[i];t==="/"?n=t+n:n=t+"/"+n,this.cache[n]=!0}return this.cache[t]=e,r(null,e)}};y.prototype._readdirError=function(t,e,r){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var i=this._makeAbs(t);if(this.cache[i]="FILE",i===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);n.path=this.cwd,n.code=e.code,this.emit("error",n),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:this.cache[this._makeAbs(t)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return r()}};y.prototype._processGlobStar=function(t,e,r,i,n,a,s){var o=this;this._readdir(r,a,function(c,u){o._processGlobStar2(t,e,r,i,n,a,u,s)})};y.prototype._processGlobStar2=function(t,e,r,i,n,a,s,o){if(!s)return o();var c=i.slice(1),u=t?[t]:[],d=u.concat(c);this._process(d,n,!1,o);var p=this.symlinks[r],l=s.length;if(p&&a)return o();for(var h=0;h<l;h++){var f=s[h];if(!(f.charAt(0)==="."&&!this.dot)){var g=u.concat(s[h],c);this._process(g,n,!0,o);var v=u.concat(s[h],i);this._process(v,n,!0,o)}}o()};y.prototype._processSimple=function(t,e,r){var i=this;this._stat(t,function(n,a){i._processSimple2(t,e,n,a,r)})};y.prototype._processSimple2=function(t,e,r,i,n){if(this.matches[e]||(this.matches[e]=Object.create(null)),!i)return n();if(t&&tt(t)&&!this.nomount){var a=/[\/\\]$/.test(t);t.charAt(0)==="/"?t=Dt.join(this.root,t):(t=Dt.resolve(this.root,t),a&&(t+="/"))}process.platform==="win32"&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t),n()};y.prototype._stat=function(t,e){var r=this._makeAbs(t),i=t.slice(-1)==="/";if(t.length>this.maxLength)return e();if(!this.stat&&xt(this.cache,r)){var n=this.cache[r];if(Array.isArray(n)&&(n="DIR"),!i||n==="DIR")return e(null,n);if(i&&n==="FILE")return e()}var a,s=this.statCache[r];if(s!==void 0){if(s===!1)return e(null,s);var o=s.isDirectory()?"DIR":"FILE";return i&&o==="FILE"?e():e(null,o,s)}var c=this,u=qt("stat\0"+r,d);u&&c.fs.lstat(r,u);function d(p,l){if(l&&l.isSymbolicLink())return c.fs.stat(r,function(h,f){h?c._stat2(t,r,null,l,e):c._stat2(t,r,h,f,e)});c._stat2(t,r,p,l,e)}};y.prototype._stat2=function(t,e,r,i,n){if(r&&(r.code==="ENOENT"||r.code==="ENOTDIR"))return this.statCache[e]=!1,n();var a=t.slice(-1)==="/";if(this.statCache[e]=i,e.slice(-1)==="/"&&i&&!i.isDirectory())return n(null,!1,i);var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,a&&s==="FILE"?n():n(null,s,i)}});var Xr={};Be(Xr,{default:()=>Zr});var Q=w("@yarnpkg/core");var S=w("@yarnpkg/core"),U=w("@yarnpkg/fslib");function Ke(t,e){if(typeof t!="object")return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config is not an object!"),!1;if(!Array.isArray(t.scriptsToCache))return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config.scriptsToCache is not an array!"),!1;if(t.scriptsToCache.find(r=>typeof r!="object")!==void 0)return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config.scriptsToCache should only contain objects!"),!1;if(t.scriptsToCache.find(r=>!Ve(r,e))!==void 0)return!1;if(t.remoteCaches){if(!Array.isArray(t.remoteCaches))return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config.remoteCaches is not an array!"),!1;if(t.remoteCaches.find(r=>typeof r!="string")!==void 0)return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config.remoteCaches should only contain strings!"),!1;if(t.remoteCaches.find(r=>!Qe(r))!==void 0)return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config.remoteCaches should only contain valid URLs!"),!1}return!0}function Qe(t){try{return new URL(t),!0}catch{return!1}}function Ve(t,e){if(typeof t.scriptName!="string")return e.reportError(S.MessageName.UNNAMED,"build-result-cache-rc.json is not valid: config.scriptsToCache.scriptName is no string!"),!1;if(t.inputIncludes!==void 0&&typeof t.inputIncludes!="string"){if(!Array.isArray(t.inputIncludes))return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.inputIncludes for ${t.scriptName} is not an array!`),!1;if(t.inputIncludes.find(r=>typeof r!="string")!==void 0)return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.inputIncludes for ${t.scriptName} should only contain strings!`),!1}if(t.inputExcludes!==void 0&&typeof t.inputExcludes!="string"){if(!Array.isArray(t.inputExcludes))return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.inputExcludes for ${t.scriptName} is not an array!`),!1;if(t.inputExcludes.find(r=>typeof r!="string")!==void 0)return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.inputExcludes for ${t.scriptName} should only contain strings!`),!1}if(t.outputIncludes!==void 0&&typeof t.outputIncludes!="string"){if(!Array.isArray(t.outputIncludes))return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.outputIncludes for ${t.scriptName} is not an array!`),!1;if(t.outputIncludes.find(r=>typeof r!="string")!==void 0)return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.outputIncludes for ${t.scriptName} should only contain strings!`),!1}if(t.outputExcludes!==void 0&&typeof t.outputExcludes!="string"){if(!Array.isArray(t.outputExcludes))return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.outputExcludes for ${t.scriptName} is not an array!`),!1;if(t.outputExcludes.find(r=>typeof r!="string")!==void 0)return e.reportError(S.MessageName.UNNAMED,`build-result-cache-rc.json is not valid: config.scriptsToCache.outputExcludes for ${t.scriptName} should only contain strings!`),!1}return!0}async function Wt(t,e){let r=U.ppath.join(t,(0,U.toFilename)("build-result-cache-rc.json"));if(await U.xfs.existsPromise(r)){let i=await U.xfs.readFilePromise(r,"utf-8");try{let n=JSON.parse(i);if(Ke(n,e))return n}catch(n){e.reportErrorOnce(S.MessageName.EXCEPTION,"build-result-cache-rc.json is not valid:"),e.reportExceptionOnce(n)}}}var C=w("@yarnpkg/fslib"),rt=class{constructor(e){this.cwd=e}async saveCacheEntry(e){let r=Date.now().toString()+".json",i=JSON.stringify(e),n=C.ppath.join(this.cwd,(0,C.toFilename)(".build-result-cache"));await C.xfs.mkdirPromise(n,{recursive:!0});let a=C.ppath.join(n,(0,C.toFilename)(r));await C.xfs.writeFilePromise(a,i)}async loadCacheEntry(e){let r=C.ppath.join(this.cwd,(0,C.toFilename)(".build-result-cache"));if(!await C.xfs.existsPromise(r))return;let i=await C.xfs.readdirPromise(r);for(let n of i){let a=C.ppath.join(r,n),s=await C.xfs.readFilePromise(a,"utf8"),o=JSON.parse(s);if(Je(e,o.key))return o}}};function Je(t,e){return JSON.stringify(t)===JSON.stringify(e)}var it=class{constructor(e){this.url=e}async saveCacheEntry(e){}async loadCacheEntry(e){}};function Bt(t,e){let r=[new rt(t)];return e.remoteCaches&&e.remoteCaches.forEach(i=>r.push(new it(new URL(i)))),r}var k=w("@yarnpkg/fslib"),De=$t(w("crypto")),Gt=$t(Nt());async function Le(t,e,r,i){let n=await Re(t,e,r),a=await Kr(e.cwd,r),s={key:n,value:a};for(let o of i)await o.saveCacheEntry(s)}async function xe(t,e,r,i){let n=await Re(t,e,r);for(let a of i){let s=await a.loadCacheEntry(n);if(s)return await Qr(e.cwd,s.value),!0}return!1}async function Re(t,e,r){var u;let i=e.script,n=e.args,a=t.lockFileChecksum,s=t.topLevelWorkspace.locator.locatorHash,o=(u=t.tryWorkspaceByCwd(e.cwd))==null?void 0:u.locator.locatorHash,c={};for(let d of ut(r.inputIncludes)){let p=k.npath.fromPortablePath(e.cwd),l=Gt.glob.sync(d,{cwd:p,ignore:ut(r.inputExcludes)}),h={};for(let f of l){let g=k.npath.toPortablePath(f),v=k.ppath.resolve(e.cwd,g);(await k.xfs.statPromise(v)).isFile()&&(h[g]=await Hr(v))}c[d]=h}return{script:i,args:n,lockFileChecksum:a,topLevelWorkspaceLocatorHash:s,workspaceLocatorHash:o,globFileHashes:c}}async function Hr(t){let e=De.default.createHash("sha512"),r=await k.xfs.readFilePromise(t,"base64");return e.update(r),e.digest("base64")}async function Kr(t,e){let r={};for(let i of ut(e.outputIncludes)){let n=k.npath.fromPortablePath(t),a=Gt.glob.sync(i,{cwd:n,ignore:ut(e.outputExcludes)}),s={};for(let o of a){let c=k.npath.toPortablePath(o),u=k.ppath.resolve(t,c);(await k.xfs.statPromise(u)).isFile()&&(s[c]=await k.xfs.readFilePromise(u,"base64"))}r[i]=s}return{globFileContents:r}}async function Qr(t,e){for(let r of Object.values(e.globFileContents))for(let[i,n]of Object.entries(r)){let a=k.ppath.join(t,i),s=k.ppath.dirname(a);await k.xfs.mkdirPromise(s,{recursive:!0}),await k.xfs.writeFilePromise(a,n,{encoding:"base64"})}}function ut(t){return t===void 0?[]:typeof t=="string"?[t]:t}async function Vr(t){let e=Q.Configuration.create(t.cwd);return Q.StreamReport.start({configuration:e,includeFooter:!1,stdout:t.stdout},async()=>{})}var Jr=async(t,e,r,i,n)=>{let a=await Vr(n),s=await Wt(n.cwd,a),o=s?s.scriptsToCache.find(c=>c.scriptName===i):void 0;if(s&&o){let c=Bt(n.cwd,s);return async()=>{if(await xe(e,n,o,c))return a.reportInfo(Q.MessageName.UNNAMED,"Build result was restored from cache!"),Promise.resolve(0);{let u=await t();return u===0&&(await Le(e,n,o,c),a.reportInfo(Q.MessageName.UNNAMED,"Build result cache was updated!")),u}}}else return t},zr={hooks:{wrapScriptExecution:Jr}},Zr=zr;return He(Xr);})();
return plugin;
}
};
